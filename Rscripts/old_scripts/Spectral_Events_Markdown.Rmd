---
title: "Effect of Age on Frequency Band Events and its Relationship to Task Performance"
author: "Shane McKeon"
date: "3/20/2020"
geometry: margin = 1in
output:
  pdf_document:  
    toc: true
    toc_depth: 4    
    fig_caption: yes
  latex_engine: xelatex

  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, dev='png', dpi=150, fig.width = 6, fig.height=6, fig.align = 'left', fig.margin = TRUE)

```

```{r, echo= FALSE, message = FALSE, warning = FALSE}

if (!require("pacman")) install.packages("pacman")
pacman::p_load(dplyr, ggplot2,lme4, multcomp, tidyr, tidyverse,wesanderson, reshape2, corrplot, ggExtra, cowplot, ggsci, mgcv, ggpointdensity, devtools, ggpubr, itsadug, useful, rmarkdown, tinytex, gratia, gamm4, car, GGally, CCA)

#devtools::install_github('LabneuroCogDevel/LNCDR')
#library(devtools)
#devtools::install_github("strengejacke/sjPlot")
#library(LNCDR)
library(data.table)


GammaT  <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Gamma/Delay1_2/Gamma_all_data.csv')
AlphaT  <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Alpha/Delay1_2/Alpha_all_data.csv')
BetaT  <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Beta/Delay1_2/Beta_all_data.csv')
ThetaT  <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Theta/Delay1_2/Theta_all_data.csv')
agefile <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/agefile.csv')
agefile$Subject <- agefile$idvalues 

GrandTable <- merge(GammaT, AlphaT, by = c('Subject', 'Trial'), all.x = TRUE, all.y = TRUE)
GrandTable <- merge(GrandTable, BetaT, by = c('Subject', 'Trial'), all.x = TRUE, all.y = TRUE)
GrandTable <- merge(GrandTable, ThetaT, by = c('Subject', 'Trial'), all.x = TRUE, all.y = TRUE)
GrandTable <- merge(GrandTable, agefile, by = 'Subject', all.x = TRUE, all.y = TRUE)

GrandTable$log10_Gamma_Trial_Power <- log10(GrandTable$Gamma_Trial_Power)
GrandTable$log10_Theta_Trial_Power <- log10(GrandTable$Theta_Trial_Power)
GrandTable$log10_Beta_Trial_Power <- log10(GrandTable$Beta_Trial_Power)
GrandTable$log10_Alpha_Trial_Power <- log10(GrandTable$Alpha_Trial_Power)


Behavior <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Behavior.csv')

Behavior$Subject <- paste0(Behavior$LunaID, '_', Behavior$ScanDate)
Behavior <- merge(Behavior, agefile, by = 'Subject', all.x = TRUE, all.y = TRUE)

Everything <- merge(GrandTable, Behavior, by = c('Subject', 'Trial'), all.x = TRUE, all.y = TRUE)
Everything$absPositionError <- abs(Everything$PositionError)

## average across trials 
#gamma
Avg_log10_gamma_power <- aggregate(log10_Gamma_Trial_Power ~ Subject, Everything[Everything$log10_Gamma_Trial_Power != '-Inf',], mean)
TrialVar_log10_gamma_power <- aggregate(log10_Gamma_Trial_Power ~ Subject, Everything[Everything$log10_Gamma_Trial_Power != '-Inf',], sd)
PerSubjectGamma <- merge(Avg_log10_gamma_power, TrialVar_log10_gamma_power, by = 'Subject', suffix = c("_mean", "_SD"), all.x = TRUE, all.y = TRUE )
PerSubjectGamma <- merge(PerSubjectGamma, agefile, by= 'Subject',  all.x = TRUE, all.y = TRUE)

Avg_gamma_duration <- aggregate(Gamma_Event_Duration ~ Subject, Everything, mean)
TrialVar_gamma_duration <- aggregate(Gamma_Event_Duration ~ Subject, Everything, sd)
PerSubjectGamma <- merge(PerSubjectGamma, Avg_gamma_duration, by= 'Subject', suffix = c("", "_mean"),  all.x = TRUE, all.y = TRUE)
PerSubjectGamma <- merge(PerSubjectGamma, TrialVar_gamma_duration, by= 'Subject', suffix = c("", "_SD"),  all.x = TRUE, all.y = TRUE)

Avg_gamma_event_number <- aggregate(Gamma_Event_Number ~ Subject, Everything, mean)
TrialVar_gamma_event_number <- aggregate(Gamma_Event_Number ~ Subject, Everything, sd)
PerSubjectGamma <- merge(PerSubjectGamma, Avg_gamma_event_number, by= 'Subject', suffix = c("", "_mean"),  all.x = TRUE, all.y = TRUE)
PerSubjectGamma <- merge(PerSubjectGamma, TrialVar_gamma_event_number, by= 'Subject', suffix = c("", "_SD"),  all.x = TRUE, all.y = TRUE)
PerSubjectGamma$ageInverse = 1/PerSubjectGamma$age

avg_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, mean)
SD_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, sd)

PerSubjectGamma <- merge(PerSubjectGamma, avg_abs_PositionError, by= 'Subject',suffix = c("", "_mean"),  all.x = TRUE, all.y = TRUE)
PerSubjectGamma <- merge(PerSubjectGamma, SD_abs_PositionError, by= 'Subject', suffix = c("", "_SD"),  all.x = TRUE, all.y = TRUE)

avg_Latency <- aggregate(mgsLatency ~ Subject, Everything, mean)
SD_Latency <- aggregate(mgsLatency ~ Subject, Everything, sd)

PerSubjectGamma <- merge(PerSubjectGamma, avg_Latency, by = 'Subject',suffix = c("", "_mean"),  all.x = TRUE, all.y = TRUE)
PerSubjectGamma <- merge(PerSubjectGamma, SD_Latency, by = 'Subject', suffix = c("", "_SD"),  all.x = TRUE, all.y = TRUE)


#alpha
Avg_log10_alpha_power <- aggregate(log10_Alpha_Trial_Power ~ Subject, Everything[Everything$log10_Alpha_Trial_Power != '-Inf',], mean)
TrialVar_log10_alpha_power <- aggregate(log10_Alpha_Trial_Power ~ Subject, Everything[Everything$log10_Alpha_Trial_Power != '-Inf',], sd)
PerSubjectAlpha <- merge(Avg_log10_alpha_power, TrialVar_log10_alpha_power, by = 'Subject', suffix = c("_mean", "_SD"),  all.x = TRUE, all.y = TRUE )
PerSubjectAlpha <- merge(PerSubjectAlpha, agefile, by= 'Subject',  all.x = TRUE, all.y = TRUE)

Avg_alpha_duration <- aggregate(Alpha_Event_Duration ~ Subject, Everything, mean)
TrialVar_alpha_duration <- aggregate(Alpha_Event_Duration ~ Subject, Everything, sd)
PerSubjectAlpha <- merge(PerSubjectAlpha, Avg_alpha_duration, by= 'Subject', suffix = c("", "_mean"),  all.x = TRUE, all.y = TRUE)
PerSubjectAlpha <- merge(PerSubjectAlpha, TrialVar_alpha_duration, by= 'Subject', suffix = c("", "_SD"),  all.x = TRUE, all.y = TRUE)

Avg_alpha_event_number <- aggregate(Alpha_Event_Number ~ Subject, Everything, mean)
TrialVar_alpha_event_number <- aggregate(Alpha_Event_Number ~ Subject, Everything, sd)
PerSubjectAlpha <- merge(PerSubjectAlpha, Avg_alpha_event_number, by= 'Subject', suffix = c("", "_mean"),  all.x = TRUE, all.y = TRUE)
PerSubjectAlpha <- merge(PerSubjectAlpha, TrialVar_alpha_event_number, by= 'Subject', suffix = c("", "_SD"),  all.x = TRUE, all.y = TRUE)
PerSubjectAlpha$ageInverse = 1/PerSubjectAlpha$age

avg_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, mean)
SD_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, sd)

PerSubjectAlpha <- merge(PerSubjectAlpha, avg_abs_PositionError, by= 'Subject',suffix = c("", "_mean"),  all.x = TRUE, all.y = TRUE)
PerSubjectAlpha <- merge(PerSubjectAlpha, SD_abs_PositionError, by= 'Subject', suffix = c("", "_SD"),  all.x = TRUE, all.y = TRUE)

avg_Latency <- aggregate(mgsLatency ~ Subject, Everything, mean)
SD_Latency <- aggregate(mgsLatency ~ Subject, Everything, sd)

PerSubjectAlpha <- merge(PerSubjectAlpha, avg_Latency, by = 'Subject',suffix = c("", "_mean"),  all.x = TRUE, all.y = TRUE)
PerSubjectAlpha <- merge(PerSubjectAlpha, SD_Latency, by = 'Subject', suffix = c("", "_SD"),  all.x = TRUE, all.y = TRUE)

#theta
Avg_log10_theta_power <- aggregate(log10_Theta_Trial_Power ~ Subject, Everything[Everything$log10_Theta_Trial_Power != '-Inf',], mean)
TrialVar_log10_theta_power <- aggregate(log10_Theta_Trial_Power ~ Subject, Everything[Everything$log10_Theta_Trial_Power != '-Inf',], sd)
PerSubjectTheta <- merge(Avg_log10_theta_power, TrialVar_log10_theta_power, by = 'Subject', suffix = c("_mean", "_SD"),  all.x = TRUE, all.y = TRUE )
PerSubjectTheta <- merge(PerSubjectTheta, agefile, by= 'Subject')

Avg_theta_duration <- aggregate(Theta_Event_Duration ~ Subject, Everything, mean)
TrialVar_theta_duration <- aggregate(Theta_Event_Duration ~ Subject, Everything, sd)
PerSubjectTheta <- merge(PerSubjectTheta, Avg_theta_duration, by= 'Subject', suffix = c("", "_mean"),  all.x = TRUE, all.y = TRUE)
PerSubjectTheta <- merge(PerSubjectTheta, TrialVar_theta_duration, by= 'Subject', suffix = c("", "_SD"),  all.x = TRUE, all.y = TRUE)

Avg_theta_event_number <- aggregate(Theta_Event_Number ~ Subject, Everything, mean)
TrialVar_theta_event_number <- aggregate(Theta_Event_Number ~ Subject, Everything, sd)
PerSubjectTheta <- merge(PerSubjectTheta, Avg_theta_event_number, by= 'Subject', suffix = c("", "_mean"),  all.x = TRUE, all.y = TRUE)
PerSubjectTheta <- merge(PerSubjectTheta, TrialVar_theta_event_number, by= 'Subject', suffix = c("", "_SD"),  all.x = TRUE, all.y = TRUE)
PerSubjectTheta$ageInverse = 1/PerSubjectTheta$age

avg_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, mean)
SD_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, sd)

PerSubjectTheta <- merge(PerSubjectTheta, avg_abs_PositionError, by= 'Subject',suffix = c("", "_mean"),  all.x = TRUE, all.y = TRUE)
PerSubjectTheta <- merge(PerSubjectTheta, SD_abs_PositionError, by= 'Subject', suffix = c("", "_SD"),  all.x = TRUE, all.y = TRUE)

avg_Latency <- aggregate(mgsLatency ~ Subject, Everything, mean)
SD_Latency <- aggregate(mgsLatency ~ Subject, Everything, sd)

PerSubjectTheta <- merge(PerSubjectTheta, avg_Latency, by = 'Subject',suffix = c("", "_mean"),  all.x = TRUE, all.y = TRUE)
PerSubjectTheta <- merge(PerSubjectTheta, SD_Latency, by = 'Subject', suffix = c("", "_SD"),  all.x = TRUE, all.y = TRUE)

#beta
Avg_log10_beta_power <- aggregate(log10_Beta_Trial_Power ~ Subject, Everything[Everything$log10_Beta_Trial_Power != '-Inf',], mean)
TrialVar_log10_beta_power <- aggregate(log10_Beta_Trial_Power ~ Subject, Everything[Everything$log10_Beta_Trial_Power != '-Inf',], sd)
PerSubjectBeta <- merge(Avg_log10_beta_power, TrialVar_log10_beta_power, by = 'Subject', suffix = c("_mean", "_SD"),  all.x = TRUE, all.y = TRUE )
PerSubjectBeta <- merge(PerSubjectBeta, agefile, by= 'Subject')

Avg_beta_duration <- aggregate(Beta_Event_Duration ~ Subject, Everything, mean)
TrialVar_beta_duration <- aggregate(Beta_Event_Duration ~ Subject, Everything, sd)
PerSubjectBeta <- merge(PerSubjectBeta, Avg_beta_duration, by= 'Subject', suffix = c("", "_mean"),  all.x = TRUE, all.y = TRUE)
PerSubjectBeta <- merge(PerSubjectBeta, TrialVar_beta_duration, by= 'Subject', suffix = c("", "_SD"),  all.x = TRUE, all.y = TRUE)

Avg_beta_event_number <- aggregate(Beta_Event_Number ~ Subject, Everything, mean)
TrialVar_beta_event_number <- aggregate(Beta_Event_Number ~ Subject, Everything, sd)
PerSubjectBeta <- merge(PerSubjectBeta, Avg_beta_event_number, by= 'Subject', suffix = c("", "_mean"),  all.x = TRUE, all.y = TRUE)
PerSubjectBeta <- merge(PerSubjectBeta, TrialVar_beta_event_number, by= 'Subject', suffix = c("", "_SD"),  all.x = TRUE, all.y = TRUE)
PerSubjectBeta$ageInverse = 1/PerSubjectBeta$age

avg_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, mean)
SD_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, sd)

PerSubjectBeta <- merge(PerSubjectBeta, avg_abs_PositionError, by= 'Subject',suffix = c("", "_mean"),  all.x = TRUE, all.y = TRUE)
PerSubjectBeta <- merge(PerSubjectBeta, SD_abs_PositionError, by= 'Subject', suffix = c("", "_SD"),  all.x = TRUE, all.y = TRUE)

avg_Latency <- aggregate(mgsLatency ~ Subject, Everything, mean)
SD_Latency <- aggregate(mgsLatency ~ Subject, Everything, sd)

PerSubjectBeta <- merge(PerSubjectBeta, avg_Latency, by = 'Subject',suffix = c("", "_mean"),  all.x = TRUE, all.y = TRUE)
PerSubjectBeta <- merge(PerSubjectBeta, SD_Latency, by = 'Subject', suffix = c("", "_SD"),  all.x = TRUE, all.y = TRUE)


## plots
#frequency vs age 
```

# Delay Period 1-2 Seconds: Frequency Bands Across Age
## Gamma Frequency Band

```{r, echo= FALSE, message = FALSE, warning = FALSE, fig.margin = TRUE}
#gamma

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2,],  aes(x = age, y = log10_Gamma_Trial_Power_mean )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Gamma Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power")

lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2,], log10_Gamma_Trial_Power_mean ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2,],  aes(x = age, y = log10_Gamma_Trial_Power_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Gamma Power vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2,], log10_Gamma_Trial_Power_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2,],  aes(x = age, y = Gamma_Event_Duration)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Gamma Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("Duration")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2,], Gamma_Event_Duration ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2,],  aes(x = age, y = Gamma_Event_Duration_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Varibaility of Gamma Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2,], Gamma_Event_Duration_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2,],  aes(x = age, y = Gamma_Event_Number )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Average Gamma Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2,], Gamma_Event_Number ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2,],  aes(x = age, y = Gamma_Event_Number_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Varibaility of Gamma Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2,], Gamma_Event_Number_SD ~ ageInverse)
anova(lm.model)

```


## Alpha Frequency Band

```{r, echo= FALSE, message = FALSE, warning = FALSE}
#alpha
ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2,],  aes(x = age, y = log10_Alpha_Trial_Power_mean )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Alpha Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2,], log10_Alpha_Trial_Power_mean ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2,],  aes(x = age, y = log10_Alpha_Trial_Power_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Alpha Power vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2,], log10_Alpha_Trial_Power_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2,],  aes(x = age, y = Alpha_Event_Duration)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Alpha Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Duration")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2,], Alpha_Event_Duration ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2,],  aes(x = age, y = Alpha_Event_Duration_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Alpha Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2,], Alpha_Event_Duration_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2,],  aes(x = age, y = Alpha_Event_Number )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Alpha Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2,], Alpha_Event_Number ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2,],  aes(x = age, y = Alpha_Event_Number_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Variability of Alpha Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2,], Alpha_Event_Number_SD ~ ageInverse)
anova(lm.model)

```

## Theta Frequency Band

```{r echo=FALSE, message=FALSE, warning=FALSE}
#theta
ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2,],  aes(x = age, y = log10_Theta_Trial_Power_mean )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Theta Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2,], log10_Theta_Trial_Power_mean ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2,],  aes(x = age, y = log10_Theta_Trial_Power_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Theta Power vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2,], log10_Theta_Trial_Power_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2,],  aes(x = age, y = Theta_Event_Duration)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Theta Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Duration")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2,], Theta_Event_Duration ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2,],  aes(x = age, y = Theta_Event_Duration_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Theta Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2,], Theta_Event_Duration_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2,],  aes(x = age, y = Theta_Event_Number )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Theta Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2,], Theta_Event_Number ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2,],  aes(x = age, y = Theta_Event_Number_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Variability of Theta Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2,], Theta_Event_Number_SD ~ ageInverse)
anova(lm.model)

```

## Beta Frequency Band

```{r echo=FALSE, message=FALSE, warning=FALSE}
#beta
ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2,],  aes(x = age, y = log10_Beta_Trial_Power_mean )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Beta Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2,], log10_Beta_Trial_Power_mean ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2,],  aes(x = age, y = log10_Beta_Trial_Power_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Beta Power vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2,], log10_Beta_Trial_Power_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2,],  aes(x = age, y = Beta_Event_Duration)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Beta Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Duration")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2,], Beta_Event_Duration ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2,],  aes(x = age, y = Beta_Event_Duration_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Beta Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2,], Beta_Event_Duration_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2,],  aes(x = age, y = Beta_Event_Number )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Beta Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2,], Beta_Event_Number ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2,],  aes(x = age, y = Beta_Event_Number_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Variability of Beta Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2,], Beta_Event_Number_SD ~ ageInverse)
anova(lm.model)
```

# Delay Period 1-2 Seconds: Frequency Bands and Task Performance
## Fit Linear Mixed Effects Model
### Gamma Band Frequency
#### Effect of Gamma Trial Power on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + log10_Gamma_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Gamma_Trial_Power != '-Inf',], na.action = na.omit)
car::Anova(modelFit)
```

#### Effect of Gamma Trial Power on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + log10_Gamma_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Gamma_Trial_Power != '-Inf',], na.action = na.omit)
car::Anova(modelFit)
```

#### Effect of Average Gamma Event Number on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Gamma_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,], na.action = na.omit)
car::Anova(modelFit)
```
#### Effect of Average Gamma Event Number on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Gamma_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,], na.action = na.omit)
car::Anova(modelFit)
```

#### Effect of Average Gamma Event Duration on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Gamma_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,], na.action = na.omit)
car::Anova(modelFit)
```
#### Effect of Average Gamma Event Duration on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Gamma_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,], na.action = na.omit)
car::Anova(modelFit)
```

### Alpha Band Frequency
#### Effect of Alpha Trial Power on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + log10_Alpha_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Alpha_Trial_Power != '-Inf',], na.action = na.omit)
car::Anova(modelFit)
```

#### Effect of Alpha Trial Power on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + log10_Alpha_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Alpha_Trial_Power != '-Inf',], na.action = na.omit)
car::Anova(modelFit)
```

#### Effect of Average Alpha Event Number on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Alpha_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,], na.action = na.omit)
car::Anova(modelFit)
```

#### Effect of Average Alpha Event Number on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Alpha_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,], na.action = na.omit)
car::Anova(modelFit)
```

#### Effect of Average Alpha Event Duration on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Alpha_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,], na.action = na.omit)
car::Anova(modelFit)
```

#### Effect of Average Alpha Event Duration on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Alpha_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,], na.action = na.omit)
car::Anova(modelFit)
```


### Theta Band Frequency
#### Effect of Theta Trial Power on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + log10_Theta_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Theta_Trial_Power != '-Inf',], na.action = na.omit)
car::Anova(modelFit)
```

#### Effect of Theta Trial Power on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + log10_Theta_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Theta_Trial_Power != '-Inf',], na.action = na.omit)
car::Anova(modelFit)
```

#### Effect of Average Theta Event Number on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Theta_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,], na.action = na.omit)
car::Anova(modelFit)
```

#### Effect of Average Theta Event Number on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Theta_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,], na.action = na.omit)
car::Anova(modelFit)
```

#### Effect of Average Theta Event Duration on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Theta_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,], na.action = na.omit)
car::Anova(modelFit)
```

#### Effect of Average Theta Event Duration on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Theta_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,], na.action = na.omit)
car::Anova(modelFit)
```


### Beta Band Frequency
#### Effect of Beta Trial Power on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + log10_Beta_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Beta_Trial_Power != '-Inf',], na.action = na.omit)
car::Anova(modelFit)
```

#### Effect of Beta Trial Power on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + log10_Beta_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Beta_Trial_Power != '-Inf',], na.action = na.omit)
car::Anova(modelFit)
```

#### Effect of Average Beta Event Number on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Beta_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,], na.action = na.omit)
car::Anova(modelFit)
```

#### Effect of Average Beta Event Number on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Beta_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,], na.action = na.omit)
car::Anova(modelFit)
```

#### Effect of Average Beta Event Duration on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Beta_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,], na.action = na.omit)
car::Anova(modelFit)
```

#### Effect of Average Beta Event Duration on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Beta_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,], na.action = na.omit)
car::Anova(modelFit)
```


## Gamma Frequency Band
### Position Error

```{r echo=FALSE, message=FALSE, warning=FALSE}

avg_positionError <- aggregate(absPositionError ~ visitno, PerSubjectGamma[], mean)
avg_positionError_SD <- aggregate(absPositionError ~ visitno, PerSubjectGamma[], sd)
excludeHigh <- avg_positionError$absPositionError[1] + 3*avg_positionError_SD$absPositionError[1]
excludeLow <- avg_positionError$absPositionError[1] - 3*avg_positionError_SD$absPositionError[1]


ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$absPositionError < excludeHigh & PerSubjectGamma$absPositionError > excludeLow ,],  aes(x = absPositionError, y = log10_Gamma_Trial_Power_mean )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Gamma Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Power")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$absPositionError < excludeHigh & PerSubjectGamma$absPositionError > excludeLow,], log10_Gamma_Trial_Power_mean ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$absPositionError < excludeHigh & PerSubjectGamma$absPositionError > excludeLow,],  aes(x = absPositionError, y = log10_Gamma_Trial_Power_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Gamma Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$absPositionError < excludeHigh & PerSubjectGamma$absPositionError > excludeLow,], log10_Gamma_Trial_Power_SD ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$absPositionError < excludeHigh & PerSubjectGamma$absPositionError > excludeLow,],  aes(x = absPositionError, y = Gamma_Event_Duration )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Gamma Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Duration")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$absPositionError < excludeHigh & PerSubjectGamma$absPositionError > excludeLow,], Gamma_Event_Duration ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$absPositionError < excludeHigh & PerSubjectGamma$absPositionError > excludeLow,],  aes(x = absPositionError, y = Gamma_Event_Duration_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Gamma Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$absPositionError < excludeHigh & PerSubjectGamma$absPositionError > excludeLow,], Gamma_Event_Duration_SD ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$absPositionError < excludeHigh & PerSubjectGamma$absPositionError > excludeLow,],  aes(x = absPositionError, y = Gamma_Event_Number )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Gamma Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$absPositionError < excludeHigh & PerSubjectGamma$absPositionError > excludeLow,], Gamma_Event_Number ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$absPositionError < excludeHigh & PerSubjectGamma$absPositionError > excludeLow,],  aes(x = absPositionError, y = Gamma_Event_Number_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Gamma Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$absPositionError < excludeHigh & PerSubjectGamma$absPositionError > excludeLow,], Gamma_Event_Number_SD ~ absPositionError)
anova(lm.model)

```

#### Adult Subjects Only  
```{r echo=FALSE, message=FALSE, warning=FALSE}
#outlier detection 
avg_positionError <- aggregate(absPositionError ~ visitno, PerSubjectGamma[PerSubjectGamma$Group == 4,], mean)
avg_positionError_SD <- aggregate(absPositionError ~ visitno, PerSubjectGamma[PerSubjectGamma$Group == 4,], sd)
excludeHigh <- avg_positionError$absPositionError[1] + 3*avg_positionError_SD$absPositionError[1]
excludeLow <- avg_positionError$absPositionError[1] - 3*avg_positionError_SD$absPositionError[1]


ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$absPositionError < excludeHigh & PerSubjectGamma$absPositionError > excludeLow & PerSubjectGamma$Group == 4,],  aes(x = absPositionError, y = log10_Gamma_Trial_Power_mean )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Gamma Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Power")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$absPositionError < excludeHigh & PerSubjectGamma$absPositionError > excludeLow & PerSubjectGamma$Group == 4,], log10_Gamma_Trial_Power_mean ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 &PerSubjectGamma$absPositionError < excludeHigh & PerSubjectGamma$absPositionError > excludeLow & PerSubjectGamma$Group == 4,],  aes(x = absPositionError, y = log10_Gamma_Trial_Power_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Gamma Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$absPositionError < excludeHigh & PerSubjectGamma$absPositionError > excludeLow & PerSubjectGamma$Group == 4,], log10_Gamma_Trial_Power_SD ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$absPositionError < excludeHigh & PerSubjectGamma$absPositionError > excludeLow& PerSubjectGamma$Group == 4,],  aes(x = absPositionError, y = Gamma_Event_Duration )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Gamma Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Duration")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$absPositionError < excludeHigh & PerSubjectGamma$absPositionError > excludeLow & PerSubjectGamma$Group == 4,], Gamma_Event_Duration ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$absPositionError < excludeHigh & PerSubjectGamma$absPositionError > excludeLow & PerSubjectGamma$Group == 4,],  aes(x = absPositionError, y = Gamma_Event_Duration_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Gamma Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$absPositionError < excludeHigh & PerSubjectGamma$absPositionError > excludeLow & PerSubjectGamma$Group == 4,], Gamma_Event_Duration_SD ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$absPositionError < excludeHigh & PerSubjectGamma$absPositionError > excludeLow & PerSubjectGamma$Group == 4,],  aes(x = absPositionError, y = Gamma_Event_Number )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Gamma Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$absPositionError < excludeHigh & PerSubjectGamma$absPositionError > excludeLow & PerSubjectGamma$Group == 4,], Gamma_Event_Number ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$absPositionError < excludeHigh & PerSubjectGamma$absPositionError > excludeLow & PerSubjectGamma$Group == 4,],  aes(x = absPositionError, y = Gamma_Event_Number_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Gamma Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$absPositionError < excludeHigh & PerSubjectGamma$absPositionError > excludeLow & PerSubjectGamma$Group == 4,], Gamma_Event_Number_SD ~ absPositionError)
anova(lm.model)


```

### MGS Latency

```{r echo=FALSE, message=FALSE, warning=FALSE}

#outlier detection 
avg_mgsLatency <- aggregate(mgsLatency ~ visitno, PerSubjectGamma[], mean)
avg_mgsLatency_SD <- aggregate(mgsLatency ~ visitno, PerSubjectGamma[], sd)
excludeHigh <- avg_mgsLatency$mgsLatency[1] + 3*avg_mgsLatency_SD$mgsLatency[1]
excludeLow <- avg_mgsLatency$mgsLatency[1] - 3*avg_mgsLatency_SD$mgsLatency[1]


ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$mgsLatency > excludeLow & PerSubjectGamma$mgsLatency < excludeHigh,],  aes(x = mgsLatency, y = log10_Gamma_Trial_Power_mean )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Gamma Power vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("Power")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$mgsLatency > excludeLow & PerSubjectGamma$mgsLatency < excludeHigh,], log10_Gamma_Trial_Power_mean ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$mgsLatency > excludeLow & PerSubjectGamma$mgsLatency < excludeHigh,],  aes(x = mgsLatency, y = log10_Gamma_Trial_Power_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Gamma Power vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$mgsLatency > excludeLow & PerSubjectGamma$mgsLatency < excludeHigh,], log10_Gamma_Trial_Power_SD ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2  & PerSubjectGamma$mgsLatency > excludeLow & PerSubjectGamma$mgsLatency < excludeHigh,],  aes(x = mgsLatency, y = Gamma_Event_Duration )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Gamma Event Duration vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("Duration")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2  & PerSubjectGamma$mgsLatency > excludeLow & PerSubjectGamma$mgsLatency < excludeHigh,], Gamma_Event_Duration ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2  & PerSubjectGamma$mgsLatency > excludeLow & PerSubjectGamma$mgsLatency < excludeHigh,],  aes(x = mgsLatency, y = Gamma_Event_Duration_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Gamma Event Duration vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2  & PerSubjectGamma$mgsLatency > excludeLow & PerSubjectGamma$mgsLatency < excludeHigh,], Gamma_Event_Duration_SD ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2  & PerSubjectGamma$mgsLatency > excludeLow & PerSubjectGamma$mgsLatency < excludeHigh,],  aes(x = mgsLatency, y = Gamma_Event_Number )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Gamma Event Number vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2  & PerSubjectGamma$mgsLatency > excludeLow & PerSubjectGamma$mgsLatency < excludeHigh,], Gamma_Event_Number ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2  & PerSubjectGamma$mgsLatency > excludeLow & PerSubjectGamma$mgsLatency < excludeHigh,],  aes(x = mgsLatency, y = Gamma_Event_Number_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Gamma Event Number vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2  & PerSubjectGamma$mgsLatency > excludeLow & PerSubjectGamma$mgsLatency < excludeHigh,], Gamma_Event_Number_SD ~ mgsLatency)
anova(lm.model)

```

#### Adults Subjects Only
```{r echo=FALSE, message=FALSE, warning=FALSE}

#outlier detection 
avg_mgsLatency <- aggregate(mgsLatency ~ visitno, PerSubjectGamma[PerSubjectGamma$Group == 4,], mean)
avg_mgsLatency_SD <- aggregate(mgsLatency ~ visitno, PerSubjectGamma[PerSubjectGamma$Group == 4,], sd)
excludeHigh <- avg_mgsLatency$mgsLatency[1] + 3*avg_mgsLatency_SD$mgsLatency[1]
excludeLow <- avg_mgsLatency$mgsLatency[1] - 3*avg_mgsLatency_SD$mgsLatency[1]


ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$Group == 4 & PerSubjectGamma$mgsLatency < excludeHigh & PerSubjectGamma$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = log10_Gamma_Trial_Power_mean )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Gamma Power vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("Power")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$Group == 4 & PerSubjectGamma$mgsLatency < excludeHigh & PerSubjectGamma$mgsLatency > excludeLow,], log10_Gamma_Trial_Power_mean ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$Group == 4 & PerSubjectGamma$mgsLatency < excludeHigh & PerSubjectGamma$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = log10_Gamma_Trial_Power_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Gamma Power vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$Group == 4 & PerSubjectGamma$mgsLatency < excludeHigh & PerSubjectGamma$mgsLatency > excludeLow,], log10_Gamma_Trial_Power_SD ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$Group == 4 & PerSubjectGamma$mgsLatency < excludeHigh & PerSubjectGamma$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Gamma_Event_Duration )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Gamma Event Duration vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("Duration")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$Group == 4 & PerSubjectGamma$mgsLatency < excludeHigh & PerSubjectGamma$mgsLatency > excludeLow,], Gamma_Event_Duration ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$Group == 4 & PerSubjectGamma$mgsLatency < excludeHigh & PerSubjectGamma$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Gamma_Event_Duration_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Gamma Event Duration vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$Group == 4 & PerSubjectGamma$mgsLatency < excludeHigh & PerSubjectGamma$mgsLatency > excludeLow,], Gamma_Event_Duration_SD ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$Group == 4 & PerSubjectGamma$mgsLatency < excludeHigh & PerSubjectGamma$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Gamma_Event_Number )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Gamma Event Number vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$Group == 4 & PerSubjectGamma$mgsLatency < excludeHigh & PerSubjectGamma$mgsLatency > excludeLow,], Gamma_Event_Number ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$Group == 4 & PerSubjectGamma$mgsLatency < excludeHigh & PerSubjectGamma$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Gamma_Event_Number_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Gamma Event Number vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$Group == 4 & PerSubjectGamma$mgsLatency < excludeHigh & PerSubjectGamma$mgsLatency > excludeLow,], Gamma_Event_Number_SD ~ mgsLatency)
anova(lm.model)

```

## Alpha Frequency Band
### Position Error

```{r echo=FALSE, message=FALSE, warning=FALSE}

#outlier detection
avg_positionError <- aggregate(absPositionError ~ visitno, PerSubjectAlpha[], mean)
avg_positionError_SD <- aggregate(absPositionError ~ visitno, PerSubjectAlpha[], sd)
excludeHigh <- avg_positionError$absPositionError[1] + 3*avg_positionError_SD$absPositionError[1]
excludeLow <- avg_positionError$absPositionError[1] - 3*avg_positionError_SD$absPositionError[1]



ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$absPositionError < excludeHigh & PerSubjectAlpha$absPositionError > excludeLow,],  aes(x = absPositionError, y = log10_Alpha_Trial_Power_mean )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Alpha Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Power")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$absPositionError < excludeHigh & PerSubjectAlpha$absPositionError > excludeLow,], log10_Alpha_Trial_Power_mean ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$absPositionError < excludeHigh & PerSubjectAlpha$absPositionError > excludeLow,],  aes(x = absPositionError, y = log10_Alpha_Trial_Power_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Alpha Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$absPositionError < excludeHigh & PerSubjectAlpha$absPositionError > excludeLow,], log10_Alpha_Trial_Power_SD ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$absPositionError < excludeHigh & PerSubjectAlpha$absPositionError > excludeLow,],  aes(x = absPositionError, y = Alpha_Event_Duration )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Alpha Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Duration")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$absPositionError < excludeHigh & PerSubjectAlpha$absPositionError > excludeLow,], Alpha_Event_Duration ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$absPositionError < excludeHigh & PerSubjectAlpha$absPositionError > excludeLow,],  aes(x = absPositionError, y = Alpha_Event_Duration_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Alpha Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$absPositionError < excludeHigh & PerSubjectAlpha$absPositionError > excludeLow,], Alpha_Event_Duration_SD ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$absPositionError < excludeHigh & PerSubjectAlpha$absPositionError > excludeLow,],  aes(x = absPositionError, y = Alpha_Event_Number )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Alpha Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$absPositionError < excludeHigh & PerSubjectAlpha$absPositionError > excludeLow,], Alpha_Event_Number ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$absPositionError < excludeHigh & PerSubjectAlpha$absPositionError > excludeLow,],  aes(x = absPositionError, y = Alpha_Event_Number_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Alpha Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$absPositionError < excludeHigh & PerSubjectAlpha$absPositionError > excludeLow,], Alpha_Event_Number_SD ~ absPositionError)
anova(lm.model)

```

#### Adult Subjects Only
```{r echo=FALSE, message=FALSE, warning=FALSE}

#outlier detection
avg_positionError <- aggregate(absPositionError ~ visitno, PerSubjectAlpha[PerSubjectAlpha$Group == 4,], mean)
avg_positionError_SD <- aggregate(absPositionError ~ visitno, PerSubjectAlpha[PerSubjectAlpha$Group == 4,], sd)
excludeHigh <- avg_positionError$absPositionError[1] + 3*avg_positionError_SD$absPositionError[1]
excludeLow <- avg_positionError$absPositionError[1] - 3*avg_positionError_SD$absPositionError[1]

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$absPositionError < excludeHigh & PerSubjectAlpha$absPositionError > excludeLow & PerSubjectAlpha$Group == 4,],  aes(x = absPositionError, y = log10_Alpha_Trial_Power_mean )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Alpha Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Power")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$absPositionError < excludeHigh & PerSubjectAlpha$absPositionError > excludeLow & PerSubjectAlpha$Group == 4,], log10_Alpha_Trial_Power_mean ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$absPositionError < excludeHigh & PerSubjectAlpha$absPositionError > excludeLow & PerSubjectAlpha$Group == 4,],  aes(x = absPositionError, y = log10_Alpha_Trial_Power_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Alpha Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$absPositionError < excludeHigh & PerSubjectAlpha$absPositionError > excludeLow & PerSubjectAlpha$Group == 4,], log10_Alpha_Trial_Power_SD ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$absPositionError < excludeHigh & PerSubjectAlpha$absPositionError > excludeLow & PerSubjectAlpha$Group == 4,],  aes(x = absPositionError, y = Alpha_Event_Duration )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Alpha Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Duration")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$absPositionError < excludeHigh & PerSubjectAlpha$absPositionError > excludeLow & PerSubjectAlpha$Group == 4,], Alpha_Event_Duration ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$absPositionError < excludeHigh & PerSubjectAlpha$absPositionError > excludeLow & PerSubjectAlpha$Group == 4,],  aes(x = absPositionError, y = Alpha_Event_Duration_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Alpha Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$absPositionError < excludeHigh & PerSubjectAlpha$absPositionError > excludeLow & PerSubjectAlpha$Group == 4,], Alpha_Event_Duration_SD ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$absPositionError < excludeHigh & PerSubjectAlpha$absPositionError > excludeLow & PerSubjectAlpha$Group == 4,],  aes(x = absPositionError, y = Alpha_Event_Number )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Alpha Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2,], Alpha_Event_Number ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$absPositionError < excludeHigh & PerSubjectAlpha$absPositionError > excludeLow & PerSubjectAlpha$Group == 4,],  aes(x = absPositionError, y = Alpha_Event_Number_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Alpha Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$absPositionError < excludeHigh & PerSubjectAlpha$absPositionError > excludeLow & PerSubjectAlpha$Group == 4,], Alpha_Event_Number_SD ~ absPositionError)
anova(lm.model)

```

### MGS Latency

```{r echo=FALSE, message=FALSE, warning=FALSE}

#outlier detection 
avg_mgsLatency <- aggregate(mgsLatency ~ visitno, PerSubjectAlpha[], mean)
avg_mgsLatency_SD <- aggregate(mgsLatency ~ visitno, PerSubjectAlpha[], sd)
excludeHigh <- avg_mgsLatency$mgsLatency[1] + 3*avg_mgsLatency_SD$mgsLatency[1]
excludeLow <- avg_mgsLatency$mgsLatency[1] - 3*avg_mgsLatency_SD$mgsLatency[1]


ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$mgsLatency < excludeHigh & PerSubjectAlpha$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = log10_Alpha_Trial_Power_mean )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Alpha Power vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("Power")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$mgsLatency < excludeHigh & PerSubjectAlpha$mgsLatency > excludeLow,], log10_Alpha_Trial_Power_mean ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$mgsLatency < excludeHigh & PerSubjectAlpha$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = log10_Alpha_Trial_Power_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Alpha Power vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$mgsLatency < excludeHigh & PerSubjectAlpha$mgsLatency > excludeLow,], log10_Alpha_Trial_Power_SD ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$mgsLatency < excludeHigh & PerSubjectAlpha$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Alpha_Event_Duration )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Alpha Event Duration vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("Duration")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$mgsLatency < excludeHigh & PerSubjectAlpha$mgsLatency > excludeLow,], Alpha_Event_Duration ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$mgsLatency < excludeHigh & PerSubjectAlpha$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Alpha_Event_Duration_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Alpha Event Duration vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$mgsLatency < excludeHigh & PerSubjectAlpha$mgsLatency > excludeLow,], Alpha_Event_Duration_SD ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$mgsLatency < excludeHigh & PerSubjectAlpha$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Alpha_Event_Number )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Alpha Event Number vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$mgsLatency < excludeHigh & PerSubjectAlpha$mgsLatency > excludeLow,], Alpha_Event_Number ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$mgsLatency < excludeHigh & PerSubjectAlpha$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Alpha_Event_Number_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Alpha Event Number vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$mgsLatency < excludeHigh & PerSubjectAlpha$mgsLatency > excludeLow,], Alpha_Event_Number_SD ~ mgsLatency)
anova(lm.model)

```

#### Adult Subjects Only 
```{r echo=FALSE, message=FALSE, warning=FALSE}
#outlier detection
avg_mgsLatency <- aggregate(mgsLatency ~ visitno, PerSubjectAlpha[PerSubjectAlpha$Group == 4,], mean)
avg_mgsLatency_SD <- aggregate(mgsLatency ~ visitno, PerSubjectAlpha[PerSubjectAlpha$Group == 4,], sd)

excludeHigh <- avg_mgsLatency$mgsLatency[1] + 3*avg_mgsLatency_SD$mgsLatency[1]
excludeLow <- avg_mgsLatency$mgsLatency[1] - 3*avg_mgsLatency_SD$mgsLatency[1]


ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$mgsLatency < excludeHigh & PerSubjectAlpha$mgsLatency > excludeLow & PerSubjectAlpha$Group == 4,],  aes(x = mgsLatency, y = log10_Alpha_Trial_Power_mean )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Alpha Power vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("Power")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$mgsLatency < excludeHigh & PerSubjectAlpha$mgsLatency > excludeLow & PerSubjectAlpha$Group == 4,], log10_Alpha_Trial_Power_mean ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$mgsLatency < excludeHigh & PerSubjectAlpha$mgsLatency > excludeLow & PerSubjectAlpha$Group == 4,],  aes(x = mgsLatency, y = log10_Alpha_Trial_Power_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Alpha Power vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$mgsLatency < excludeHigh & PerSubjectAlpha$mgsLatency > excludeLow & PerSubjectAlpha$Group == 4,], log10_Alpha_Trial_Power_SD ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$mgsLatency < excludeHigh & PerSubjectAlpha$mgsLatency > excludeLow & PerSubjectAlpha$Group == 4,],  aes(x = mgsLatency, y = Alpha_Event_Duration )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Alpha Event Duration vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("Duration")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$mgsLatency < excludeHigh & PerSubjectAlpha$mgsLatency > excludeLow & PerSubjectAlpha$Group == 4,], Alpha_Event_Duration ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$mgsLatency < excludeHigh & PerSubjectAlpha$mgsLatency > excludeLow & PerSubjectAlpha$Group == 4,],  aes(x = mgsLatency, y = Alpha_Event_Duration_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Alpha Event Duration vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$mgsLatency < excludeHigh & PerSubjectAlpha$mgsLatency > excludeLow & PerSubjectAlpha$Group == 4,], Alpha_Event_Duration_SD ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$mgsLatency < excludeHigh & PerSubjectAlpha$mgsLatency > excludeLow & PerSubjectAlpha$Group == 4,],  aes(x = mgsLatency, y = Alpha_Event_Number )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Alpha Event Number vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$mgsLatency < excludeHigh & PerSubjectAlpha$mgsLatency > excludeLow & PerSubjectAlpha$Group == 4,], Alpha_Event_Number ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$mgsLatency < excludeHigh & PerSubjectAlpha$mgsLatency > excludeLow & PerSubjectAlpha$Group == 4,],  aes(x = mgsLatency, y = Alpha_Event_Number_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Alpha Event Number vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$mgsLatency < excludeHigh & PerSubjectAlpha$mgsLatency > excludeLow & PerSubjectAlpha$Group == 4,], Alpha_Event_Number_SD ~ mgsLatency)
anova(lm.model)

```

## Theta Frequency Band
### Position Error

```{r echo=FALSE, message=FALSE, warning=FALSE}

#outlier detection
avg_positionError <- aggregate(absPositionError ~ visitno, PerSubjectTheta[], mean)
avg_positionError_SD <- aggregate(absPositionError ~ visitno, PerSubjectTheta[], sd)
excludeHigh <- avg_positionError$absPositionError[1] + 3*avg_positionError_SD$absPositionError[1]
excludeLow <- avg_positionError$absPositionError[1] - 3*avg_positionError_SD$absPositionError[1]


ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2  & PerSubjectTheta$absPositionError < excludeHigh & PerSubjectTheta$absPositionError > excludeLow,],  aes(x = absPositionError, y = log10_Theta_Trial_Power_mean )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Theta Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Power")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2  & PerSubjectTheta$absPositionError < excludeHigh & PerSubjectTheta$absPositionError > excludeLow,], log10_Theta_Trial_Power_mean ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2  & PerSubjectTheta$absPositionError < excludeHigh & PerSubjectTheta$absPositionError > excludeLow,],  aes(x = absPositionError, y = log10_Theta_Trial_Power_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Theta Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$absPositionError < excludeHigh & PerSubjectTheta$absPositionError > excludeLow,], log10_Theta_Trial_Power_SD ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2  & PerSubjectTheta$absPositionError < excludeHigh & PerSubjectTheta$absPositionError > excludeLow,],  aes(x = absPositionError, y = Theta_Event_Duration )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Theta Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Duration")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2  & PerSubjectTheta$absPositionError < excludeHigh & PerSubjectTheta$absPositionError > excludeLow,], Theta_Event_Duration ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$absPositionError < excludeHigh & PerSubjectTheta$absPositionError > excludeLow,],  aes(x = absPositionError, y = Theta_Event_Duration_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Theta Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2  & PerSubjectTheta$absPositionError < excludeHigh & PerSubjectTheta$absPositionError > excludeLow,], Theta_Event_Duration_SD ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2  & PerSubjectTheta$absPositionError < excludeHigh & PerSubjectTheta$absPositionError > excludeLow,],  aes(x = absPositionError, y = Theta_Event_Number )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Theta Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2  & PerSubjectTheta$absPositionError < excludeHigh & PerSubjectTheta$absPositionError > excludeLow,], Theta_Event_Number ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2  & PerSubjectTheta$absPositionError < excludeHigh & PerSubjectTheta$absPositionError > excludeLow,],  aes(x = absPositionError, y = Theta_Event_Number_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Theta Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2  & PerSubjectTheta$absPositionError < excludeHigh & PerSubjectTheta$absPositionError > excludeLow,], Theta_Event_Number_SD ~ absPositionError)
anova(lm.model)

```

#### Adult Subjects Only
```{r echo=FALSE, message=FALSE, warning=FALSE}


#outlier detection
avg_positionError <- aggregate(absPositionError ~ visitno, PerSubjectTheta[PerSubjectTheta$Group == 4,], mean)
avg_positionError_SD <- aggregate(absPositionError ~ visitno, PerSubjectTheta[PerSubjectTheta$Group == 4,], sd)
excludeHigh <- avg_positionError$absPositionError[1] + 3*avg_positionError_SD$absPositionError[1]
excludeLow <- avg_positionError$absPositionError[1] - 3*avg_positionError_SD$absPositionError[1]


ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$absPositionError < excludeHigh & PerSubjectTheta$absPositionError > excludeLow & PerSubjectTheta$Group == 4,],  aes(x = absPositionError, y = log10_Theta_Trial_Power_mean )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Theta Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Power")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$absPositionError < excludeHigh & PerSubjectTheta$absPositionError > excludeLow & PerSubjectTheta$Group == 4,], log10_Theta_Trial_Power_mean ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$absPositionError < excludeHigh & PerSubjectTheta$absPositionError > excludeLow & PerSubjectTheta$Group == 4,],  aes(x = absPositionError, y = log10_Theta_Trial_Power_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Theta Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$absPositionError < excludeHigh & PerSubjectTheta$absPositionError > excludeLow & PerSubjectTheta$Group == 4,], log10_Theta_Trial_Power_SD ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$absPositionError < excludeHigh & PerSubjectTheta$absPositionError > excludeLow & PerSubjectTheta$Group == 4,],  aes(x = absPositionError, y = Theta_Event_Duration )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Theta Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Duration")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$absPositionError < excludeHigh & PerSubjectTheta$absPositionError > excludeLow & PerSubjectTheta$Group == 4,], Theta_Event_Duration ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$absPositionError < excludeHigh & PerSubjectTheta$absPositionError > excludeLow & PerSubjectTheta$Group == 4,],  aes(x = absPositionError, y = Theta_Event_Duration_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Theta Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$absPositionError < excludeHigh & PerSubjectTheta$absPositionError > excludeLow & PerSubjectTheta$Group == 4,], Theta_Event_Duration_SD ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$absPositionError < excludeHigh & PerSubjectTheta$absPositionError > excludeLow & PerSubjectTheta$Group == 4,],  aes(x = absPositionError, y = Theta_Event_Number )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Theta Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$absPositionError < excludeHigh & PerSubjectTheta$absPositionError > excludeLow & PerSubjectTheta$Group == 4,], Theta_Event_Number ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$absPositionError < excludeHigh & PerSubjectTheta$absPositionError > excludeLow & PerSubjectTheta$Group == 4,],  aes(x = absPositionError, y = Theta_Event_Number_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Theta Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$absPositionError < excludeHigh & PerSubjectTheta$absPositionError > excludeLow & PerSubjectTheta$Group == 4,], Theta_Event_Number_SD ~ absPositionError)
anova(lm.model)

```

### MGS Latency

```{r echo=FALSE, message=FALSE, warning=FALSE}

#outlier detection 
avg_mgsLatency <- aggregate(mgsLatency ~ visitno, PerSubjectTheta[], mean)
avg_mgsLatency_SD <- aggregate(mgsLatency ~ visitno, PerSubjectTheta[], sd)
excludeHigh <- avg_mgsLatency$mgsLatency[1] + 3*avg_mgsLatency_SD$mgsLatency[1]
excludeLow <- avg_mgsLatency$mgsLatency[1] - 3*avg_mgsLatency_SD$mgsLatency[1]


ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$mgsLatency < excludeHigh & PerSubjectTheta$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = log10_Theta_Trial_Power_mean )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Theta Power vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("Power")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$mgsLatency < excludeHigh & PerSubjectTheta$mgsLatency > excludeLow,], log10_Theta_Trial_Power_mean ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$mgsLatency < excludeHigh & PerSubjectTheta$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = log10_Theta_Trial_Power_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Theta Power vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$mgsLatency < excludeHigh & PerSubjectTheta$mgsLatency > excludeLow,], log10_Theta_Trial_Power_SD ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$mgsLatency < excludeHigh & PerSubjectTheta$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Theta_Event_Duration )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Theta Event Duration vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("Duration")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$mgsLatency < excludeHigh & PerSubjectTheta$mgsLatency > excludeLow,], Theta_Event_Duration ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$mgsLatency < excludeHigh & PerSubjectTheta$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Theta_Event_Duration_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Theta Event Duration vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$mgsLatency < excludeHigh & PerSubjectTheta$mgsLatency > excludeLow,], Theta_Event_Duration_SD ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$mgsLatency < excludeHigh & PerSubjectTheta$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Theta_Event_Number )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Theta Event Number vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$mgsLatency < excludeHigh & PerSubjectTheta$mgsLatency > excludeLow,], Theta_Event_Number ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$mgsLatency < excludeHigh & PerSubjectTheta$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Theta_Event_Number_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Theta Event Number vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$mgsLatency < excludeHigh & PerSubjectTheta$mgsLatency > excludeLow,], Theta_Event_Number_SD ~ mgsLatency)
anova(lm.model)

```

#### Adult Subjects Only
```{r echo=FALSE, message=FALSE, warning=FALSE}

#outlier detection 
avg_mgsLatency <- aggregate(mgsLatency ~ visitno, PerSubjectTheta[PerSubjectTheta$Group == 4,], mean)
avg_mgsLatency_SD <- aggregate(mgsLatency ~ visitno, PerSubjectTheta[PerSubjectTheta$Group == 4,], sd)

excludeHigh <- avg_mgsLatency$mgsLatency[1] + 3*avg_mgsLatency_SD$mgsLatency[1]
excludeLow <- avg_mgsLatency$mgsLatency[1] - 3*avg_mgsLatency_SD$mgsLatency[1]


ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$mgsLatency < excludeHigh & PerSubjectTheta$mgsLatency > excludeLow & PerSubjectTheta$Group == 4,],  aes(x = mgsLatency, y = log10_Theta_Trial_Power_mean )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Theta Power vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("Power")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$mgsLatency < excludeHigh & PerSubjectTheta$mgsLatency > excludeLow & PerSubjectTheta$Group == 4,], log10_Theta_Trial_Power_mean ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$mgsLatency < excludeHigh & PerSubjectTheta$mgsLatency > excludeLow & PerSubjectTheta$Group == 4,],  aes(x = mgsLatency, y = log10_Theta_Trial_Power_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Theta Power vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$mgsLatency < excludeHigh & PerSubjectTheta$mgsLatency > excludeLow & PerSubjectTheta$Group == 4,], log10_Theta_Trial_Power_SD ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$mgsLatency < excludeHigh & PerSubjectTheta$mgsLatency > excludeLow & PerSubjectTheta$Group == 4,],  aes(x = mgsLatency, y = Theta_Event_Duration )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Theta Event Duration vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("Duration")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$mgsLatency < excludeHigh & PerSubjectTheta$mgsLatency > excludeLow & PerSubjectTheta$Group == 4,], Theta_Event_Duration ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$mgsLatency < excludeHigh & PerSubjectTheta$mgsLatency > excludeLow & PerSubjectTheta$Group == 4,],  aes(x = mgsLatency, y = Theta_Event_Duration_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Theta Event Duration vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$mgsLatency < excludeHigh & PerSubjectTheta$mgsLatency > excludeLow & PerSubjectTheta$Group == 4,], Theta_Event_Duration_SD ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$mgsLatency < excludeHigh & PerSubjectTheta$mgsLatency > excludeLow & PerSubjectTheta$Group == 4,],  aes(x = mgsLatency, y = Theta_Event_Number )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Theta Event Number vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$mgsLatency < excludeHigh & PerSubjectTheta$mgsLatency > excludeLow & PerSubjectTheta$Group == 4,], Theta_Event_Number ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$mgsLatency < excludeHigh & PerSubjectTheta$mgsLatency > excludeLow & PerSubjectTheta$Group == 4,],  aes(x = mgsLatency, y = Theta_Event_Number_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Theta Event Number vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$mgsLatency < excludeHigh & PerSubjectTheta$mgsLatency > excludeLow & PerSubjectTheta$Group == 4,], Theta_Event_Number_SD ~ mgsLatency)
anova(lm.model)

```

## Beta Frequency Band
### Position Error

```{r echo=FALSE, message=FALSE, warning=FALSE}

#outlier detection
avg_positionError <- aggregate(absPositionError ~ visitno, PerSubjectBeta[], mean)
avg_positionError_SD <- aggregate(absPositionError ~ visitno, PerSubjectBeta[], sd)
excludeHigh <- avg_positionError$absPositionError[1] + 3*avg_positionError_SD$absPositionError[1]
excludeLow <- avg_positionError$absPositionError[1] - 3*avg_positionError_SD$absPositionError[1]

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$absPositionError < excludeHigh & PerSubjectBeta$absPositionError > excludeLow,],  aes(x = absPositionError, y = log10_Beta_Trial_Power_mean )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Beta Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Power")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$absPositionError < excludeHigh & PerSubjectBeta$absPositionError > excludeLow,], log10_Beta_Trial_Power_mean ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$absPositionError < excludeHigh & PerSubjectBeta$absPositionError > excludeLow,],  aes(x = absPositionError, y = log10_Beta_Trial_Power_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Beta Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$absPositionError < excludeHigh & PerSubjectBeta$absPositionError > excludeLow,], log10_Beta_Trial_Power_SD ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$absPositionError < excludeHigh & PerSubjectBeta$absPositionError > excludeLow,],  aes(x = absPositionError, y = Beta_Event_Duration )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Beta Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Duration")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$absPositionError < excludeHigh & PerSubjectBeta$absPositionError > excludeLow,], Beta_Event_Duration ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$absPositionError < excludeHigh & PerSubjectBeta$absPositionError > excludeLow,],  aes(x = absPositionError, y = Beta_Event_Duration_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Beta Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$absPositionError < excludeHigh & PerSubjectBeta$absPositionError > excludeLow,], Beta_Event_Duration_SD ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$absPositionError < excludeHigh & PerSubjectBeta$absPositionError > excludeLow,],  aes(x = absPositionError, y = Beta_Event_Number )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Beta Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$absPositionError < excludeHigh & PerSubjectBeta$absPositionError > excludeLow,], Beta_Event_Number ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$absPositionError < excludeHigh & PerSubjectBeta$absPositionError > excludeLow,],  aes(x = absPositionError, y = Beta_Event_Number_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Beta Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$absPositionError < excludeHigh & PerSubjectBeta$absPositionError > excludeLow,], Beta_Event_Number_SD ~ absPositionError)
anova(lm.model)

```

#### Adult Subjects Only 
```{r echo=FALSE, message=FALSE, warning=FALSE}

#outlier detection
avg_positionError <- aggregate(absPositionError ~ visitno, PerSubjectBeta[PerSubjectBeta$Group == 4,], mean)
avg_positionError_SD <- aggregate(absPositionError ~ visitno, PerSubjectBeta[PerSubjectBeta$Group == 4,], sd)
excludeHigh <- avg_positionError$absPositionError[1] + 3*avg_positionError_SD$absPositionError[1]
excludeLow <- avg_positionError$absPositionError[1] - 3*avg_positionError_SD$absPositionError[1]

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$absPositionError < excludeHigh & PerSubjectBeta$absPositionError > excludeLow & PerSubjectBeta$Group == 4,],  aes(x = absPositionError, y = log10_Beta_Trial_Power_mean )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Beta Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Power")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$absPositionError < excludeHigh & PerSubjectBeta$absPositionError > excludeLow & PerSubjectBeta$Group == 4,], log10_Beta_Trial_Power_mean ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$absPositionError < excludeHigh & PerSubjectBeta$absPositionError > excludeLow & PerSubjectBeta$Group == 4,],  aes(x = absPositionError, y = log10_Beta_Trial_Power_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Beta Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$absPositionError < excludeHigh & PerSubjectBeta$absPositionError > excludeLow & PerSubjectBeta$Group == 4,], log10_Beta_Trial_Power_SD ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$absPositionError < excludeHigh & PerSubjectBeta$absPositionError > excludeLow & PerSubjectBeta$Group == 4,],  aes(x = absPositionError, y = Beta_Event_Duration )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Beta Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Duration")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$absPositionError < excludeHigh & PerSubjectBeta$absPositionError > excludeLow & PerSubjectBeta$Group == 4,], Beta_Event_Duration ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$absPositionError < excludeHigh & PerSubjectBeta$absPositionError > excludeLow & PerSubjectBeta$Group == 4,],  aes(x = absPositionError, y = Beta_Event_Duration_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Beta Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$absPositionError < excludeHigh & PerSubjectBeta$absPositionError > excludeLow & PerSubjectBeta$Group == 4,], Beta_Event_Duration_SD ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$absPositionError < excludeHigh & PerSubjectBeta$absPositionError > excludeLow & PerSubjectBeta$Group == 4,],  aes(x = absPositionError, y = Beta_Event_Number )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Beta Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$absPositionError < excludeHigh & PerSubjectBeta$absPositionError > excludeLow & PerSubjectBeta$Group == 4,], Beta_Event_Number ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$absPositionError < excludeHigh & PerSubjectBeta$absPositionError > excludeLow & PerSubjectBeta$Group == 4,],  aes(x = absPositionError, y = Beta_Event_Number_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Beta Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$absPositionError < excludeHigh & PerSubjectBeta$absPositionError > excludeLow & PerSubjectBeta$Group == 4,], Beta_Event_Number_SD ~ absPositionError)
anova(lm.model)

```

### MGS Latency

```{r echo=FALSE, message=FALSE, warning=FALSE}

#outlier detection 
avg_mgsLatency <- aggregate(mgsLatency ~ visitno, PerSubjectBeta[], mean)
avg_mgsLatency_SD <- aggregate(mgsLatency ~ visitno, PerSubjectBeta[], sd)
excludeHigh <- avg_mgsLatency$mgsLatency[1] + 3*avg_mgsLatency_SD$mgsLatency[1]
excludeLow <- avg_mgsLatency$mgsLatency[1] - 3*avg_mgsLatency_SD$mgsLatency[1]


ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno <2 & PerSubjectBeta$mgsLatency < excludeHigh & PerSubjectBeta$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = log10_Beta_Trial_Power_mean )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Beta Power vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("Power")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno <2 & PerSubjectBeta$mgsLatency < excludeHigh & PerSubjectBeta$mgsLatency > excludeLow,], log10_Beta_Trial_Power_mean ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno <2 & PerSubjectBeta$mgsLatency < excludeHigh & PerSubjectBeta$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = log10_Beta_Trial_Power_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Beta Power vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno <2 & PerSubjectBeta$mgsLatency < excludeHigh & PerSubjectBeta$mgsLatency > excludeLow,], log10_Beta_Trial_Power_SD ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno <2 & PerSubjectBeta$mgsLatency < excludeHigh & PerSubjectBeta$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Beta_Event_Duration )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Beta Event Duration vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("Duration")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno <2 & PerSubjectBeta$mgsLatency < excludeHigh & PerSubjectBeta$mgsLatency > excludeLow,], Beta_Event_Duration ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno <2 & PerSubjectBeta$mgsLatency < excludeHigh & PerSubjectBeta$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Beta_Event_Duration_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Beta Event Duration vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno <2 & PerSubjectBeta$mgsLatency < excludeHigh & PerSubjectBeta$mgsLatency > excludeLow,], Beta_Event_Duration_SD ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno <2 & PerSubjectBeta$mgsLatency < excludeHigh & PerSubjectBeta$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Beta_Event_Number )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Beta Event Number vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno <2 & PerSubjectBeta$mgsLatency < excludeHigh & PerSubjectBeta$mgsLatency > excludeLow,], Beta_Event_Number ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno <2 & PerSubjectBeta$mgsLatency < excludeHigh & PerSubjectBeta$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Beta_Event_Number_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Beta Event Number vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno <2 & PerSubjectBeta$mgsLatency < excludeHigh & PerSubjectBeta$mgsLatency > excludeLow,], Beta_Event_Number_SD ~ mgsLatency)
anova(lm.model)

```

#### Adult Subjects Only 
```{r echo=FALSE, message=FALSE, warning=FALSE}

#outlier detection 
avg_mgsLatency <- aggregate(mgsLatency ~ visitno, PerSubjectBeta[PerSubjectBeta$Group == 4,], mean)
avg_mgsLatency_SD <- aggregate(mgsLatency ~ visitno, PerSubjectBeta[PerSubjectBeta$Group == 4,], sd)

excludeHigh <- avg_mgsLatency$mgsLatency[1] + 3*avg_mgsLatency_SD$mgsLatency[1]
excludeLow <- avg_mgsLatency$mgsLatency[1] - 3*avg_mgsLatency_SD$mgsLatency[1]


ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno <2 & PerSubjectBeta$mgsLatency < excludeHigh & PerSubjectBeta$mgsLatency > excludeLow & PerSubjectBeta$Group == 4,],  aes(x = mgsLatency, y = log10_Beta_Trial_Power_mean )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Beta Power vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("Power")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno <2 & PerSubjectBeta$mgsLatency < excludeHigh & PerSubjectBeta$mgsLatency > excludeLow & PerSubjectBeta$Group == 4,], log10_Beta_Trial_Power_mean ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno <2 & PerSubjectBeta$mgsLatency < excludeHigh & PerSubjectBeta$mgsLatency > excludeLow & PerSubjectBeta$Group == 4,],  aes(x = mgsLatency, y = log10_Beta_Trial_Power_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Beta Power vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno <2 & PerSubjectBeta$mgsLatency < excludeHigh & PerSubjectBeta$mgsLatency > excludeLow & PerSubjectBeta$Group == 4,], log10_Beta_Trial_Power_SD ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno <2 & PerSubjectBeta$mgsLatency < excludeHigh & PerSubjectBeta$mgsLatency > excludeLow & PerSubjectBeta$Group == 4,],  aes(x = mgsLatency, y = Beta_Event_Duration )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Beta Event Duration vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("Duration")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno <2 & PerSubjectBeta$mgsLatency < excludeHigh & PerSubjectBeta$mgsLatency > excludeLow & PerSubjectBeta$Group == 4,], Beta_Event_Duration ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno <2 & PerSubjectBeta$mgsLatency < excludeHigh & PerSubjectBeta$mgsLatency > excludeLow & PerSubjectBeta$Group == 4,],  aes(x = mgsLatency, y = Beta_Event_Duration_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Beta Event Duration vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno <2 & PerSubjectBeta$mgsLatency < excludeHigh & PerSubjectBeta$mgsLatency > excludeLow & PerSubjectBeta$Group == 4,], Beta_Event_Duration_SD ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno <2 & PerSubjectBeta$mgsLatency < excludeHigh & PerSubjectBeta$mgsLatency > excludeLow & PerSubjectBeta$Group == 4,],  aes(x = mgsLatency, y = Beta_Event_Number )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Beta Event Number vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno <2 & PerSubjectBeta$mgsLatency < excludeHigh & PerSubjectBeta$mgsLatency > excludeLow & PerSubjectBeta$Group == 4,], Beta_Event_Number ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno <2 & PerSubjectBeta$mgsLatency < excludeHigh & PerSubjectBeta$mgsLatency > excludeLow & PerSubjectBeta$Group == 4,],  aes(x = mgsLatency, y = Beta_Event_Number_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Beta Event Number vs Latency") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Latency") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno <2 & PerSubjectBeta$mgsLatency < excludeHigh & PerSubjectBeta$mgsLatency > excludeLow & PerSubjectBeta$Group == 4,], Beta_Event_Number_SD ~ mgsLatency)
anova(lm.model)

```






# Delay Period 2-3 Seconds: Frequency Bands Across Age


```{r echo=FALSE, message=FALSE, warning=FALSE}
GammaT  <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Gamma/Delay2_3/Gamma_all_data2_3.csv')
AlphaT  <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Alpha/Delay2_3/Alpha_all_data2_3.csv')
BetaT  <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Beta/Delay2_3/Beta_all_data2_3.csv')
ThetaT  <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Theta/Delay2_3/Theta_all_data2_3.csv')
agefile <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/agefile.csv')
agefile$Subject <- agefile$idvalues 

GrandTable <- merge(GammaT, AlphaT, by = c('Subject', 'Trial'), all.x = TRUE, all.y = TRUE)
GrandTable <- merge(GrandTable, BetaT, by = c('Subject', 'Trial'), all.x = TRUE, all.y = TRUE)
GrandTable <- merge(GrandTable, ThetaT, by = c('Subject', 'Trial'), all.x = TRUE, all.y = TRUE)
GrandTable <- merge(GrandTable, agefile, by = 'Subject', all.x = TRUE, all.y = TRUE)

GrandTable$log10_Gamma_Trial_Power <- log10(GrandTable$Gamma_Trial_Power)
GrandTable$log10_Theta_Trial_Power <- log10(GrandTable$Theta_Trial_Power)
GrandTable$log10_Beta_Trial_Power <- log10(GrandTable$Beta_Trial_Power)
GrandTable$log10_Alpha_Trial_Power <- log10(GrandTable$Alpha_Trial_Power)


Behavior <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Behavior.csv')

Behavior$Subject <- paste0(Behavior$LunaID, '_', Behavior$ScanDate)
Behavior <- merge(Behavior, agefile, by = 'Subject', all.x = TRUE, all.y = TRUE)

Everything <- merge(GrandTable, Behavior, by = c('Subject', 'Trial'), all.x = TRUE, all.y = TRUE)
Everything$absPositionError <- abs(Everything$PositionError)

## average across trials 
#gamma
Avg_log10_gamma_power <- aggregate(log10_Gamma_Trial_Power ~ Subject, Everything[Everything$log10_Gamma_Trial_Power != '-Inf',], mean)
TrialVar_log10_gamma_power <- aggregate(log10_Gamma_Trial_Power ~ Subject, Everything[Everything$log10_Gamma_Trial_Power != '-Inf',], sd)
PerSubjectGamma <- merge(Avg_log10_gamma_power, TrialVar_log10_gamma_power, by = 'Subject', suffix = c("_mean", "_SD") )
PerSubjectGamma <- merge(PerSubjectGamma, agefile, by= 'Subject')

Avg_gamma_duration <- aggregate(Gamma_Event_Duration ~ Subject, Everything, mean)
TrialVar_gamma_duration <- aggregate(Gamma_Event_Duration ~ Subject, Everything, sd)
PerSubjectGamma <- merge(PerSubjectGamma, Avg_gamma_duration, by= 'Subject', suffix = c("", "_mean"))
PerSubjectGamma <- merge(PerSubjectGamma, TrialVar_gamma_duration, by= 'Subject', suffix = c("", "_SD"))

Avg_gamma_event_number <- aggregate(Gamma_Event_Number ~ Subject, Everything, mean)
TrialVar_gamma_event_number <- aggregate(Gamma_Event_Number ~ Subject, Everything, sd)
PerSubjectGamma <- merge(PerSubjectGamma, Avg_gamma_event_number, by= 'Subject', suffix = c("", "_mean"))
PerSubjectGamma <- merge(PerSubjectGamma, TrialVar_gamma_event_number, by= 'Subject', suffix = c("", "_SD"))
PerSubjectGamma$ageInverse = 1/PerSubjectGamma$age

avg_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, mean)
SD_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, sd)

PerSubjectGamma <- merge(PerSubjectGamma, avg_abs_PositionError, by= 'Subject',suffix = c("", "_mean"))
PerSubjectGamma <- merge(PerSubjectGamma, SD_abs_PositionError, by= 'Subject', suffix = c("", "_SD"))

avg_Latency <- aggregate(mgsLatency ~ Subject, Everything, mean)
SD_Latency <- aggregate(mgsLatency ~ Subject, Everything, sd)

PerSubjectGamma <- merge(PerSubjectGamma, avg_Latency, by = 'Subject',suffix = c("", "_mean"))
PerSubjectGamma <- merge(PerSubjectGamma, SD_Latency, by = 'Subject', suffix = c("", "_SD"))


#alpha
Avg_log10_alpha_power <- aggregate(log10_Alpha_Trial_Power ~ Subject, Everything[Everything$log10_Alpha_Trial_Power != '-Inf',], mean)
TrialVar_log10_alpha_power <- aggregate(log10_Alpha_Trial_Power ~ Subject, Everything[Everything$log10_Alpha_Trial_Power != '-Inf',], sd)
PerSubjectAlpha <- merge(Avg_log10_alpha_power, TrialVar_log10_alpha_power, by = 'Subject', suffix = c("_mean", "_SD") )
PerSubjectAlpha <- merge(PerSubjectAlpha, agefile, by= 'Subject')

Avg_alpha_duration <- aggregate(Alpha_Event_Duration ~ Subject, Everything, mean)
TrialVar_alpha_duration <- aggregate(Alpha_Event_Duration ~ Subject, Everything, sd)
PerSubjectAlpha <- merge(PerSubjectAlpha, Avg_alpha_duration, by= 'Subject', suffix = c("", "_mean"))
PerSubjectAlpha <- merge(PerSubjectAlpha, TrialVar_alpha_duration, by= 'Subject', suffix = c("", "_SD"))

Avg_alpha_event_number <- aggregate(Alpha_Event_Number ~ Subject, Everything, mean)
TrialVar_alpha_event_number <- aggregate(Alpha_Event_Number ~ Subject, Everything, sd)
PerSubjectAlpha <- merge(PerSubjectAlpha, Avg_alpha_event_number, by= 'Subject', suffix = c("", "_mean"))
PerSubjectAlpha <- merge(PerSubjectAlpha, TrialVar_alpha_event_number, by= 'Subject', suffix = c("", "_SD"))
PerSubjectAlpha$ageInverse = 1/PerSubjectAlpha$age

avg_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, mean)
SD_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, sd)

PerSubjectAlpha <- merge(PerSubjectAlpha, avg_abs_PositionError, by= 'Subject',suffix = c("", "_mean"))
PerSubjectAlpha <- merge(PerSubjectAlpha, SD_abs_PositionError, by= 'Subject', suffix = c("", "_SD"))

avg_Latency <- aggregate(mgsLatency ~ Subject, Everything, mean)
SD_Latency <- aggregate(mgsLatency ~ Subject, Everything, sd)

PerSubjectAlpha <- merge(PerSubjectAlpha, avg_Latency, by = 'Subject',suffix = c("", "_mean"))
PerSubjectAlpha <- merge(PerSubjectAlpha, SD_Latency, by = 'Subject', suffix = c("", "_SD"))

#theta
Avg_log10_theta_power <- aggregate(log10_Theta_Trial_Power ~ Subject, Everything[Everything$log10_Theta_Trial_Power != '-Inf',], mean)
TrialVar_log10_theta_power <- aggregate(log10_Theta_Trial_Power ~ Subject, Everything[Everything$log10_Theta_Trial_Power != '-Inf',], sd)
PerSubjectTheta <- merge(Avg_log10_theta_power, TrialVar_log10_theta_power, by = 'Subject', suffix = c("_mean", "_SD") )
PerSubjectTheta <- merge(PerSubjectTheta, agefile, by= 'Subject')

Avg_theta_duration <- aggregate(Theta_Event_Duration ~ Subject, Everything, mean)
TrialVar_theta_duration <- aggregate(Theta_Event_Duration ~ Subject, Everything, sd)
PerSubjectTheta <- merge(PerSubjectTheta, Avg_theta_duration, by= 'Subject', suffix = c("", "_mean"))
PerSubjectTheta <- merge(PerSubjectTheta, TrialVar_theta_duration, by= 'Subject', suffix = c("", "_SD"))

Avg_theta_event_number <- aggregate(Theta_Event_Number ~ Subject, Everything, mean)
TrialVar_theta_event_number <- aggregate(Theta_Event_Number ~ Subject, Everything, sd)
PerSubjectTheta <- merge(PerSubjectTheta, Avg_theta_event_number, by= 'Subject', suffix = c("", "_mean"))
PerSubjectTheta <- merge(PerSubjectTheta, TrialVar_theta_event_number, by= 'Subject', suffix = c("", "_SD"))
PerSubjectTheta$ageInverse = 1/PerSubjectTheta$age

avg_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, mean)
SD_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, sd)

PerSubjectTheta <- merge(PerSubjectTheta, avg_abs_PositionError, by= 'Subject',suffix = c("", "_mean"))
PerSubjectTheta <- merge(PerSubjectTheta, SD_abs_PositionError, by= 'Subject', suffix = c("", "_SD"))

avg_Latency <- aggregate(mgsLatency ~ Subject, Everything, mean)
SD_Latency <- aggregate(mgsLatency ~ Subject, Everything, sd)

PerSubjectTheta <- merge(PerSubjectTheta, avg_Latency, by = 'Subject',suffix = c("", "_mean"))
PerSubjectTheta <- merge(PerSubjectTheta, SD_Latency, by = 'Subject', suffix = c("", "_SD"))

#beta
Avg_log10_beta_power <- aggregate(log10_Beta_Trial_Power ~ Subject, Everything[Everything$log10_Beta_Trial_Power != '-Inf',], mean)
TrialVar_log10_beta_power <- aggregate(log10_Beta_Trial_Power ~ Subject, Everything[Everything$log10_Beta_Trial_Power != '-Inf',], sd)
PerSubjectBeta <- merge(Avg_log10_beta_power, TrialVar_log10_beta_power, by = 'Subject', suffix = c("_mean", "_SD") )
PerSubjectBeta <- merge(PerSubjectBeta, agefile, by= 'Subject')

Avg_beta_duration <- aggregate(Beta_Event_Duration ~ Subject, Everything, mean)
TrialVar_beta_duration <- aggregate(Beta_Event_Duration ~ Subject, Everything, sd)
PerSubjectBeta <- merge(PerSubjectBeta, Avg_beta_duration, by= 'Subject', suffix = c("", "_mean"))
PerSubjectBeta <- merge(PerSubjectBeta, TrialVar_beta_duration, by= 'Subject', suffix = c("", "_SD"))

Avg_beta_event_number <- aggregate(Beta_Event_Number ~ Subject, Everything, mean)
TrialVar_beta_event_number <- aggregate(Beta_Event_Number ~ Subject, Everything, sd)
PerSubjectBeta <- merge(PerSubjectBeta, Avg_beta_event_number, by= 'Subject', suffix = c("", "_mean"))
PerSubjectBeta <- merge(PerSubjectBeta, TrialVar_beta_event_number, by= 'Subject', suffix = c("", "_SD"))
PerSubjectBeta$ageInverse = 1/PerSubjectBeta$age

avg_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, mean)
SD_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, sd)

PerSubjectBeta <- merge(PerSubjectBeta, avg_abs_PositionError, by= 'Subject',suffix = c("", "_mean"))
PerSubjectBeta <- merge(PerSubjectBeta, SD_abs_PositionError, by= 'Subject', suffix = c("", "_SD"))

avg_Latency <- aggregate(mgsLatency ~ Subject, Everything, mean)
SD_Latency <- aggregate(mgsLatency ~ Subject, Everything, sd)

PerSubjectBeta <- merge(PerSubjectBeta, avg_Latency, by = 'Subject',suffix = c("", "_mean"))
PerSubjectBeta <- merge(PerSubjectBeta, SD_Latency, by = 'Subject', suffix = c("", "_SD"))


## plots
#frequency vs age 
```

## Gamma Frequency Band

```{r, echo= FALSE, message = FALSE, warning = FALSE, fig.margin = TRUE}
#gamma

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2,],  aes(x = age, y = log10_Gamma_Trial_Power_mean )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Gamma Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power")

lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2,], log10_Gamma_Trial_Power_mean ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2,],  aes(x = age, y = log10_Gamma_Trial_Power_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Gamma Power vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2,], log10_Gamma_Trial_Power_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2,],  aes(x = age, y = Gamma_Event_Duration)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Gamma Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("Duration")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2,], Gamma_Event_Duration ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2,],  aes(x = age, y = Gamma_Event_Duration_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Varibaility of Gamma Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2,], Gamma_Event_Duration_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2,],  aes(x = age, y = Gamma_Event_Number )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Average Gamma Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2,], Gamma_Event_Number ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2,],  aes(x = age, y = Gamma_Event_Number_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Varibaility of Gamma Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2,], Gamma_Event_Number_SD ~ ageInverse)
anova(lm.model)

```


## Alpha Frequency Band

```{r, echo= FALSE, message = FALSE, warning = FALSE}
#alpha
ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2,],  aes(x = age, y = log10_Alpha_Trial_Power_mean )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Alpha Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2,], log10_Alpha_Trial_Power_mean ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2,],  aes(x = age, y = log10_Alpha_Trial_Power_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Alpha Power vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2,], log10_Alpha_Trial_Power_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2,],  aes(x = age, y = Alpha_Event_Duration)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Alpha Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Duration")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2,], Alpha_Event_Duration ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2,],  aes(x = age, y = Alpha_Event_Duration_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Alpha Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2,], Alpha_Event_Duration_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2,],  aes(x = age, y = Alpha_Event_Number )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Alpha Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2,], Alpha_Event_Number ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2,],  aes(x = age, y = Alpha_Event_Number_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Variability of Alpha Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2,], Alpha_Event_Number_SD ~ ageInverse)
anova(lm.model)

```

## Theta Frequency Band

```{r echo=FALSE, message=FALSE, warning=FALSE}
#alpha
ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2,],  aes(x = age, y = log10_Theta_Trial_Power_mean )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Theta Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2,], log10_Theta_Trial_Power_mean ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2,],  aes(x = age, y = log10_Theta_Trial_Power_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Theta Power vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2,], log10_Theta_Trial_Power_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2,],  aes(x = age, y = Theta_Event_Duration)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Theta Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Duration")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2,], Theta_Event_Duration ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2,],  aes(x = age, y = Theta_Event_Duration_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Theta Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2,], Theta_Event_Duration_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2,],  aes(x = age, y = Theta_Event_Number )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Theta Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2,], Theta_Event_Number ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2,],  aes(x = age, y = Theta_Event_Number_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Variability of Theta Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2,], Theta_Event_Number_SD ~ ageInverse)
anova(lm.model)

```

## Beta Frequency Band

```{r echo=FALSE, message=FALSE, warning=FALSE}
#alpha
ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2,],  aes(x = age, y = log10_Beta_Trial_Power_mean )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Beta Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2,], log10_Beta_Trial_Power_mean ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2,],  aes(x = age, y = log10_Beta_Trial_Power_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Beta Power vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2,], log10_Beta_Trial_Power_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2,],  aes(x = age, y = Beta_Event_Duration)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Beta Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Duration")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2,], Beta_Event_Duration ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2,],  aes(x = age, y = Beta_Event_Duration_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Beta Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2,], Beta_Event_Duration_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2,],  aes(x = age, y = Beta_Event_Number )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Beta Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2,], Beta_Event_Number ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2,],  aes(x = age, y = Beta_Event_Number_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Variability of Beta Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2,], Beta_Event_Number_SD ~ ageInverse)
anova(lm.model)
```


# Delay Period 2-3 Seconds: Frequency Bands and Task Performance
## Fit Linear Mixed Effects Model
### Gamma Band Frequency
#### Effect of Gamma Trial Power on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + log10_Gamma_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Gamma_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Gamma Trial Power on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + log10_Gamma_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Gamma_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Average Gamma Event Number on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Gamma_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```
#### Effect of Average Gamma Event Number on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Gamma_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Gamma Event Duration on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Gamma_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```
#### Effect of Average Gamma Event Duration on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Gamma_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

### Alpha Band Frequency
#### Effect of Alpha Trial Power on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + log10_Alpha_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Alpha_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Alpha Trial Power on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + log10_Alpha_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Alpha_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Average Alpha Event Number on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Alpha_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Alpha Event Number on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Alpha_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Alpha Event Duration on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Alpha_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Alpha Event Duration on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Alpha_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```


### Theta Band Frequency
#### Effect of Theta Trial Power on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + log10_Theta_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Theta_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Theta Trial Power on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + log10_Theta_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Theta_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Average Theta Event Number on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Theta_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Theta Event Number on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Theta_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Theta Event Duration on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Theta_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Theta Event Duration on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Theta_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```


### Beta Band Frequency
#### Effect of Beta Trial Power on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + log10_Beta_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Beta_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Beta Trial Power on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + log10_Beta_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Beta_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Average Beta Event Number on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Beta_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Beta Event Number on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Beta_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Beta Event Duration on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Beta_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Beta Event Duration on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Beta_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```





# Delay Period 3-4 Seconds: Frequency Bands Across Age

```{r echo=FALSE, message=FALSE, warning=FALSE}
GammaT  <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Gamma/Delay3_4/Gamma_all_data3_4.csv')
AlphaT  <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Alpha/Delay3_4/Alpha_all_data3_4.csv')
BetaT  <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Beta/Delay3_4/Beta_all_data3_4.csv')
ThetaT  <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Theta/Delay3_4/Theta_all_data3_4.csv')
agefile <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/agefile.csv')
agefile$Subject <- agefile$idvalues 

GrandTable <- merge(GammaT, AlphaT, by = c('Subject', 'Trial'), all.x = TRUE, all.y = TRUE)
GrandTable <- merge(GrandTable, BetaT, by = c('Subject', 'Trial'), all.x = TRUE, all.y = TRUE)
GrandTable <- merge(GrandTable, ThetaT, by = c('Subject', 'Trial'), all.x = TRUE, all.y = TRUE)
GrandTable <- merge(GrandTable, agefile, by = 'Subject', all.x = TRUE, all.y = TRUE)

GrandTable$log10_Gamma_Trial_Power <- log10(GrandTable$Gamma_Trial_Power)
GrandTable$log10_Theta_Trial_Power <- log10(GrandTable$Theta_Trial_Power)
GrandTable$log10_Beta_Trial_Power <- log10(GrandTable$Beta_Trial_Power)
GrandTable$log10_Alpha_Trial_Power <- log10(GrandTable$Alpha_Trial_Power)


Behavior <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Behavior.csv')

Behavior$Subject <- paste0(Behavior$LunaID, '_', Behavior$ScanDate)
Behavior <- merge(Behavior, agefile, by = 'Subject', all.x = TRUE, all.y = TRUE)

Everything <- merge(GrandTable, Behavior, by = c('Subject', 'Trial'), all.x = TRUE, all.y = TRUE)
Everything$absPositionError <- abs(Everything$PositionError)

## average across trials 
#gamma
Avg_log10_gamma_power <- aggregate(log10_Gamma_Trial_Power ~ Subject, Everything[Everything$log10_Gamma_Trial_Power != '-Inf',], mean)
TrialVar_log10_gamma_power <- aggregate(log10_Gamma_Trial_Power ~ Subject, Everything[Everything$log10_Gamma_Trial_Power != '-Inf',], sd)
PerSubjectGamma <- merge(Avg_log10_gamma_power, TrialVar_log10_gamma_power, by = 'Subject', suffix = c("_mean", "_SD") )
PerSubjectGamma <- merge(PerSubjectGamma, agefile, by= 'Subject')

Avg_gamma_duration <- aggregate(Gamma_Event_Duration ~ Subject, Everything, mean)
TrialVar_gamma_duration <- aggregate(Gamma_Event_Duration ~ Subject, Everything, sd)
PerSubjectGamma <- merge(PerSubjectGamma, Avg_gamma_duration, by= 'Subject', suffix = c("", "_mean"))
PerSubjectGamma <- merge(PerSubjectGamma, TrialVar_gamma_duration, by= 'Subject', suffix = c("", "_SD"))

Avg_gamma_event_number <- aggregate(Gamma_Event_Number ~ Subject, Everything, mean)
TrialVar_gamma_event_number <- aggregate(Gamma_Event_Number ~ Subject, Everything, sd)
PerSubjectGamma <- merge(PerSubjectGamma, Avg_gamma_event_number, by= 'Subject', suffix = c("", "_mean"))
PerSubjectGamma <- merge(PerSubjectGamma, TrialVar_gamma_event_number, by= 'Subject', suffix = c("", "_SD"))
PerSubjectGamma$ageInverse = 1/PerSubjectGamma$age

avg_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, mean)
SD_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, sd)

PerSubjectGamma <- merge(PerSubjectGamma, avg_abs_PositionError, by= 'Subject',suffix = c("", "_mean"))
PerSubjectGamma <- merge(PerSubjectGamma, SD_abs_PositionError, by= 'Subject', suffix = c("", "_SD"))

avg_Latency <- aggregate(mgsLatency ~ Subject, Everything, mean)
SD_Latency <- aggregate(mgsLatency ~ Subject, Everything, sd)

PerSubjectGamma <- merge(PerSubjectGamma, avg_Latency, by = 'Subject',suffix = c("", "_mean"))
PerSubjectGamma <- merge(PerSubjectGamma, SD_Latency, by = 'Subject', suffix = c("", "_SD"))


#alpha
Avg_log10_alpha_power <- aggregate(log10_Alpha_Trial_Power ~ Subject, Everything[Everything$log10_Alpha_Trial_Power != '-Inf',], mean)
TrialVar_log10_alpha_power <- aggregate(log10_Alpha_Trial_Power ~ Subject, Everything[Everything$log10_Alpha_Trial_Power != '-Inf',], sd)
PerSubjectAlpha <- merge(Avg_log10_alpha_power, TrialVar_log10_alpha_power, by = 'Subject', suffix = c("_mean", "_SD") )
PerSubjectAlpha <- merge(PerSubjectAlpha, agefile, by= 'Subject')

Avg_alpha_duration <- aggregate(Alpha_Event_Duration ~ Subject, Everything, mean)
TrialVar_alpha_duration <- aggregate(Alpha_Event_Duration ~ Subject, Everything, sd)
PerSubjectAlpha <- merge(PerSubjectAlpha, Avg_alpha_duration, by= 'Subject', suffix = c("", "_mean"))
PerSubjectAlpha <- merge(PerSubjectAlpha, TrialVar_alpha_duration, by= 'Subject', suffix = c("", "_SD"))

Avg_alpha_event_number <- aggregate(Alpha_Event_Number ~ Subject, Everything, mean)
TrialVar_alpha_event_number <- aggregate(Alpha_Event_Number ~ Subject, Everything, sd)
PerSubjectAlpha <- merge(PerSubjectAlpha, Avg_alpha_event_number, by= 'Subject', suffix = c("", "_mean"))
PerSubjectAlpha <- merge(PerSubjectAlpha, TrialVar_alpha_event_number, by= 'Subject', suffix = c("", "_SD"))
PerSubjectAlpha$ageInverse = 1/PerSubjectAlpha$age

avg_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, mean)
SD_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, sd)

PerSubjectAlpha <- merge(PerSubjectAlpha, avg_abs_PositionError, by= 'Subject',suffix = c("", "_mean"))
PerSubjectAlpha <- merge(PerSubjectAlpha, SD_abs_PositionError, by= 'Subject', suffix = c("", "_SD"))

avg_Latency <- aggregate(mgsLatency ~ Subject, Everything, mean)
SD_Latency <- aggregate(mgsLatency ~ Subject, Everything, sd)

PerSubjectAlpha <- merge(PerSubjectAlpha, avg_Latency, by = 'Subject',suffix = c("", "_mean"))
PerSubjectAlpha <- merge(PerSubjectAlpha, SD_Latency, by = 'Subject', suffix = c("", "_SD"))

#theta
Avg_log10_theta_power <- aggregate(log10_Theta_Trial_Power ~ Subject, Everything[Everything$log10_Theta_Trial_Power != '-Inf',], mean)
TrialVar_log10_theta_power <- aggregate(log10_Theta_Trial_Power ~ Subject, Everything[Everything$log10_Theta_Trial_Power != '-Inf',], sd)
PerSubjectTheta <- merge(Avg_log10_theta_power, TrialVar_log10_theta_power, by = 'Subject', suffix = c("_mean", "_SD") )
PerSubjectTheta <- merge(PerSubjectTheta, agefile, by= 'Subject')

Avg_theta_duration <- aggregate(Theta_Event_Duration ~ Subject, Everything, mean)
TrialVar_theta_duration <- aggregate(Theta_Event_Duration ~ Subject, Everything, sd)
PerSubjectTheta <- merge(PerSubjectTheta, Avg_theta_duration, by= 'Subject', suffix = c("", "_mean"))
PerSubjectTheta <- merge(PerSubjectTheta, TrialVar_theta_duration, by= 'Subject', suffix = c("", "_SD"))

Avg_theta_event_number <- aggregate(Theta_Event_Number ~ Subject, Everything, mean)
TrialVar_theta_event_number <- aggregate(Theta_Event_Number ~ Subject, Everything, sd)
PerSubjectTheta <- merge(PerSubjectTheta, Avg_theta_event_number, by= 'Subject', suffix = c("", "_mean"))
PerSubjectTheta <- merge(PerSubjectTheta, TrialVar_theta_event_number, by= 'Subject', suffix = c("", "_SD"))
PerSubjectTheta$ageInverse = 1/PerSubjectTheta$age

avg_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, mean)
SD_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, sd)

PerSubjectTheta <- merge(PerSubjectTheta, avg_abs_PositionError, by= 'Subject',suffix = c("", "_mean"))
PerSubjectTheta <- merge(PerSubjectTheta, SD_abs_PositionError, by= 'Subject', suffix = c("", "_SD"))

avg_Latency <- aggregate(mgsLatency ~ Subject, Everything, mean)
SD_Latency <- aggregate(mgsLatency ~ Subject, Everything, sd)

PerSubjectTheta <- merge(PerSubjectTheta, avg_Latency, by = 'Subject',suffix = c("", "_mean"))
PerSubjectTheta <- merge(PerSubjectTheta, SD_Latency, by = 'Subject', suffix = c("", "_SD"))

#beta
Avg_log10_beta_power <- aggregate(log10_Beta_Trial_Power ~ Subject, Everything[Everything$log10_Beta_Trial_Power != '-Inf',], mean)
TrialVar_log10_beta_power <- aggregate(log10_Beta_Trial_Power ~ Subject, Everything[Everything$log10_Beta_Trial_Power != '-Inf',], sd)
PerSubjectBeta <- merge(Avg_log10_beta_power, TrialVar_log10_beta_power, by = 'Subject', suffix = c("_mean", "_SD") )
PerSubjectBeta <- merge(PerSubjectBeta, agefile, by= 'Subject')

Avg_beta_duration <- aggregate(Beta_Event_Duration ~ Subject, Everything, mean)
TrialVar_beta_duration <- aggregate(Beta_Event_Duration ~ Subject, Everything, sd)
PerSubjectBeta <- merge(PerSubjectBeta, Avg_beta_duration, by= 'Subject', suffix = c("", "_mean"))
PerSubjectBeta <- merge(PerSubjectBeta, TrialVar_beta_duration, by= 'Subject', suffix = c("", "_SD"))

Avg_beta_event_number <- aggregate(Beta_Event_Number ~ Subject, Everything, mean)
TrialVar_beta_event_number <- aggregate(Beta_Event_Number ~ Subject, Everything, sd)
PerSubjectBeta <- merge(PerSubjectBeta, Avg_beta_event_number, by= 'Subject', suffix = c("", "_mean"))
PerSubjectBeta <- merge(PerSubjectBeta, TrialVar_beta_event_number, by= 'Subject', suffix = c("", "_SD"))
PerSubjectBeta$ageInverse = 1/PerSubjectBeta$age

avg_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, mean)
SD_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, sd)

PerSubjectBeta <- merge(PerSubjectBeta, avg_abs_PositionError, by= 'Subject',suffix = c("", "_mean"))
PerSubjectBeta <- merge(PerSubjectBeta, SD_abs_PositionError, by= 'Subject', suffix = c("", "_SD"))

avg_Latency <- aggregate(mgsLatency ~ Subject, Everything, mean)
SD_Latency <- aggregate(mgsLatency ~ Subject, Everything, sd)

PerSubjectBeta <- merge(PerSubjectBeta, avg_Latency, by = 'Subject',suffix = c("", "_mean"))
PerSubjectBeta <- merge(PerSubjectBeta, SD_Latency, by = 'Subject', suffix = c("", "_SD"))


## plots
#frequency vs age 
```


## Gamma Frequency Band

```{r, echo= FALSE, message = FALSE, warning = FALSE, fig.margin = TRUE}
#gamma

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2,],  aes(x = age, y = log10_Gamma_Trial_Power_mean )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Gamma Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power")

lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2,], log10_Gamma_Trial_Power_mean ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2,],  aes(x = age, y = log10_Gamma_Trial_Power_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Gamma Power vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2,], log10_Gamma_Trial_Power_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2,],  aes(x = age, y = Gamma_Event_Duration)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Gamma Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("Duration")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2,], Gamma_Event_Duration ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2,],  aes(x = age, y = Gamma_Event_Duration_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Varibaility of Gamma Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2,], Gamma_Event_Duration_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2,],  aes(x = age, y = Gamma_Event_Number )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Average Gamma Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2,], Gamma_Event_Number ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2,],  aes(x = age, y = Gamma_Event_Number_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Varibaility of Gamma Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2,], Gamma_Event_Number_SD ~ ageInverse)
anova(lm.model)

```


## Alpha Frequency Band

```{r, echo= FALSE, message = FALSE, warning = FALSE}
#alpha
ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2,],  aes(x = age, y = log10_Alpha_Trial_Power_mean )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Alpha Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2,], log10_Alpha_Trial_Power_mean ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2,],  aes(x = age, y = log10_Alpha_Trial_Power_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Alpha Power vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2,], log10_Alpha_Trial_Power_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2,],  aes(x = age, y = Alpha_Event_Duration)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Alpha Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Duration")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2,], Alpha_Event_Duration ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2,],  aes(x = age, y = Alpha_Event_Duration_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Alpha Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2,], Alpha_Event_Duration_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2,],  aes(x = age, y = Alpha_Event_Number )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Alpha Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2,], Alpha_Event_Number ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2,],  aes(x = age, y = Alpha_Event_Number_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Variability of Alpha Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2,], Alpha_Event_Number_SD ~ ageInverse)
anova(lm.model)

```

## Theta Frequency Band

```{r echo=FALSE, message=FALSE, warning=FALSE}
#alpha
ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2,],  aes(x = age, y = log10_Theta_Trial_Power_mean )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Theta Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2,], log10_Theta_Trial_Power_mean ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2,],  aes(x = age, y = log10_Theta_Trial_Power_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Theta Power vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2,], log10_Theta_Trial_Power_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2,],  aes(x = age, y = Theta_Event_Duration)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Theta Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Duration")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2,], Theta_Event_Duration ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2,],  aes(x = age, y = Theta_Event_Duration_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Theta Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2,], Theta_Event_Duration_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2,],  aes(x = age, y = Theta_Event_Number )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Theta Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2,], Theta_Event_Number ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2,],  aes(x = age, y = Theta_Event_Number_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Variability of Theta Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2,], Theta_Event_Number_SD ~ ageInverse)
anova(lm.model)

```

## Beta Frequency Band

```{r echo=FALSE, message=FALSE, warning=FALSE}
#alpha
ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2,],  aes(x = age, y = log10_Beta_Trial_Power_mean )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Beta Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2,], log10_Beta_Trial_Power_mean ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2,],  aes(x = age, y = log10_Beta_Trial_Power_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Beta Power vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2,], log10_Beta_Trial_Power_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2,],  aes(x = age, y = Beta_Event_Duration)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Beta Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Duration")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2,], Beta_Event_Duration ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2,],  aes(x = age, y = Beta_Event_Duration_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Beta Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2,], Beta_Event_Duration_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2,],  aes(x = age, y = Beta_Event_Number )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Beta Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2,], Beta_Event_Number ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2,],  aes(x = age, y = Beta_Event_Number_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Variability of Beta Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2,], Beta_Event_Number_SD ~ ageInverse)
anova(lm.model)
```


# Delay Period 3-4 Seconds: Frequency Bands and Task Performance
## Fit Linear Mixed Effects Model
### Gamma Band Frequency
#### Effect of Gamma Trial Power on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + log10_Gamma_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Gamma_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Gamma Trial Power on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + log10_Gamma_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Gamma_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Average Gamma Event Number on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Gamma_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```
#### Effect of Average Gamma Event Number on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Gamma_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Gamma Event Duration on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Gamma_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```
#### Effect of Average Gamma Event Duration on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Gamma_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

### Alpha Band Frequency
#### Effect of Alpha Trial Power on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + log10_Alpha_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Alpha_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Alpha Trial Power on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + log10_Alpha_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Alpha_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Average Alpha Event Number on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Alpha_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Alpha Event Number on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Alpha_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Alpha Event Duration on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Alpha_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Alpha Event Duration on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Alpha_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```


### Theta Band Frequency
#### Effect of Theta Trial Power on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + log10_Theta_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Theta_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Theta Trial Power on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + log10_Theta_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Theta_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Average Theta Event Number on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Theta_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Theta Event Number on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Theta_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Theta Event Duration on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Theta_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Theta Event Duration on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Theta_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```


### Beta Band Frequency
#### Effect of Beta Trial Power on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + log10_Beta_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Beta_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Beta Trial Power on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + log10_Beta_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Beta_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Average Beta Event Number on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Beta_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Beta Event Number on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Beta_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Beta Event Duration on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Beta_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Beta Event Duration on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Beta_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```




# Delay Period 4-5 Seconds: Frequency Bands Across Age

```{r echo=FALSE, message=FALSE, warning=FALSE}
GammaT  <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Gamma/Delay4_5/Gamma_all_data4_5.csv')
AlphaT  <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Alpha/Delay4_5/Alpha_all_data4_5.csv')
BetaT  <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Beta/Delay4_5/Beta_all_data4_5.csv')
ThetaT  <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Theta/Delay4_5/Theta_all_data4_5.csv')
agefile <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/agefile.csv')
agefile$Subject <- agefile$idvalues 

GrandTable <- merge(GammaT, AlphaT, by = c('Subject', 'Trial'), all.x = TRUE, all.y = TRUE)
GrandTable <- merge(GrandTable, BetaT, by = c('Subject', 'Trial'), all.x = TRUE, all.y = TRUE)
GrandTable <- merge(GrandTable, ThetaT, by = c('Subject', 'Trial'), all.x = TRUE, all.y = TRUE)
GrandTable <- merge(GrandTable, agefile, by = 'Subject', all.x = TRUE, all.y = TRUE)

GrandTable$log10_Gamma_Trial_Power <- log10(GrandTable$Gamma_Trial_Power)
GrandTable$log10_Theta_Trial_Power <- log10(GrandTable$Theta_Trial_Power)
GrandTable$log10_Beta_Trial_Power <- log10(GrandTable$Beta_Trial_Power)
GrandTable$log10_Alpha_Trial_Power <- log10(GrandTable$Alpha_Trial_Power)


Behavior <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Behavior.csv')

Behavior$Subject <- paste0(Behavior$LunaID, '_', Behavior$ScanDate)
Behavior <- merge(Behavior, agefile, by = 'Subject', all.x = TRUE, all.y = TRUE)

Everything <- merge(GrandTable, Behavior, by = c('Subject', 'Trial'), all.x = TRUE, all.y = TRUE)
Everything$absPositionError <- abs(Everything$PositionError)

## average across trials 
#gamma
Avg_log10_gamma_power <- aggregate(log10_Gamma_Trial_Power ~ Subject, Everything[Everything$log10_Gamma_Trial_Power != '-Inf',], mean)
TrialVar_log10_gamma_power <- aggregate(log10_Gamma_Trial_Power ~ Subject, Everything[Everything$log10_Gamma_Trial_Power != '-Inf',], sd)
PerSubjectGamma <- merge(Avg_log10_gamma_power, TrialVar_log10_gamma_power, by = 'Subject', suffix = c("_mean", "_SD") )
PerSubjectGamma <- merge(PerSubjectGamma, agefile, by= 'Subject')

Avg_gamma_duration <- aggregate(Gamma_Event_Duration ~ Subject, Everything, mean)
TrialVar_gamma_duration <- aggregate(Gamma_Event_Duration ~ Subject, Everything, sd)
PerSubjectGamma <- merge(PerSubjectGamma, Avg_gamma_duration, by= 'Subject', suffix = c("", "_mean"))
PerSubjectGamma <- merge(PerSubjectGamma, TrialVar_gamma_duration, by= 'Subject', suffix = c("", "_SD"))

Avg_gamma_event_number <- aggregate(Gamma_Event_Number ~ Subject, Everything, mean)
TrialVar_gamma_event_number <- aggregate(Gamma_Event_Number ~ Subject, Everything, sd)
PerSubjectGamma <- merge(PerSubjectGamma, Avg_gamma_event_number, by= 'Subject', suffix = c("", "_mean"))
PerSubjectGamma <- merge(PerSubjectGamma, TrialVar_gamma_event_number, by= 'Subject', suffix = c("", "_SD"))
PerSubjectGamma$ageInverse = 1/PerSubjectGamma$age

avg_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, mean)
SD_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, sd)

PerSubjectGamma <- merge(PerSubjectGamma, avg_abs_PositionError, by= 'Subject',suffix = c("", "_mean"))
PerSubjectGamma <- merge(PerSubjectGamma, SD_abs_PositionError, by= 'Subject', suffix = c("", "_SD"))

avg_Latency <- aggregate(mgsLatency ~ Subject, Everything, mean)
SD_Latency <- aggregate(mgsLatency ~ Subject, Everything, sd)

PerSubjectGamma <- merge(PerSubjectGamma, avg_Latency, by = 'Subject',suffix = c("", "_mean"))
PerSubjectGamma <- merge(PerSubjectGamma, SD_Latency, by = 'Subject', suffix = c("", "_SD"))


#alpha
Avg_log10_alpha_power <- aggregate(log10_Alpha_Trial_Power ~ Subject, Everything[Everything$log10_Alpha_Trial_Power != '-Inf',], mean)
TrialVar_log10_alpha_power <- aggregate(log10_Alpha_Trial_Power ~ Subject, Everything[Everything$log10_Alpha_Trial_Power != '-Inf',], sd)
PerSubjectAlpha <- merge(Avg_log10_alpha_power, TrialVar_log10_alpha_power, by = 'Subject', suffix = c("_mean", "_SD") )
PerSubjectAlpha <- merge(PerSubjectAlpha, agefile, by= 'Subject')

Avg_alpha_duration <- aggregate(Alpha_Event_Duration ~ Subject, Everything, mean)
TrialVar_alpha_duration <- aggregate(Alpha_Event_Duration ~ Subject, Everything, sd)
PerSubjectAlpha <- merge(PerSubjectAlpha, Avg_alpha_duration, by= 'Subject', suffix = c("", "_mean"))
PerSubjectAlpha <- merge(PerSubjectAlpha, TrialVar_alpha_duration, by= 'Subject', suffix = c("", "_SD"))

Avg_alpha_event_number <- aggregate(Alpha_Event_Number ~ Subject, Everything, mean)
TrialVar_alpha_event_number <- aggregate(Alpha_Event_Number ~ Subject, Everything, sd)
PerSubjectAlpha <- merge(PerSubjectAlpha, Avg_alpha_event_number, by= 'Subject', suffix = c("", "_mean"))
PerSubjectAlpha <- merge(PerSubjectAlpha, TrialVar_alpha_event_number, by= 'Subject', suffix = c("", "_SD"))
PerSubjectAlpha$ageInverse = 1/PerSubjectAlpha$age

avg_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, mean)
SD_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, sd)

PerSubjectAlpha <- merge(PerSubjectAlpha, avg_abs_PositionError, by= 'Subject',suffix = c("", "_mean"))
PerSubjectAlpha <- merge(PerSubjectAlpha, SD_abs_PositionError, by= 'Subject', suffix = c("", "_SD"))

avg_Latency <- aggregate(mgsLatency ~ Subject, Everything, mean)
SD_Latency <- aggregate(mgsLatency ~ Subject, Everything, sd)

PerSubjectAlpha <- merge(PerSubjectAlpha, avg_Latency, by = 'Subject',suffix = c("", "_mean"))
PerSubjectAlpha <- merge(PerSubjectAlpha, SD_Latency, by = 'Subject', suffix = c("", "_SD"))

#theta
Avg_log10_theta_power <- aggregate(log10_Theta_Trial_Power ~ Subject, Everything[Everything$log10_Theta_Trial_Power != '-Inf',], mean)
TrialVar_log10_theta_power <- aggregate(log10_Theta_Trial_Power ~ Subject, Everything[Everything$log10_Theta_Trial_Power != '-Inf',], sd)
PerSubjectTheta <- merge(Avg_log10_theta_power, TrialVar_log10_theta_power, by = 'Subject', suffix = c("_mean", "_SD") )
PerSubjectTheta <- merge(PerSubjectTheta, agefile, by= 'Subject')

Avg_theta_duration <- aggregate(Theta_Event_Duration ~ Subject, Everything, mean)
TrialVar_theta_duration <- aggregate(Theta_Event_Duration ~ Subject, Everything, sd)
PerSubjectTheta <- merge(PerSubjectTheta, Avg_theta_duration, by= 'Subject', suffix = c("", "_mean"))
PerSubjectTheta <- merge(PerSubjectTheta, TrialVar_theta_duration, by= 'Subject', suffix = c("", "_SD"))

Avg_theta_event_number <- aggregate(Theta_Event_Number ~ Subject, Everything, mean)
TrialVar_theta_event_number <- aggregate(Theta_Event_Number ~ Subject, Everything, sd)
PerSubjectTheta <- merge(PerSubjectTheta, Avg_theta_event_number, by= 'Subject', suffix = c("", "_mean"))
PerSubjectTheta <- merge(PerSubjectTheta, TrialVar_theta_event_number, by= 'Subject', suffix = c("", "_SD"))
PerSubjectTheta$ageInverse = 1/PerSubjectTheta$age

avg_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, mean)
SD_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, sd)

PerSubjectTheta <- merge(PerSubjectTheta, avg_abs_PositionError, by= 'Subject',suffix = c("", "_mean"))
PerSubjectTheta <- merge(PerSubjectTheta, SD_abs_PositionError, by= 'Subject', suffix = c("", "_SD"))

avg_Latency <- aggregate(mgsLatency ~ Subject, Everything, mean)
SD_Latency <- aggregate(mgsLatency ~ Subject, Everything, sd)

PerSubjectTheta <- merge(PerSubjectTheta, avg_Latency, by = 'Subject',suffix = c("", "_mean"))
PerSubjectTheta <- merge(PerSubjectTheta, SD_Latency, by = 'Subject', suffix = c("", "_SD"))

#beta
Avg_log10_beta_power <- aggregate(log10_Beta_Trial_Power ~ Subject, Everything[Everything$log10_Beta_Trial_Power != '-Inf',], mean)
TrialVar_log10_beta_power <- aggregate(log10_Beta_Trial_Power ~ Subject, Everything[Everything$log10_Beta_Trial_Power != '-Inf',], sd)
PerSubjectBeta <- merge(Avg_log10_beta_power, TrialVar_log10_beta_power, by = 'Subject', suffix = c("_mean", "_SD") )
PerSubjectBeta <- merge(PerSubjectBeta, agefile, by= 'Subject')

Avg_beta_duration <- aggregate(Beta_Event_Duration ~ Subject, Everything, mean)
TrialVar_beta_duration <- aggregate(Beta_Event_Duration ~ Subject, Everything, sd)
PerSubjectBeta <- merge(PerSubjectBeta, Avg_beta_duration, by= 'Subject', suffix = c("", "_mean"))
PerSubjectBeta <- merge(PerSubjectBeta, TrialVar_beta_duration, by= 'Subject', suffix = c("", "_SD"))

Avg_beta_event_number <- aggregate(Beta_Event_Number ~ Subject, Everything, mean)
TrialVar_beta_event_number <- aggregate(Beta_Event_Number ~ Subject, Everything, sd)
PerSubjectBeta <- merge(PerSubjectBeta, Avg_beta_event_number, by= 'Subject', suffix = c("", "_mean"))
PerSubjectBeta <- merge(PerSubjectBeta, TrialVar_beta_event_number, by= 'Subject', suffix = c("", "_SD"))
PerSubjectBeta$ageInverse = 1/PerSubjectBeta$age

avg_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, mean)
SD_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, sd)

PerSubjectBeta <- merge(PerSubjectBeta, avg_abs_PositionError, by= 'Subject',suffix = c("", "_mean"))
PerSubjectBeta <- merge(PerSubjectBeta, SD_abs_PositionError, by= 'Subject', suffix = c("", "_SD"))

avg_Latency <- aggregate(mgsLatency ~ Subject, Everything, mean)
SD_Latency <- aggregate(mgsLatency ~ Subject, Everything, sd)

PerSubjectBeta <- merge(PerSubjectBeta, avg_Latency, by = 'Subject',suffix = c("", "_mean"))
PerSubjectBeta <- merge(PerSubjectBeta, SD_Latency, by = 'Subject', suffix = c("", "_SD"))


## plots
#frequency vs age 
```



## Gamma Frequency Band

```{r, echo= FALSE, message = FALSE, warning = FALSE, fig.margin = TRUE}
#gamma

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2,],  aes(x = age, y = log10_Gamma_Trial_Power_mean )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Gamma Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power")

lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2,], log10_Gamma_Trial_Power_mean ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2,],  aes(x = age, y = log10_Gamma_Trial_Power_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Gamma Power vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2,], log10_Gamma_Trial_Power_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2,],  aes(x = age, y = Gamma_Event_Duration)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Gamma Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("Duration")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2,], Gamma_Event_Duration ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2,],  aes(x = age, y = Gamma_Event_Duration_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Varibaility of Gamma Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2,], Gamma_Event_Duration_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2,],  aes(x = age, y = Gamma_Event_Number )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Average Gamma Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2,], Gamma_Event_Number ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2,],  aes(x = age, y = Gamma_Event_Number_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Varibaility of Gamma Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2,], Gamma_Event_Number_SD ~ ageInverse)
anova(lm.model)

```


## Alpha Frequency Band

```{r, echo= FALSE, message = FALSE, warning = FALSE}
#alpha
ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2,],  aes(x = age, y = log10_Alpha_Trial_Power_mean )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Alpha Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2,], log10_Alpha_Trial_Power_mean ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2,],  aes(x = age, y = log10_Alpha_Trial_Power_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Alpha Power vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2,], log10_Alpha_Trial_Power_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2,],  aes(x = age, y = Alpha_Event_Duration)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Alpha Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Duration")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2,], Alpha_Event_Duration ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2,],  aes(x = age, y = Alpha_Event_Duration_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Alpha Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2,], Alpha_Event_Duration_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2,],  aes(x = age, y = Alpha_Event_Number )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Alpha Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2,], Alpha_Event_Number ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2,],  aes(x = age, y = Alpha_Event_Number_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Variability of Alpha Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2,], Alpha_Event_Number_SD ~ ageInverse)
anova(lm.model)

```

## Theta Frequency Band

```{r echo=FALSE, message=FALSE, warning=FALSE}
#alpha
ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2,],  aes(x = age, y = log10_Theta_Trial_Power_mean )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Theta Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2,], log10_Theta_Trial_Power_mean ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2,],  aes(x = age, y = log10_Theta_Trial_Power_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Theta Power vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2,], log10_Theta_Trial_Power_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2,],  aes(x = age, y = Theta_Event_Duration)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Theta Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Duration")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2,], Theta_Event_Duration ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2,],  aes(x = age, y = Theta_Event_Duration_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Theta Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2,], Theta_Event_Duration_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2,],  aes(x = age, y = Theta_Event_Number )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Theta Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2,], Theta_Event_Number ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2,],  aes(x = age, y = Theta_Event_Number_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Variability of Theta Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2,], Theta_Event_Number_SD ~ ageInverse)
anova(lm.model)

```

## Beta Frequency Band

```{r echo=FALSE, message=FALSE, warning=FALSE}
#alpha
ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2,],  aes(x = age, y = log10_Beta_Trial_Power_mean )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Beta Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2,], log10_Beta_Trial_Power_mean ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2,],  aes(x = age, y = log10_Beta_Trial_Power_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Beta Power vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2,], log10_Beta_Trial_Power_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2,],  aes(x = age, y = Beta_Event_Duration)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Beta Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Duration")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2,], Beta_Event_Duration ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2,],  aes(x = age, y = Beta_Event_Duration_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Beta Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2,], Beta_Event_Duration_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2,],  aes(x = age, y = Beta_Event_Number )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Beta Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2,], Beta_Event_Number ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2,],  aes(x = age, y = Beta_Event_Number_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Variability of Beta Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2,], Beta_Event_Number_SD ~ ageInverse)
anova(lm.model)
```




# Delay Period 4-5 Seconds: Frequency Bands and Task Performance
## Fit Linear Mixed Effects Model
### Gamma Band Frequency
#### Effect of Gamma Trial Power on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + log10_Gamma_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Gamma_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Gamma Trial Power on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + log10_Gamma_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Gamma_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Average Gamma Event Number on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Gamma_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```
#### Effect of Average Gamma Event Number on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Gamma_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Gamma Event Duration on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Gamma_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```
#### Effect of Average Gamma Event Duration on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Gamma_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

### Alpha Band Frequency
#### Effect of Alpha Trial Power on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + log10_Alpha_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Alpha_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Alpha Trial Power on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + log10_Alpha_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Alpha_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Average Alpha Event Number on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Alpha_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Alpha Event Number on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Alpha_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Alpha Event Duration on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Alpha_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Alpha Event Duration on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Alpha_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```


### Theta Band Frequency
#### Effect of Theta Trial Power on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + log10_Theta_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Theta_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Theta Trial Power on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + log10_Theta_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Theta_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Average Theta Event Number on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Theta_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Theta Event Number on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Theta_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Theta Event Duration on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Theta_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Theta Event Duration on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Theta_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```


### Beta Band Frequency
#### Effect of Beta Trial Power on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + log10_Beta_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Beta_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Beta Trial Power on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + log10_Beta_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Beta_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Average Beta Event Number on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Beta_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Beta Event Number on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Beta_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Beta Event Duration on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Beta_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Beta Event Duration on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Beta_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```






# Delay Period 5-6 Seconds: Frequency Bands Across Age


```{r echo=FALSE, message=FALSE, warning=FALSE}
GammaT  <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Gamma/Delay5_6/Gamma_all_data5_6.csv')
AlphaT  <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Alpha/Delay5_6/Alpha_all_data5_6.csv')
BetaT  <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Beta/Delay5_6/Beta_all_data5_6.csv')
ThetaT  <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Theta/Delay5_6/Theta_all_data5_6.csv')
agefile <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/agefile.csv')
agefile$Subject <- agefile$idvalues 

GrandTable <- merge(GammaT, AlphaT, by = c('Subject', 'Trial'), all.x = TRUE, all.y = TRUE)
GrandTable <- merge(GrandTable, BetaT, by = c('Subject', 'Trial'), all.x = TRUE, all.y = TRUE)
GrandTable <- merge(GrandTable, ThetaT, by = c('Subject', 'Trial'), all.x = TRUE, all.y = TRUE)
GrandTable <- merge(GrandTable, agefile, by = 'Subject', all.x = TRUE, all.y = TRUE)

GrandTable$log10_Gamma_Trial_Power <- log10(GrandTable$Gamma_Trial_Power)
GrandTable$log10_Theta_Trial_Power <- log10(GrandTable$Theta_Trial_Power)
GrandTable$log10_Beta_Trial_Power <- log10(GrandTable$Beta_Trial_Power)
GrandTable$log10_Alpha_Trial_Power <- log10(GrandTable$Alpha_Trial_Power)


Behavior <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Behavior.csv')

Behavior$Subject <- paste0(Behavior$LunaID, '_', Behavior$ScanDate)
Behavior <- merge(Behavior, agefile, by = 'Subject', all.x = TRUE, all.y = TRUE)

Everything <- merge(GrandTable, Behavior, by = c('Subject', 'Trial'), all.x = TRUE, all.y = TRUE)
Everything$absPositionError <- abs(Everything$PositionError)

## average across trials 
#gamma
Avg_log10_gamma_power <- aggregate(log10_Gamma_Trial_Power ~ Subject, Everything[Everything$log10_Gamma_Trial_Power != '-Inf',], mean)
TrialVar_log10_gamma_power <- aggregate(log10_Gamma_Trial_Power ~ Subject, Everything[Everything$log10_Gamma_Trial_Power != '-Inf',], sd)
PerSubjectGamma <- merge(Avg_log10_gamma_power, TrialVar_log10_gamma_power, by = 'Subject', suffix = c("_mean", "_SD") )
PerSubjectGamma <- merge(PerSubjectGamma, agefile, by= 'Subject')

Avg_gamma_duration <- aggregate(Gamma_Event_Duration ~ Subject, Everything, mean)
TrialVar_gamma_duration <- aggregate(Gamma_Event_Duration ~ Subject, Everything, sd)
PerSubjectGamma <- merge(PerSubjectGamma, Avg_gamma_duration, by= 'Subject', suffix = c("", "_mean"))
PerSubjectGamma <- merge(PerSubjectGamma, TrialVar_gamma_duration, by= 'Subject', suffix = c("", "_SD"))

Avg_gamma_event_number <- aggregate(Gamma_Event_Number ~ Subject, Everything, mean)
TrialVar_gamma_event_number <- aggregate(Gamma_Event_Number ~ Subject, Everything, sd)
PerSubjectGamma <- merge(PerSubjectGamma, Avg_gamma_event_number, by= 'Subject', suffix = c("", "_mean"))
PerSubjectGamma <- merge(PerSubjectGamma, TrialVar_gamma_event_number, by= 'Subject', suffix = c("", "_SD"))
PerSubjectGamma$ageInverse = 1/PerSubjectGamma$age

avg_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, mean)
SD_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, sd)

PerSubjectGamma <- merge(PerSubjectGamma, avg_abs_PositionError, by= 'Subject',suffix = c("", "_mean"))
PerSubjectGamma <- merge(PerSubjectGamma, SD_abs_PositionError, by= 'Subject', suffix = c("", "_SD"))

avg_Latency <- aggregate(mgsLatency ~ Subject, Everything, mean)
SD_Latency <- aggregate(mgsLatency ~ Subject, Everything, sd)

PerSubjectGamma <- merge(PerSubjectGamma, avg_Latency, by = 'Subject',suffix = c("", "_mean"))
PerSubjectGamma <- merge(PerSubjectGamma, SD_Latency, by = 'Subject', suffix = c("", "_SD"))


#alpha
Avg_log10_alpha_power <- aggregate(log10_Alpha_Trial_Power ~ Subject, Everything[Everything$log10_Alpha_Trial_Power != '-Inf',], mean)
TrialVar_log10_alpha_power <- aggregate(log10_Alpha_Trial_Power ~ Subject, Everything[Everything$log10_Alpha_Trial_Power != '-Inf',], sd)
PerSubjectAlpha <- merge(Avg_log10_alpha_power, TrialVar_log10_alpha_power, by = 'Subject', suffix = c("_mean", "_SD") )
PerSubjectAlpha <- merge(PerSubjectAlpha, agefile, by= 'Subject')

Avg_alpha_duration <- aggregate(Alpha_Event_Duration ~ Subject, Everything, mean)
TrialVar_alpha_duration <- aggregate(Alpha_Event_Duration ~ Subject, Everything, sd)
PerSubjectAlpha <- merge(PerSubjectAlpha, Avg_alpha_duration, by= 'Subject', suffix = c("", "_mean"))
PerSubjectAlpha <- merge(PerSubjectAlpha, TrialVar_alpha_duration, by= 'Subject', suffix = c("", "_SD"))

Avg_alpha_event_number <- aggregate(Alpha_Event_Number ~ Subject, Everything, mean)
TrialVar_alpha_event_number <- aggregate(Alpha_Event_Number ~ Subject, Everything, sd)
PerSubjectAlpha <- merge(PerSubjectAlpha, Avg_alpha_event_number, by= 'Subject', suffix = c("", "_mean"))
PerSubjectAlpha <- merge(PerSubjectAlpha, TrialVar_alpha_event_number, by= 'Subject', suffix = c("", "_SD"))
PerSubjectAlpha$ageInverse = 1/PerSubjectAlpha$age

avg_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, mean)
SD_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, sd)

PerSubjectAlpha <- merge(PerSubjectAlpha, avg_abs_PositionError, by= 'Subject',suffix = c("", "_mean"))
PerSubjectAlpha <- merge(PerSubjectAlpha, SD_abs_PositionError, by= 'Subject', suffix = c("", "_SD"))

avg_Latency <- aggregate(mgsLatency ~ Subject, Everything, mean)
SD_Latency <- aggregate(mgsLatency ~ Subject, Everything, sd)

PerSubjectAlpha <- merge(PerSubjectAlpha, avg_Latency, by = 'Subject',suffix = c("", "_mean"))
PerSubjectAlpha <- merge(PerSubjectAlpha, SD_Latency, by = 'Subject', suffix = c("", "_SD"))

#theta
Avg_log10_theta_power <- aggregate(log10_Theta_Trial_Power ~ Subject, Everything[Everything$log10_Theta_Trial_Power != '-Inf',], mean)
TrialVar_log10_theta_power <- aggregate(log10_Theta_Trial_Power ~ Subject, Everything[Everything$log10_Theta_Trial_Power != '-Inf',], sd)
PerSubjectTheta <- merge(Avg_log10_theta_power, TrialVar_log10_theta_power, by = 'Subject', suffix = c("_mean", "_SD") )
PerSubjectTheta <- merge(PerSubjectTheta, agefile, by= 'Subject')

Avg_theta_duration <- aggregate(Theta_Event_Duration ~ Subject, Everything, mean)
TrialVar_theta_duration <- aggregate(Theta_Event_Duration ~ Subject, Everything, sd)
PerSubjectTheta <- merge(PerSubjectTheta, Avg_theta_duration, by= 'Subject', suffix = c("", "_mean"))
PerSubjectTheta <- merge(PerSubjectTheta, TrialVar_theta_duration, by= 'Subject', suffix = c("", "_SD"))

Avg_theta_event_number <- aggregate(Theta_Event_Number ~ Subject, Everything, mean)
TrialVar_theta_event_number <- aggregate(Theta_Event_Number ~ Subject, Everything, sd)
PerSubjectTheta <- merge(PerSubjectTheta, Avg_theta_event_number, by= 'Subject', suffix = c("", "_mean"))
PerSubjectTheta <- merge(PerSubjectTheta, TrialVar_theta_event_number, by= 'Subject', suffix = c("", "_SD"))
PerSubjectTheta$ageInverse = 1/PerSubjectTheta$age

avg_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, mean)
SD_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, sd)

PerSubjectTheta <- merge(PerSubjectTheta, avg_abs_PositionError, by= 'Subject',suffix = c("", "_mean"))
PerSubjectTheta <- merge(PerSubjectTheta, SD_abs_PositionError, by= 'Subject', suffix = c("", "_SD"))

avg_Latency <- aggregate(mgsLatency ~ Subject, Everything, mean)
SD_Latency <- aggregate(mgsLatency ~ Subject, Everything, sd)

PerSubjectTheta <- merge(PerSubjectTheta, avg_Latency, by = 'Subject',suffix = c("", "_mean"))
PerSubjectTheta <- merge(PerSubjectTheta, SD_Latency, by = 'Subject', suffix = c("", "_SD"))

#beta
Avg_log10_beta_power <- aggregate(log10_Beta_Trial_Power ~ Subject, Everything[Everything$log10_Beta_Trial_Power != '-Inf',], mean)
TrialVar_log10_beta_power <- aggregate(log10_Beta_Trial_Power ~ Subject, Everything[Everything$log10_Beta_Trial_Power != '-Inf',], sd)
PerSubjectBeta <- merge(Avg_log10_beta_power, TrialVar_log10_beta_power, by = 'Subject', suffix = c("_mean", "_SD") )
PerSubjectBeta <- merge(PerSubjectBeta, agefile, by= 'Subject')

Avg_beta_duration <- aggregate(Beta_Event_Duration ~ Subject, Everything, mean)
TrialVar_beta_duration <- aggregate(Beta_Event_Duration ~ Subject, Everything, sd)
PerSubjectBeta <- merge(PerSubjectBeta, Avg_beta_duration, by= 'Subject', suffix = c("", "_mean"))
PerSubjectBeta <- merge(PerSubjectBeta, TrialVar_beta_duration, by= 'Subject', suffix = c("", "_SD"))

Avg_beta_event_number <- aggregate(Beta_Event_Number ~ Subject, Everything, mean)
TrialVar_beta_event_number <- aggregate(Beta_Event_Number ~ Subject, Everything, sd)
PerSubjectBeta <- merge(PerSubjectBeta, Avg_beta_event_number, by= 'Subject', suffix = c("", "_mean"))
PerSubjectBeta <- merge(PerSubjectBeta, TrialVar_beta_event_number, by= 'Subject', suffix = c("", "_SD"))
PerSubjectBeta$ageInverse = 1/PerSubjectBeta$age

avg_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, mean)
SD_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, sd)

PerSubjectBeta <- merge(PerSubjectBeta, avg_abs_PositionError, by= 'Subject',suffix = c("", "_mean"))
PerSubjectBeta <- merge(PerSubjectBeta, SD_abs_PositionError, by= 'Subject', suffix = c("", "_SD"))

avg_Latency <- aggregate(mgsLatency ~ Subject, Everything, mean)
SD_Latency <- aggregate(mgsLatency ~ Subject, Everything, sd)

PerSubjectBeta <- merge(PerSubjectBeta, avg_Latency, by = 'Subject',suffix = c("", "_mean"))
PerSubjectBeta <- merge(PerSubjectBeta, SD_Latency, by = 'Subject', suffix = c("", "_SD"))


## plots
#frequency vs age 
```
## Gamma Frequency Band

```{r, echo= FALSE, message = FALSE, warning = FALSE, fig.margin = TRUE}
#gamma

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2,],  aes(x = age, y = log10_Gamma_Trial_Power_mean )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Gamma Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power")

lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2,], log10_Gamma_Trial_Power_mean ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2,],  aes(x = age, y = log10_Gamma_Trial_Power_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Gamma Power vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2,], log10_Gamma_Trial_Power_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2,],  aes(x = age, y = Gamma_Event_Duration)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Gamma Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("Duration")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2,], Gamma_Event_Duration ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2,],  aes(x = age, y = Gamma_Event_Duration_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Varibaility of Gamma Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2,], Gamma_Event_Duration_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2,],  aes(x = age, y = Gamma_Event_Number )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Average Gamma Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2,], Gamma_Event_Number ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2,],  aes(x = age, y = Gamma_Event_Number_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Varibaility of Gamma Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2,], Gamma_Event_Number_SD ~ ageInverse)
anova(lm.model)

```


## Alpha Frequency Band

```{r, echo= FALSE, message = FALSE, warning = FALSE}
#alpha
ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2,],  aes(x = age, y = log10_Alpha_Trial_Power_mean )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Alpha Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2,], log10_Alpha_Trial_Power_mean ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2,],  aes(x = age, y = log10_Alpha_Trial_Power_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Alpha Power vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2,], log10_Alpha_Trial_Power_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2,],  aes(x = age, y = Alpha_Event_Duration)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Alpha Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Duration")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2,], Alpha_Event_Duration ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2,],  aes(x = age, y = Alpha_Event_Duration_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Alpha Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2,], Alpha_Event_Duration_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2,],  aes(x = age, y = Alpha_Event_Number )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Alpha Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2,], Alpha_Event_Number ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2,],  aes(x = age, y = Alpha_Event_Number_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Variability of Alpha Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2,], Alpha_Event_Number_SD ~ ageInverse)
anova(lm.model)

```

## Theta Frequency Band

```{r echo=FALSE, message=FALSE, warning=FALSE}
#alpha
ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2,],  aes(x = age, y = log10_Theta_Trial_Power_mean )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Theta Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2,], log10_Theta_Trial_Power_mean ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2,],  aes(x = age, y = log10_Theta_Trial_Power_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Theta Power vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2,], log10_Theta_Trial_Power_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2,],  aes(x = age, y = Theta_Event_Duration)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Theta Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Duration")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2,], Theta_Event_Duration ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2,],  aes(x = age, y = Theta_Event_Duration_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Theta Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2,], Theta_Event_Duration_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2,],  aes(x = age, y = Theta_Event_Number )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Theta Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2,], Theta_Event_Number ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2,],  aes(x = age, y = Theta_Event_Number_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Variability of Theta Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2,], Theta_Event_Number_SD ~ ageInverse)
anova(lm.model)

```

## Beta Frequency Band

```{r echo=FALSE, message=FALSE, warning=FALSE}
#alpha
ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2,],  aes(x = age, y = log10_Beta_Trial_Power_mean )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Beta Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2,], log10_Beta_Trial_Power_mean ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2,],  aes(x = age, y = log10_Beta_Trial_Power_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Beta Power vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2,], log10_Beta_Trial_Power_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2,],  aes(x = age, y = Beta_Event_Duration)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Beta Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Duration")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2,], Beta_Event_Duration ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2,],  aes(x = age, y = Beta_Event_Duration_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Beta Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2,], Beta_Event_Duration_SD ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2,],  aes(x = age, y = Beta_Event_Number )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Beta Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2,], Beta_Event_Number ~ ageInverse)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2,],  aes(x = age, y = Beta_Event_Number_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Variability of Beta Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2,], Beta_Event_Number_SD ~ ageInverse)
anova(lm.model)
```




# Delay Period 5-6 Seconds: Frequency Bands and Task Performance
## Fit Linear Mixed Effects Model
### Gamma Band Frequency
#### Effect of Gamma Trial Power on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + log10_Gamma_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Gamma_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Gamma Trial Power on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + log10_Gamma_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Gamma_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Average Gamma Event Number on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Gamma_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```
#### Effect of Average Gamma Event Number on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Gamma_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Gamma Event Duration on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Gamma_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```
#### Effect of Average Gamma Event Duration on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Gamma_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

### Alpha Band Frequency
#### Effect of Alpha Trial Power on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + log10_Alpha_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Alpha_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Alpha Trial Power on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + log10_Alpha_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Alpha_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Average Alpha Event Number on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Alpha_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Alpha Event Number on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Alpha_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Alpha Event Duration on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Alpha_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Alpha Event Duration on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Alpha_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```


### Theta Band Frequency
#### Effect of Theta Trial Power on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + log10_Theta_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Theta_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Theta Trial Power on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + log10_Theta_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Theta_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Average Theta Event Number on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Theta_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Theta Event Number on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Theta_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Theta Event Duration on Position Error 
```{r, echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Theta_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Theta Event Duration on MGS Latency
```{r, echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Theta_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```


### Beta Band Frequency
#### Effect of Beta Trial Power on Position Error 
```{r, echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + log10_Beta_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Beta_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Beta Trial Power on MGS Latency
```{r, echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + log10_Beta_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Beta_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Average Beta Event Number on Position Error 
```{r, echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Beta_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Beta Event Number on MGS Latency
```{r, echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Beta_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Beta Event Duration on Position Error 
```{r, echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Beta_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Beta Event Duration on MGS Latency
```{r, echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Beta_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```






# Comparing the Delay Periods 
## Gamma Frequency Band 
### Across Time
```{r  echo=FALSE, message=FALSE, warning=FALSE}
GammaDelay1_2 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Gamma/Delay1_2/Gamma_Subs_1_2.csv')
GammaDelay2_3 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Gamma/Delay2_3/Gamma_Subs_2_3.csv')
GammaDelay3_4 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Gamma/Delay3_4/allGamma_3_4_TrialLevel_20200821.csv')
GammaDelay4_5 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Gamma/Delay4_5/Gamma_Subs_4_5.csv')
GammaDelay5_6 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Gamma/Delay5_6/Gamma_Subs_5_6.csv')

GammaDelay1_2$log1p_Gamma_Trial_Power <- log1p(GammaDelay1_2$Gamma_Trial_Power)
GammaDelay2_3$log1p_Gamma_Trial_Power <- log1p(GammaDelay2_3$Gamma_Trial_Power)
GammaDelay3_4$log1p_Gamma_Trial_Power <- log1p(GammaDelay3_4$Trial_Power)
GammaDelay4_5$log1p_Gamma_Trial_Power <- log1p(GammaDelay4_5$Gamma_Trial_Power)
GammaDelay5_6$log1p_Gamma_Trial_Power <- log1p(GammaDelay5_6$Gamma_Trial_Power)


GammaDelay1_2$Epoch <- "1-2"
GammaDelay2_3$Epoch <- "2-3"
GammaDelay3_4$Epoch <- "3-4"
GammaDelay4_5$Epoch <- "4-5"
GammaDelay5_6$Epoch <- "5-6"

GammaDelay3_4 <- GammaDelay3_4 %>% mutate(Gamma_Trial_Power = Trial_Power, Gamma_Event_Number = Event_Number, Gamma_Event_Duration = Event_Duration) %>% select( "Subject", "Trial","Gamma_Trial_Power", "Gamma_Event_Number", "Gamma_Event_Duration", "log1p_Gamma_Trial_Power", "Epoch") 
 
allDelayEpochs <- rbind(GammaDelay1_2,GammaDelay2_3) %>% rbind(.,GammaDelay3_4) %>% rbind(.,GammaDelay4_5) %>% rbind(.,GammaDelay5_6) %>% filter(Trial<97) %>%
   group_by(Subject, Epoch) %>% 
      summarise(Gamma_Trial_Power = mean(Gamma_Trial_Power, na.rm=T), 
                Gamma_Event_Number = mean(Gamma_Event_Number, na.rm=T),
                Gamma_Event_Duration = mean(Gamma_Event_Duration, na.rm=T), 
                log1p_Gamma_Trial_Power = mean(log1p_Gamma_Trial_Power, na.rm=T)) %>%
   merge(., agefile, by = "Subject") %>% 
   filter(visitno == 1)

allDelayEpochs_new <- allDelayEpochs
outliers <- function(x) {
    
    (abs(x - mean(x, na.rm= T)) > (sd(x, na.rm= T) * 2))
    
    
  }
  

  cols = names(allDelayEpochs[c(3:6)])
  for (col in cols) {
    
    allDelayEpochs_grouped <- allDelayEpochs %>% group_by(Subject) %>% group_by(Epoch)
    
    indx <- outliers(allDelayEpochs_grouped[[col]])
    
    allDelayEpochs_new[[col]] <- Map(replace, allDelayEpochs_new[[col]], indx, NA)
    allDelayEpochs_new[[col]] <- as.numeric(allDelayEpochs_new[[col]])
    
  } 

  ggplot(data = allDelayEpochs_new,  aes(x = age, y = log1p_Gamma_Trial_Power,  color = Epoch, group = Epoch )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Gamma Power across Age \nfor Each Delay Epoch ") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power")
  
  ggplot(data = allDelayEpochs_new,  aes(x = age, y = Gamma_Event_Number,  color = Epoch, group = Epoch )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Gamma Event Number across Age \nfor Each Delay Epoch ") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Event Number")
  
  
  
   gam.model <-  gam(log1p_Gamma_Trial_Power  ~ s(age, k=3, by = Epoch) + Epoch  , data = allDelayEpochs_new , random = ~(1|Subject))
  summary(gam.model)
  
  ## interaction with epoch
  allDelayEpochs_new$oEpoch <- ordered(allDelayEpochs_new$Epoch, levels = c("1-2")) # Fix will be the reference group
  model_formula <- as.formula("log1p_Gamma_Trial_Power ~ oEpoch + s(age, k = 4, fx = T) + s(age, by = oEpoch, k = 4, fx = T)")
  # Note we keep fx = T for reliable p-values.
  model <- mgcv::gamm(model_formula,
                      data = allDelayEpochs_new)
  summary(model$gam)
  
  
  
  
  
  
  
  
  
  
  
  
  
```
Group 1: 10-15 years old, Group 2: 16- 20 years old, Group 3: 21 - 25 years old, Group 4: 26+ years old


```{r  echo=FALSE, message=FALSE, warning=FALSE}
lm.model <- lm(data=DelayGammabyGroup, Gamma_Trial_Power ~ Epoch + Group)
anova(lm.model)
```

```{r  echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data = DelayGammabyGroup,  aes(x = Epoch, y = Gamma_Event_Number,  color = Group, group = Group )) + geom_point() + stat_smooth(method='lm')+ ggtitle("Average Number of Gamma Events across the Delay Period") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Time") + ylab("Number of Events")

```
Group 1: 10-15 years old, Group 2: 16- 20 years old, Group 3: 21 - 25 years old, Group 4: 26+ years old


```{r  echo=FALSE, message=FALSE, warning=FALSE}
lm.model <- lm(data=DelayGammabyGroup, Gamma_Event_Number ~ Epoch + Group)
anova(lm.model)
```


```{r  echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data = DelayGammabyGroup,  aes(x = Epoch, y = Gamma_Event_Duration,  color = Group, group = Group )) + geom_point() + stat_smooth(method='lm') + stat_smooth(method='lm') + ggtitle("Average Duration of Gamma Events across the Delay Period") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Time") + ylab("Duration of Events")

```
Group 1: 10-15 years old, Group 2: 16- 20 years old, Group 3: 21 - 25 years old, Group 4: 26+ years old


```{r  echo=FALSE, message=FALSE, warning=FALSE}
lm.model <- lm(data=DelayGammabyGroup, Gamma_Event_Duration ~ Epoch + Group)
anova(lm.model)
```

### Across Age
```{r  echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data = allDelayEpochs,  aes(x = age, y = Gamma_Trial_Power,  color = Epoch, group = Epoch )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Gamma Power across Age \nfor Each Delay Epoch ") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power")
```

```{r  echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data = allDelayGamma,  aes(x = age, y = Gamma_Event_Number,  color = epoch, group = epoch )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Number of Gamma Events across Age \nfor Each Delay Epoch ") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Number of Events")
```

```{r  echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data = allDelayGamma,  aes(x = age, y = Gamma_Event_Duration,  color = epoch, group = epoch )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Duration of Gamma Events across Age \nfor Each Delay Epoch ") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Duration of Events")
```



## Alpha Frequency Band 
### Across Time
```{r  echo=FALSE, message=FALSE, warning=FALSE}
AlphaDelay1_2 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Alpha/Delay1_2/Alpha_all_data.csv')
AlphaDelay2_3 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Alpha/Delay2_3/Alpha_all_data2_3.csv')
AlphaDelay3_4 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Alpha/Delay3_4/Alpha_all_data3_4.csv')
AlphaDelay4_5 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Alpha/Delay4_5/Alpha_all_data4_5.csv')
AlphaDelay5_6 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Alpha/Delay5_6/Alpha_all_data5_6.csv')

AlphaDelay1_2$log10_Alpha_Trial_Power <- log10(AlphaDelay1_2$Alpha_Trial_Power)
AlphaDelay2_3$log10_Alpha_Trial_Power <- log10(AlphaDelay2_3$Alpha_Trial_Power)
AlphaDelay3_4$log10_Alpha_Trial_Power <- log10(AlphaDelay3_4$Alpha_Trial_Power)
AlphaDelay4_5$log10_Alpha_Trial_Power <- log10(AlphaDelay4_5$Alpha_Trial_Power)
AlphaDelay5_6$log10_Alpha_Trial_Power <- log10(AlphaDelay5_6$Alpha_Trial_Power)

Avg_power1_2 <- aggregate(log10_Alpha_Trial_Power~ Subject, AlphaDelay1_2[AlphaDelay1_2$Alpha_Trial_Power > 0,], mean)
Avg_power2_3 <- aggregate(log10_Alpha_Trial_Power~ Subject, AlphaDelay2_3[AlphaDelay2_3$Alpha_Trial_Power > 0,], mean)
Avg_power3_4 <- aggregate(log10_Alpha_Trial_Power~ Subject, AlphaDelay3_4[AlphaDelay3_4$Alpha_Trial_Power > 0,], mean)
Avg_power4_5 <- aggregate(log10_Alpha_Trial_Power~ Subject, AlphaDelay4_5[AlphaDelay4_5$Alpha_Trial_Power > 0,], mean)
Avg_power5_6 <- aggregate(log10_Alpha_Trial_Power~ Subject, AlphaDelay5_6[AlphaDelay5_6$Alpha_Trial_Power > 0,], mean)

sd_power1_2 <- aggregate(log10_Alpha_Trial_Power ~ Subject, AlphaDelay1_2[AlphaDelay1_2$Alpha_Trial_Power > 0,], sd)
sd_power2_3 <- aggregate(log10_Alpha_Trial_Power ~ Subject, AlphaDelay2_3[AlphaDelay2_3$Alpha_Trial_Power > 0,], sd)
sd_power3_4 <- aggregate(log10_Alpha_Trial_Power ~ Subject, AlphaDelay3_4[AlphaDelay3_4$Alpha_Trial_Power > 0,], sd)
sd_power4_5 <- aggregate(log10_Alpha_Trial_Power ~ Subject, AlphaDelay4_5[AlphaDelay4_5$Alpha_Trial_Power > 0,], sd)
sd_power5_6 <- aggregate(log10_Alpha_Trial_Power ~ Subject, AlphaDelay5_6[AlphaDelay5_6$Alpha_Trial_Power > 0,], sd)

#delay 1-2
Avg_AlphaDelay1_2 <- setNames(aggregate(list(AlphaDelay1_2$Alpha_Event_Number, AlphaDelay1_2$Alpha_Event_Duration), by = list(AlphaDelay1_2$Subject),mean), c("Subject", "Alpha_Event_Number","Alpha_Event_Duration"))

SD_AlphaDelay1_2 <- setNames(aggregate(list(AlphaDelay1_2$Alpha_Event_Number, AlphaDelay1_2$Alpha_Event_Duration), by = list(AlphaDelay1_2$Subject),sd), c("Subject", "Alpha_Event_Number_SD","Alpha_Event_Duration_SD"))

Avg_AlphaDelay1_2 <- merge(Avg_AlphaDelay1_2, Avg_power1_2, by = "Subject", suffix = c("", "_mean"))
Avg_AlphaDelay1_2 <- merge(Avg_AlphaDelay1_2, sd_power1_2, by = "Subject", suffix = c("", "_SD"))
Avg_AlphaDelay1_2 <- merge(Avg_AlphaDelay1_2, SD_AlphaDelay1_2, by = "Subject")


#delay 2-3
Avg_AlphaDelay2_3 <- setNames(aggregate(list(AlphaDelay2_3$Alpha_Event_Number, AlphaDelay2_3$Alpha_Event_Duration), by = list(AlphaDelay2_3$Subject),mean), c("Subject", "Alpha_Event_Number","Alpha_Event_Duration"))
Avg_AlphaDelay2_3 <- merge(Avg_AlphaDelay2_3, Avg_power2_3, by = "Subject")
Avg_AlphaDelay2_3 <- merge(Avg_AlphaDelay2_3, sd_power2_3, by = "Subject",suffix = c("", "_SD"))

SD_AlphaDelay2_3 <- setNames(aggregate(list(AlphaDelay2_3$Alpha_Event_Number, AlphaDelay2_3$Alpha_Event_Duration), by = list(AlphaDelay2_3$Subject),sd), c("Subject", "Alpha_Event_Number_SD","Alpha_Event_Duration_SD"))
Avg_AlphaDelay2_3 <- merge(Avg_AlphaDelay2_3, SD_AlphaDelay2_3, by = "Subject")


#delay 3-4
Avg_AlphaDelay3_4 <- setNames(aggregate(list(AlphaDelay3_4$Alpha_Event_Number, AlphaDelay3_4$Alpha_Event_Duration), by = list(AlphaDelay3_4$Subject),mean), c("Subject", "Alpha_Event_Number","Alpha_Event_Duration"))
Avg_AlphaDelay3_4 <- merge(Avg_AlphaDelay3_4, Avg_power3_4, by = "Subject")
Avg_AlphaDelay3_4 <- merge(Avg_AlphaDelay3_4, sd_power3_4, by = "Subject", suffix = c("", "_SD"))

SD_AlphaDelay3_4 <- setNames(aggregate(list(AlphaDelay3_4$Alpha_Event_Number, AlphaDelay3_4$Alpha_Event_Duration), by = list(AlphaDelay3_4$Subject),sd), c("Subject", "Alpha_Event_Number_SD","Alpha_Event_Duration_SD"))
Avg_AlphaDelay3_4 <- merge(Avg_AlphaDelay3_4, SD_AlphaDelay3_4, by = "Subject")


#delay 4-5
Avg_AlphaDelay4_5 <- setNames(aggregate(list(AlphaDelay4_5$Alpha_Event_Number, AlphaDelay4_5$Alpha_Event_Duration), by = list(AlphaDelay4_5$Subject),mean), c("Subject",  "Alpha_Event_Number","Alpha_Event_Duration"))
Avg_AlphaDelay4_5 <- merge(Avg_AlphaDelay4_5, Avg_power4_5, by = "Subject")
Avg_AlphaDelay4_5 <- merge(Avg_AlphaDelay4_5, sd_power4_5, by = "Subject", suffix = c("", "_SD"))


SD_AlphaDelay4_5 <- setNames(aggregate(list(AlphaDelay4_5$Alpha_Event_Number, AlphaDelay4_5$Alpha_Event_Duration), by = list(AlphaDelay4_5$Subject),sd), c("Subject", "Alpha_Event_Number_SD","Alpha_Event_Duration_SD"))
Avg_AlphaDelay4_5 <- merge(Avg_AlphaDelay4_5, SD_AlphaDelay4_5, by = "Subject")


#delay 5-6
Avg_AlphaDelay5_6 <- setNames(aggregate(list( AlphaDelay5_6$Alpha_Event_Number, AlphaDelay5_6$Alpha_Event_Duration), by = list(AlphaDelay5_6$Subject),mean), c("Subject", "Alpha_Event_Number","Alpha_Event_Duration"))
Avg_AlphaDelay5_6 <- merge(Avg_AlphaDelay5_6, Avg_power5_6, by = "Subject")
Avg_AlphaDelay5_6 <- merge(Avg_AlphaDelay5_6, sd_power5_6, by = "Subject", suffix = c("", "_SD"))

SD_AlphaDelay5_6 <- setNames(aggregate(list(AlphaDelay5_6$Alpha_Event_Number, AlphaDelay5_6$Alpha_Event_Duration), by = list(AlphaDelay5_6$Subject),sd), c("Subject", "Alpha_Event_Number_SD","Alpha_Event_Duration_SD"))
Avg_AlphaDelay5_6 <- merge(Avg_AlphaDelay5_6, SD_AlphaDelay5_6, by = "Subject")

Avg_AlphaDelay1_2$epoch <- "1-2"
Avg_AlphaDelay2_3$epoch <- "2-3"
Avg_AlphaDelay3_4$epoch <- "3-4"
Avg_AlphaDelay4_5$epoch <- "4-5"
Avg_AlphaDelay5_6$epoch <- "5-6"

allDelayAlpha <- rbind(Avg_AlphaDelay1_2, Avg_AlphaDelay2_3)
allDelayAlpha <- rbind(allDelayAlpha, Avg_AlphaDelay3_4)
allDelayAlpha <- rbind(allDelayAlpha, Avg_AlphaDelay4_5)
allDelayAlpha <- rbind(allDelayAlpha, Avg_AlphaDelay5_6)
allDelayAlpha <- merge(allDelayAlpha, agefile, by = "Subject")
allDelayAlpha <- subset(allDelayAlpha, visitno < 2)

DelayAlphabyGroup <- setNames(aggregate(list(allDelayAlpha$log10_Alpha_Trial_Power, allDelayAlpha$Alpha_Event_Number, allDelayAlpha$Alpha_Event_Duration), by = list(allDelayAlpha$Group, allDelayAlpha$epoch),mean), c("Group","Epoch", "Alpha_Trial_Power", "Alpha_Event_Number","Alpha_Event_Duration"))

ggplot(data = DelayAlphabyGroup,  aes(x = Epoch, y = Alpha_Trial_Power,  color = Group, group = Group )) + geom_point() + stat_smooth(method='lm') + ggtitle("Average Alpha Power across the Delay Period") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Time") + ylab("Power")

```
Group 1: 10-15 years old, Group 2: 16- 20 years old, Group 3: 21 - 25 years old, Group 4: 26+ years old


```{r  echo=FALSE, message=FALSE, warning=FALSE}
lm.model <- lm(data=DelayAlphabyGroup, Alpha_Trial_Power ~ Epoch + Group)
anova(lm.model)
```

```{r  echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data = DelayAlphabyGroup,  aes(x = Epoch, y = Alpha_Event_Number,  color = Group, group = Group )) + geom_point() + stat_smooth(method='lm') + ggtitle("Average Number of Alpha Events across the Delay Period") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Time") + ylab("Number of Events")

```
Group 1: 10-15 years old, Group 2: 16- 20 years old, Group 3: 21 - 25 years old, Group 4: 26+ years old

```{r  echo=FALSE, message=FALSE, warning=FALSE}
lm.model <- lm(data=DelayAlphabyGroup, Alpha_Event_Number ~ Epoch + Group)
anova(lm.model)
```

```{r  echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data = DelayAlphabyGroup,  aes(x = Epoch, y = Alpha_Event_Duration,  color = Group, group = Group )) + geom_point() + stat_smooth(method='lm') + ggtitle("Average Duration of Alpha Events across the Delay Period") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Time") + ylab("Duration of Events")

```
Group 1: 10-15 years old, Group 2: 16- 20 years old, Group 3: 21 - 25 years old, Group 4: 26+ years old

```{r  echo=FALSE, message=FALSE, warning=FALSE}
lm.model <- lm(data=DelayAlphabyGroup, Alpha_Event_Duration ~ Epoch + Group)
anova(lm.model)
```

### Across Age
```{r  echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data = allDelayAlpha,  aes(x = age, y = log10_Alpha_Trial_Power,  color = epoch, group = epoch )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Alpha Power across Age \nfor Each Delay Epoch ") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power")
```

```{r  echo=FALSE, message=FALSE, warning=FALSE}

ggplot(data = allDelayAlpha,  aes(x = age, y = Alpha_Event_Number,  color = epoch, group = epoch )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Number of Alpha Events across Age \nfor Each Delay Epoch ") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Number of Events")
```

```{r  echo=FALSE, message=FALSE, warning=FALSE}

ggplot(data = allDelayAlpha,  aes(x = age, y = Alpha_Event_Duration,  color = epoch, group = epoch )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Duration of Alpha Events across Age \nfor Each Delay Epoch ") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Duration of Events")
```

## Theta Frequency Band 

```{r  echo=FALSE, message=FALSE, warning=FALSE}
ThetaDelay1_2 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Theta/Delay1_2/Theta_all_data.csv')
ThetaDelay2_3 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Theta/Delay2_3/Theta_all_data2_3.csv')
ThetaDelay3_4 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Theta/Delay3_4/Theta_all_data3_4.csv')
ThetaDelay4_5 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Theta/Delay4_5/Theta_all_data4_5.csv')
ThetaDelay5_6 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Theta/Delay5_6/Theta_all_data5_6.csv')

ThetaDelay1_2$log10_Theta_Trial_Power <- log10(ThetaDelay1_2$Theta_Trial_Power)
ThetaDelay2_3$log10_Theta_Trial_Power <- log10(ThetaDelay2_3$Theta_Trial_Power)
ThetaDelay3_4$log10_Theta_Trial_Power <- log10(ThetaDelay3_4$Theta_Trial_Power)
ThetaDelay4_5$log10_Theta_Trial_Power <- log10(ThetaDelay4_5$Theta_Trial_Power)
ThetaDelay5_6$log10_Theta_Trial_Power <- log10(ThetaDelay5_6$Theta_Trial_Power)

Avg_power1_2 <- aggregate(log10_Theta_Trial_Power~ Subject, ThetaDelay1_2[ThetaDelay1_2$Theta_Trial_Power > 0,], mean)
Avg_power2_3 <- aggregate(log10_Theta_Trial_Power~ Subject, ThetaDelay2_3[ThetaDelay2_3$Theta_Trial_Power > 0,], mean)
Avg_power3_4 <- aggregate(log10_Theta_Trial_Power~ Subject, ThetaDelay3_4[ThetaDelay3_4$Theta_Trial_Power > 0,], mean)
Avg_power4_5 <- aggregate(log10_Theta_Trial_Power~ Subject, ThetaDelay4_5[ThetaDelay4_5$Theta_Trial_Power > 0,], mean)
Avg_power5_6 <- aggregate(log10_Theta_Trial_Power~ Subject, ThetaDelay5_6[ThetaDelay5_6$Theta_Trial_Power > 0,], mean)


sd_power1_2 <- aggregate(log10_Theta_Trial_Power ~ Subject, ThetaDelay1_2[ThetaDelay1_2$Theta_Trial_Power > 0,], sd)
sd_power2_3 <- aggregate(log10_Theta_Trial_Power ~ Subject, ThetaDelay2_3[ThetaDelay2_3$Theta_Trial_Power > 0,], sd)
sd_power3_4 <- aggregate(log10_Theta_Trial_Power ~ Subject, ThetaDelay3_4[ThetaDelay3_4$Theta_Trial_Power > 0,], sd)
sd_power4_5 <- aggregate(log10_Theta_Trial_Power ~ Subject, ThetaDelay4_5[ThetaDelay4_5$Theta_Trial_Power > 0,], sd)
sd_power5_6 <- aggregate(log10_Theta_Trial_Power ~ Subject, ThetaDelay5_6[ThetaDelay5_6$Theta_Trial_Power > 0,], sd)

#delay 1-2
Avg_ThetaDelay1_2 <- setNames(aggregate(list(ThetaDelay1_2$Theta_Event_Number, ThetaDelay1_2$Theta_Event_Duration), by = list(ThetaDelay1_2$Subject),mean), c("Subject", "Theta_Event_Number","Theta_Event_Duration"))

SD_ThetaDelay1_2 <- setNames(aggregate(list(ThetaDelay1_2$Theta_Event_Number, ThetaDelay1_2$Theta_Event_Duration), by = list(ThetaDelay1_2$Subject),sd), c("Subject", "Theta_Event_Number_SD","Theta_Event_Duration_SD"))

Avg_ThetaDelay1_2 <- merge(Avg_ThetaDelay1_2, Avg_power1_2, by = "Subject", suffix = c("", "_mean"))
Avg_ThetaDelay1_2 <- merge(Avg_ThetaDelay1_2, sd_power1_2, by = "Subject", suffix = c("", "_SD"))
Avg_ThetaDelay1_2 <- merge(Avg_ThetaDelay1_2, SD_ThetaDelay1_2, by = "Subject")


#delay 2-3
Avg_ThetaDelay2_3 <- setNames(aggregate(list(ThetaDelay2_3$Theta_Event_Number, ThetaDelay2_3$Theta_Event_Duration), by = list(ThetaDelay2_3$Subject),mean), c("Subject", "Theta_Event_Number","Theta_Event_Duration"))
Avg_ThetaDelay2_3 <- merge(Avg_ThetaDelay2_3, Avg_power2_3, by = "Subject")
Avg_ThetaDelay2_3 <- merge(Avg_ThetaDelay2_3, sd_power2_3, by = "Subject",suffix = c("", "_SD"))

SD_ThetaDelay2_3 <- setNames(aggregate(list(ThetaDelay2_3$Theta_Event_Number, ThetaDelay2_3$Theta_Event_Duration), by = list(ThetaDelay2_3$Subject),sd), c("Subject", "Theta_Event_Number_SD","Theta_Event_Duration_SD"))
Avg_ThetaDelay2_3 <- merge(Avg_ThetaDelay2_3, SD_ThetaDelay2_3, by = "Subject")


#delay 3-4
Avg_ThetaDelay3_4 <- setNames(aggregate(list(ThetaDelay3_4$Theta_Event_Number, ThetaDelay3_4$Theta_Event_Duration), by = list(ThetaDelay3_4$Subject),mean), c("Subject", "Theta_Event_Number","Theta_Event_Duration"))
Avg_ThetaDelay3_4 <- merge(Avg_ThetaDelay3_4, Avg_power3_4, by = "Subject")
Avg_ThetaDelay3_4 <- merge(Avg_ThetaDelay3_4, sd_power3_4, by = "Subject", suffix = c("", "_SD"))

SD_ThetaDelay3_4 <- setNames(aggregate(list(ThetaDelay3_4$Theta_Event_Number, ThetaDelay3_4$Theta_Event_Duration), by = list(ThetaDelay3_4$Subject),sd), c("Subject", "Theta_Event_Number_SD","Theta_Event_Duration_SD"))
Avg_ThetaDelay3_4 <- merge(Avg_ThetaDelay3_4, SD_ThetaDelay3_4, by = "Subject")


#delay 4-5
Avg_ThetaDelay4_5 <- setNames(aggregate(list(ThetaDelay4_5$Theta_Event_Number, ThetaDelay4_5$Theta_Event_Duration), by = list(ThetaDelay4_5$Subject),mean), c("Subject",  "Theta_Event_Number","Theta_Event_Duration"))
Avg_ThetaDelay4_5 <- merge(Avg_ThetaDelay4_5, Avg_power4_5, by = "Subject")
Avg_ThetaDelay4_5 <- merge(Avg_ThetaDelay4_5, sd_power4_5, by = "Subject", suffix = c("", "_SD"))


SD_ThetaDelay4_5 <- setNames(aggregate(list(ThetaDelay4_5$Theta_Event_Number, ThetaDelay4_5$Theta_Event_Duration), by = list(ThetaDelay4_5$Subject),sd), c("Subject", "Theta_Event_Number_SD","Theta_Event_Duration_SD"))
Avg_ThetaDelay4_5 <- merge(Avg_ThetaDelay4_5, SD_ThetaDelay4_5, by = "Subject")


#delay 5-6
Avg_ThetaDelay5_6 <- setNames(aggregate(list( ThetaDelay5_6$Theta_Event_Number, ThetaDelay5_6$Theta_Event_Duration), by = list(ThetaDelay5_6$Subject),mean), c("Subject", "Theta_Event_Number","Theta_Event_Duration"))
Avg_ThetaDelay5_6 <- merge(Avg_ThetaDelay5_6, Avg_power5_6, by = "Subject")
Avg_ThetaDelay5_6 <- merge(Avg_ThetaDelay5_6, sd_power5_6, by = "Subject", suffix = c("", "_SD"))

SD_ThetaDelay5_6 <- setNames(aggregate(list(ThetaDelay5_6$Theta_Event_Number, ThetaDelay5_6$Theta_Event_Duration), by = list(ThetaDelay5_6$Subject),sd), c("Subject", "Theta_Event_Number_SD","Theta_Event_Duration_SD"))
Avg_ThetaDelay5_6 <- merge(Avg_ThetaDelay5_6, SD_ThetaDelay5_6, by = "Subject")


Avg_ThetaDelay1_2$epoch <- "1-2"
Avg_ThetaDelay2_3$epoch <- "2-3"
Avg_ThetaDelay3_4$epoch <- "3-4"
Avg_ThetaDelay4_5$epoch <- "4-5"
Avg_ThetaDelay5_6$epoch <- "5-6"

allDelayTheta <- rbind(Avg_ThetaDelay1_2, Avg_ThetaDelay2_3)
allDelayTheta <- rbind(allDelayTheta, Avg_ThetaDelay3_4)
allDelayTheta <- rbind(allDelayTheta, Avg_ThetaDelay4_5)
allDelayTheta <- rbind(allDelayTheta, Avg_ThetaDelay5_6)
allDelayTheta <- merge(allDelayTheta, agefile, by = "Subject")
allDelayTheta <- subset(allDelayTheta, visitno < 2)

DelayThetabyGroup <- setNames(aggregate(list(allDelayTheta$log10_Theta_Trial_Power, allDelayTheta$Theta_Event_Number, allDelayTheta$Theta_Event_Duration), by = list(allDelayTheta$Group, allDelayTheta$epoch),mean), c("Group","Epoch", "Theta_Trial_Power", "Theta_Event_Number","Theta_Event_Duration"))

ggplot(data = DelayThetabyGroup,  aes(x = Epoch, y = Theta_Trial_Power,  color = Group, group = Group )) + geom_point() + stat_smooth(method='lm') + ggtitle("Average Theta Power across the Delay Period") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Time") + ylab("Power")

```
Group 1: 10-15 years old, Group 2: 16- 20 years old, Group 3: 21 - 25 years old, Group 4: 26+ years old


```{r  echo=FALSE, message=FALSE, warning=FALSE}
lm.model <- lm(data=DelayThetabyGroup, Theta_Trial_Power ~ Epoch + Group)
anova(lm.model)
```

```{r  echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data = DelayThetabyGroup,  aes(x = Epoch, y = Theta_Event_Number,  color = Group, group = Group )) + geom_point() + stat_smooth(method='lm') + ggtitle("Average Number of Theta Events across the Delay Period") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Time") + ylab("Number of Events")

```
Group 1: 10-15 years old, Group 2: 16- 20 years old, Group 3: 21 - 25 years old, Group 4: 26+ years old

```{r  echo=FALSE, message=FALSE, warning=FALSE}
lm.model <- lm(data=DelayThetabyGroup, Theta_Event_Number ~ Epoch + Group)
anova(lm.model)
```

```{r  echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data = DelayThetabyGroup,  aes(x = Epoch, y = Theta_Event_Duration,  color = Group, group = Group )) + geom_point() + stat_smooth(method='lm') + ggtitle("Average Duration of Theta Events across the Delay Period") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Time") + ylab("Duration of Events")

```
Group 1: 10-15 years old, Group 2: 16- 20 years old, Group 3: 21 - 25 years old, Group 4: 26+ years old

```{r  echo=FALSE, message=FALSE, warning=FALSE}
lm.model <- lm(data=DelayThetabyGroup, Theta_Event_Duration ~ Epoch + Group)
anova(lm.model)
```

### Across Age
```{r  echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data = allDelayTheta,  aes(x = age, y = log10_Theta_Trial_Power,  color = epoch, group = epoch )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Theta Power across Age \nfor Each Delay Epoch ") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power")
```

```{r  echo=FALSE, message=FALSE, warning=FALSE}

ggplot(data = allDelayTheta,  aes(x = age, y = Theta_Event_Number,  color = epoch, group = epoch )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Number of Theta Events across Age \nfor Each Delay Epoch ") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Number of Events")
```

```{r  echo=FALSE, message=FALSE, warning=FALSE}

ggplot(data = allDelayTheta,  aes(x = age, y = Theta_Event_Duration,  color = epoch, group = epoch )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Duration of Theta Events across Age \nfor Each Delay Epoch ") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Duration of Events")
```

## Beta Frequency Band 

```{r  echo=FALSE, message=FALSE, warning=FALSE}
BetaDelay1_2 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Beta/Delay1_2/Beta_all_data.csv')
BetaDelay2_3 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Beta/Delay2_3/Beta_all_data2_3.csv')
BetaDelay3_4 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Beta/Delay3_4/Beta_all_data3_4.csv')
BetaDelay4_5 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Beta/Delay4_5/Beta_all_data4_5.csv')
BetaDelay5_6 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Beta/Delay5_6/Beta_all_data5_6.csv')

BetaDelay1_2$log10_Beta_Trial_Power <- log10(BetaDelay1_2$Beta_Trial_Power)
BetaDelay2_3$log10_Beta_Trial_Power <- log10(BetaDelay2_3$Beta_Trial_Power)
BetaDelay3_4$log10_Beta_Trial_Power <- log10(BetaDelay3_4$Beta_Trial_Power)
BetaDelay4_5$log10_Beta_Trial_Power <- log10(BetaDelay4_5$Beta_Trial_Power)
BetaDelay5_6$log10_Beta_Trial_Power <- log10(BetaDelay5_6$Beta_Trial_Power)

Avg_power1_2 <- aggregate(log10_Beta_Trial_Power~ Subject, BetaDelay1_2[BetaDelay1_2$Beta_Trial_Power > 0,], mean)
Avg_power2_3 <- aggregate(log10_Beta_Trial_Power~ Subject, BetaDelay2_3[BetaDelay2_3$Beta_Trial_Power > 0,], mean)
Avg_power3_4 <- aggregate(log10_Beta_Trial_Power~ Subject, BetaDelay3_4[BetaDelay3_4$Beta_Trial_Power > 0,], mean)
Avg_power4_5 <- aggregate(log10_Beta_Trial_Power~ Subject, BetaDelay4_5[BetaDelay4_5$Beta_Trial_Power > 0,], mean)
Avg_power5_6 <- aggregate(log10_Beta_Trial_Power~ Subject, BetaDelay5_6[BetaDelay5_6$Beta_Trial_Power > 0,], mean)


sd_power1_2 <- aggregate(log10_Beta_Trial_Power ~ Subject, BetaDelay1_2[BetaDelay1_2$Beta_Trial_Power > 0,], sd)
sd_power2_3 <- aggregate(log10_Beta_Trial_Power ~ Subject, BetaDelay2_3[BetaDelay2_3$Beta_Trial_Power > 0,], sd)
sd_power3_4 <- aggregate(log10_Beta_Trial_Power ~ Subject, BetaDelay3_4[BetaDelay3_4$Beta_Trial_Power > 0,], sd)
sd_power4_5 <- aggregate(log10_Beta_Trial_Power ~ Subject, BetaDelay4_5[BetaDelay4_5$Beta_Trial_Power > 0,], sd)
sd_power5_6 <- aggregate(log10_Beta_Trial_Power ~ Subject, BetaDelay5_6[BetaDelay5_6$Beta_Trial_Power > 0,], sd)

#delay 1-2
Avg_BetaDelay1_2 <- setNames(aggregate(list(BetaDelay1_2$Beta_Event_Number, BetaDelay1_2$Beta_Event_Duration), by = list(BetaDelay1_2$Subject),mean), c("Subject", "Beta_Event_Number","Beta_Event_Duration"))

SD_BetaDelay1_2 <- setNames(aggregate(list(BetaDelay1_2$Beta_Event_Number, BetaDelay1_2$Beta_Event_Duration), by = list(BetaDelay1_2$Subject),sd), c("Subject", "Beta_Event_Number_SD","Beta_Event_Duration_SD"))

Avg_BetaDelay1_2 <- merge(Avg_BetaDelay1_2, Avg_power1_2, by = "Subject", suffix = c("", "_mean"))
Avg_BetaDelay1_2 <- merge(Avg_BetaDelay1_2, sd_power1_2, by = "Subject", suffix = c("", "_SD"))
Avg_BetaDelay1_2 <- merge(Avg_BetaDelay1_2, SD_BetaDelay1_2, by = "Subject")


#delay 2-3
Avg_BetaDelay2_3 <- setNames(aggregate(list(BetaDelay2_3$Beta_Event_Number, BetaDelay2_3$Beta_Event_Duration), by = list(BetaDelay2_3$Subject),mean), c("Subject", "Beta_Event_Number","Beta_Event_Duration"))
Avg_BetaDelay2_3 <- merge(Avg_BetaDelay2_3, Avg_power2_3, by = "Subject")
Avg_BetaDelay2_3 <- merge(Avg_BetaDelay2_3, sd_power2_3, by = "Subject",suffix = c("", "_SD"))

SD_BetaDelay2_3 <- setNames(aggregate(list(BetaDelay2_3$Beta_Event_Number, BetaDelay2_3$Beta_Event_Duration), by = list(BetaDelay2_3$Subject),sd), c("Subject", "Beta_Event_Number_SD","Beta_Event_Duration_SD"))
Avg_BetaDelay2_3 <- merge(Avg_BetaDelay2_3, SD_BetaDelay2_3, by = "Subject")


#delay 3-4
Avg_BetaDelay3_4 <- setNames(aggregate(list(BetaDelay3_4$Beta_Event_Number, BetaDelay3_4$Beta_Event_Duration), by = list(BetaDelay3_4$Subject),mean), c("Subject", "Beta_Event_Number","Beta_Event_Duration"))
Avg_BetaDelay3_4 <- merge(Avg_BetaDelay3_4, Avg_power3_4, by = "Subject")
Avg_BetaDelay3_4 <- merge(Avg_BetaDelay3_4, sd_power3_4, by = "Subject", suffix = c("", "_SD"))

SD_BetaDelay3_4 <- setNames(aggregate(list(BetaDelay3_4$Beta_Event_Number, BetaDelay3_4$Beta_Event_Duration), by = list(BetaDelay3_4$Subject),sd), c("Subject", "Beta_Event_Number_SD","Beta_Event_Duration_SD"))
Avg_BetaDelay3_4 <- merge(Avg_BetaDelay3_4, SD_BetaDelay3_4, by = "Subject")


#delay 4-5
Avg_BetaDelay4_5 <- setNames(aggregate(list(BetaDelay4_5$Beta_Event_Number, BetaDelay4_5$Beta_Event_Duration), by = list(BetaDelay4_5$Subject),mean), c("Subject",  "Beta_Event_Number","Beta_Event_Duration"))
Avg_BetaDelay4_5 <- merge(Avg_BetaDelay4_5, Avg_power4_5, by = "Subject")
Avg_BetaDelay4_5 <- merge(Avg_BetaDelay4_5, sd_power4_5, by = "Subject", suffix = c("", "_SD"))


SD_BetaDelay4_5 <- setNames(aggregate(list(BetaDelay4_5$Beta_Event_Number, BetaDelay4_5$Beta_Event_Duration), by = list(BetaDelay4_5$Subject),sd), c("Subject", "Beta_Event_Number_SD","Beta_Event_Duration_SD"))
Avg_BetaDelay4_5 <- merge(Avg_BetaDelay4_5, SD_BetaDelay4_5, by = "Subject")


#delay 5-6
Avg_BetaDelay5_6 <- setNames(aggregate(list( BetaDelay5_6$Beta_Event_Number, BetaDelay5_6$Beta_Event_Duration), by = list(BetaDelay5_6$Subject),mean), c("Subject", "Beta_Event_Number","Beta_Event_Duration"))
Avg_BetaDelay5_6 <- merge(Avg_BetaDelay5_6, Avg_power5_6, by = "Subject")
Avg_BetaDelay5_6 <- merge(Avg_BetaDelay5_6, sd_power5_6, by = "Subject", suffix = c("", "_SD"))

SD_BetaDelay5_6 <- setNames(aggregate(list(BetaDelay5_6$Beta_Event_Number, BetaDelay5_6$Beta_Event_Duration), by = list(BetaDelay5_6$Subject),sd), c("Subject", "Beta_Event_Number_SD","Beta_Event_Duration_SD"))
Avg_BetaDelay5_6 <- merge(Avg_BetaDelay5_6, SD_BetaDelay5_6, by = "Subject")

Avg_BetaDelay1_2$epoch <- "1-2"
Avg_BetaDelay2_3$epoch <- "2-3"
Avg_BetaDelay3_4$epoch <- "3-4"
Avg_BetaDelay4_5$epoch <- "4-5"
Avg_BetaDelay5_6$epoch <- "5-6"

allDelayBeta <- rbind(Avg_BetaDelay1_2, Avg_BetaDelay2_3)
allDelayBeta <- rbind(allDelayBeta, Avg_BetaDelay3_4)
allDelayBeta <- rbind(allDelayBeta, Avg_BetaDelay4_5)
allDelayBeta <- rbind(allDelayBeta, Avg_BetaDelay5_6)
allDelayBeta <- merge(allDelayBeta, agefile, by = "Subject")
allDelayBeta <- subset(allDelayBeta, visitno < 2)

DelayBetabyGroup <- setNames(aggregate(list(allDelayBeta$log10_Beta_Trial_Power, allDelayBeta$Beta_Event_Number, allDelayBeta$Beta_Event_Duration), by = list(allDelayBeta$Group, allDelayBeta$epoch),mean), c("Group","Epoch", "Beta_Trial_Power", "Beta_Event_Number","Beta_Event_Duration"))

ggplot(data = DelayBetabyGroup,  aes(x = Epoch, y = Beta_Trial_Power,  color = Group, group = Group )) + geom_point() + stat_smooth(method='lm') + ggtitle("Average Beta Power across the Delay Period") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Time") + ylab("Power")

```
Group 1: 10-15 years old, Group 2: 16- 20 years old, Group 3: 21 - 25 years old, Group 4: 26+ years old


```{r  echo=FALSE, message=FALSE, warning=FALSE}
lm.model <- lm(data=DelayBetabyGroup, Beta_Trial_Power ~ Epoch + Group)
anova(lm.model)
```

```{r  echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data = DelayBetabyGroup,  aes(x = Epoch, y = Beta_Event_Number,  color = Group, group = Group )) + geom_point() + stat_smooth(method='lm') + ggtitle("Average Number of Beta Events across the Delay Period") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Time") + ylab("Number of Events")

```
Group 1: 10-15 years old, Group 2: 16- 20 years old, Group 3: 21 - 25 years old, Group 4: 26+ years old

```{r  echo=FALSE, message=FALSE, warning=FALSE}
lm.model <- lm(data=DelayBetabyGroup, Beta_Event_Number ~ Epoch + Group)
anova(lm.model)
```

```{r  echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data = DelayBetabyGroup,  aes(x = Epoch, y = Beta_Event_Duration,  color = Group, group = Group )) + geom_point() + stat_smooth(method='lm') + ggtitle("Average Duration of Beta Events across the Delay Period") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Time") + ylab("Duration of Events")

```
Group 1: 10-15 years old, Group 2: 16- 20 years old, Group 3: 21 - 25 years old, Group 4: 26+ years old

```{r  echo=FALSE, message=FALSE, warning=FALSE}
lm.model <- lm(data=DelayBetabyGroup, Beta_Event_Duration ~ Epoch + Group)
anova(lm.model)
```

### Across Age
```{r  echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data = allDelayBeta,  aes(x = age, y = log10_Beta_Trial_Power,  color = epoch, group = epoch )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Beta Power across Age \nfor Each Delay Epoch ") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power")
```

```{r  echo=FALSE, message=FALSE, warning=FALSE}

ggplot(data = allDelayBeta,  aes(x = age, y = Beta_Event_Number,  color = epoch, group = epoch )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Number of Beta Events across Age \nfor Each Delay Epoch ") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Number of Events")
```

```{r  echo=FALSE, message=FALSE, warning=FALSE}

ggplot(data = allDelayBeta,  aes(x = age, y = Beta_Event_Duration,  color = epoch, group = epoch )) + geom_point() + stat_smooth(method ='lm',  formula='y~I(1/x)') + ggtitle("Average Duration of Beta Events across Age \nfor Each Delay Epoch ") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Duration of Events")
```







# All Delay Period Epochs Averaged Together 


## All Frequency Bands Across Age 

```{r  echo=FALSE, message=FALSE, warning=FALSE}

delayGamma <- setNames(aggregate(list(allDelayGamma$log10_Gamma_Trial_Power,allDelayGamma$log10_Gamma_Trial_Power_SD, allDelayGamma$Gamma_Event_Number, allDelayGamma$Gamma_Event_Number_SD, allDelayGamma$Gamma_Event_Duration, allDelayGamma$Gamma_Event_Duration_SD), by = list(allDelayGamma$Subject),mean), c("Subject", "Trial_Power","Trial_Power_Variability", "Event_Number","Event_Number_Variability", "Event_Duration", "Event_Duration_Variability"))

delayAlpha <- setNames(aggregate(list(allDelayAlpha$log10_Alpha_Trial_Power,allDelayAlpha$log10_Alpha_Trial_Power_SD, allDelayAlpha$Alpha_Event_Number, allDelayAlpha$Alpha_Event_Number_SD, allDelayAlpha$Alpha_Event_Duration, allDelayAlpha$Alpha_Event_Duration_SD), by = list(allDelayAlpha$Subject),mean), c("Subject", "Trial_Power","Trial_Power_Variability", "Event_Number","Event_Number_Variability", "Event_Duration", "Event_Duration_Variability"))

delayTheta <- setNames(aggregate(list(allDelayTheta$log10_Theta_Trial_Power,allDelayTheta$log10_Theta_Trial_Power_SD, allDelayTheta$Theta_Event_Number, allDelayTheta$Theta_Event_Number_SD, allDelayTheta$Theta_Event_Duration, allDelayTheta$Theta_Event_Duration_SD), by = list(allDelayTheta$Subject),mean), c("Subject", "Trial_Power","Trial_Power_Variability", "Event_Number","Event_Number_Variability", "Event_Duration", "Event_Duration_Variability"))

delayBeta <- setNames(aggregate(list(allDelayBeta$log10_Beta_Trial_Power,allDelayBeta$log10_Beta_Trial_Power_SD, allDelayBeta$Beta_Event_Number, allDelayBeta$Beta_Event_Number_SD, allDelayBeta$Beta_Event_Duration, allDelayBeta$Beta_Event_Duration_SD), by = list(allDelayBeta$Subject),mean), c("Subject", "Trial_Power","Trial_Power_Variability", "Event_Number","Event_Number_Variability", "Event_Duration", "Event_Duration_Variability"))


delayGamma$Band <- "Gamma"
delayBeta$Band <- "Beta"
delayTheta$Band <- "Theta"
delayAlpha$Band <- "Alpha"


allBands <- rbind(delayGamma, delayBeta)
allBands <- rbind(allBands, delayTheta)
allBands <- rbind(allBands, delayAlpha)

allBands <- merge(allBands, agefile, by = "Subject")

ggplot(data = allBands[allBands$visitno <2,], aes(x = age , y = Trial_Power, color = Band, group = Band))  + stat_smooth(method = 'lm',  formula='y~I(1/x)') + ggtitle("Average Trial Power across Age ") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power")

ggplot(data = allBands[allBands$visitno <2,], aes(x = age , y = Event_Number, color = Band, group = Band))  + stat_smooth(method = 'lm',  formula='y~I(1/x)') + ggtitle("Average Event Number across Age ") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Number of Events")


ggplot(data = allBands[allBands$visitno <2,], aes(x = age , y = Event_Duration, color = Band, group = Band))  + stat_smooth(method = 'lm',  formula='y~I(1/x)') + ggtitle("Average Event Duration across Age ") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Duration of Events")

```

### Gamma Frequency 
```{r  echo=FALSE, message=FALSE, warning=FALSE}

delayGamma <- merge(delayGamma, agefile, by = "Subject", suffix = c("", ""))
delayGamma$ageInverse <- 1/delayGamma$age

#average 
avgGamma <- aggregate(Trial_Power ~ visitno , delayGamma, mean)
sdGamma <- aggregate(Trial_Power ~ visitno , delayGamma, sd)
cutoff <- 3* sdGamma[1,2] + avgGamma[1,2]

ggplot(data = delayGamma[delayGamma$visitno < 2 & delayGamma$Trial_Power < cutoff,],  aes(x = age, y = Trial_Power )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Gamma Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power")

lm.model <- lm(data=delayGamma[delayGamma$visitno < 2 & delayGamma$Trial_Power < cutoff,], Trial_Power ~ ageInverse)
anova(lm.model)

#power variability
avgGamma <- aggregate(Trial_Power_Variability ~ visitno , delayGamma, mean)
sdGamma <- aggregate(Trial_Power_Variability ~ visitno , delayGamma, sd)
cutoff <- 3* sdGamma[1,2] + avgGamma[1,2]

ggplot(data = delayGamma[delayGamma$visitno < 2 & delayGamma$Trial_Power_Variability < cutoff,],  aes(x = age, y = Trial_Power_Variability )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Gamma Power vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Power)")
lm.model <- lm(data=delayGamma[delayGamma$visitno < 2  & delayGamma$Trial_Power_Variability < cutoff,], Trial_Power_Variability ~ ageInverse)
anova(lm.model)


#event duration 
avgGamma <- aggregate(Event_Duration ~ visitno , delayGamma, mean)
sdGamma <- aggregate(Event_Duration ~ visitno , delayGamma, sd)
cutoff <- 3* sdGamma[1,2] + avgGamma[1,2]

ggplot(data = delayGamma[delayGamma$visitno < 2 & delayGamma$Event_Duration < cutoff,],  aes(x = age, y = Event_Duration)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Gamma Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("Duration")
lm.model <- lm(data=delayGamma[delayGamma$visitno < 2 & delayGamma$Event_Duration < cutoff,], Event_Duration ~ ageInverse)
anova(lm.model)


#event duration variability
avgGamma <- aggregate(Event_Duration_Variability ~ visitno , delayGamma, mean)
sdGamma <- aggregate(Event_Duration_Variability ~ visitno , delayGamma, sd)
cutoff <- 3* sdGamma[1,2] + avgGamma[1,2]

ggplot(data = delayGamma[delayGamma$visitno < 2 & delayGamma$Event_Duration_Variability < cutoff,],  aes(x = age, y = Event_Duration_Variability )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Varibaility of Gamma Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Duration)")
lm.model <- lm(data=delayGamma[delayGamma$visitno < 2 & delayGamma$Event_Duration_Variability < cutoff,], Event_Duration_Variability ~ ageInverse)
anova(lm.model)

#event number
avgGamma <- aggregate(Event_Number ~ visitno , delayGamma, mean)
sdGamma <- aggregate(Event_Number ~ visitno , delayGamma, sd)
cutoff <- 3* sdGamma[1,2] + avgGamma[1,2]

ggplot(data = delayGamma[delayGamma$visitno < 2  & delayGamma$Event_Number < cutoff,],  aes(x = age, y = Event_Number )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Average Gamma Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("Number of Events")
lm.model <- lm(data=delayGamma[delayGamma$visitno < 2  & delayGamma$Event_Number < cutoff,], Event_Number ~ ageInverse)
anova(lm.model)


#event number variability
avgGamma <- aggregate(Event_Number_Variability ~ visitno , delayGamma, mean)
sdGamma <- aggregate(Event_Number_Variability ~ visitno , delayGamma, sd)
cutoff <- 3* sdGamma[1,2] + avgGamma[1,2]

ggplot(data = delayGamma[delayGamma$visitno < 2 & delayGamma$Event_Number_Variability < cutoff,],  aes(x = age, y = Event_Number_Variability )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Varibaility of Gamma Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Number of Events)")
lm.model <- lm(data=delayGamma[delayGamma$visitno < 2 & delayGamma$Event_Number_Variability < cutoff,], Event_Number_Variability ~ ageInverse)
anova(lm.model)
```

### Alpha Frequency 
```{r  echo=FALSE, message=FALSE, warning=FALSE}

delayAlpha <- merge(delayAlpha, agefile, by = "Subject", suffix = c("", ""))
delayAlpha$ageInverse <- 1/delayAlpha$age


#average 
avgAlpha <- aggregate(Trial_Power ~ visitno , delayAlpha, mean)
sdAlpha <- aggregate(Trial_Power ~ visitno , delayAlpha, sd)
cutoff <- 3* sdAlpha[1,2] + avgAlpha[1,2]

ggplot(data = delayAlpha[delayAlpha$visitno < 2 & delayAlpha$Trial_Power < cutoff,],  aes(x = age, y = Trial_Power )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Alpha Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power")

lm.model <- lm(data=delayAlpha[delayAlpha$visitno < 2 & delayAlpha$Trial_Power < cutoff,], Trial_Power ~ ageInverse)
anova(lm.model)

#power variability
avgAlpha <- aggregate(Trial_Power_Variability ~ visitno , delayAlpha, mean)
sdAlpha <- aggregate(Trial_Power_Variability ~ visitno , delayAlpha, sd)
cutoff <- 3* sdAlpha[1,2] + avgAlpha[1,2]

ggplot(data = delayAlpha[delayAlpha$visitno < 2 & delayAlpha$Trial_Power_Variability < cutoff,],  aes(x = age, y = Trial_Power_Variability )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Alpha Power vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Power)")
lm.model <- lm(data=delayAlpha[delayAlpha$visitno < 2  & delayAlpha$Trial_Power_Variability < cutoff,], Trial_Power_Variability ~ ageInverse)
anova(lm.model)


#event duration 
avgAlpha <- aggregate(Event_Duration ~ visitno , delayAlpha, mean)
sdAlpha <- aggregate(Event_Duration ~ visitno , delayAlpha, sd)
cutoff <- 3* sdAlpha[1,2] + avgAlpha[1,2]

ggplot(data = delayAlpha[delayAlpha$visitno < 2 & delayAlpha$Event_Duration < cutoff,],  aes(x = age, y = Event_Duration)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Alpha Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("Duration")
lm.model <- lm(data=delayAlpha[delayAlpha$visitno < 2 & delayAlpha$Event_Duration < cutoff,], Event_Duration ~ ageInverse)
anova(lm.model)


#event duration variability
avgAlpha <- aggregate(Event_Duration_Variability ~ visitno , delayAlpha, mean)
sdAlpha <- aggregate(Event_Duration_Variability ~ visitno , delayAlpha, sd)
cutoff <- 3* sdAlpha[1,2] + avgAlpha[1,2]

ggplot(data = delayAlpha[delayAlpha$visitno < 2 & delayAlpha$Event_Duration_Variability < cutoff,],  aes(x = age, y = Event_Duration_Variability )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Varibaility of Alpha Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Duration)")
lm.model <- lm(data=delayAlpha[delayAlpha$visitno < 2 & delayAlpha$Event_Duration_Variability < cutoff,], Event_Duration_Variability ~ ageInverse)
anova(lm.model)

#event number
avgAlpha <- aggregate(Event_Number ~ visitno , delayAlpha, mean)
sdAlpha <- aggregate(Event_Number ~ visitno , delayAlpha, sd)
cutoff <- 3* sdAlpha[1,2] + avgAlpha[1,2]

ggplot(data = delayAlpha[delayAlpha$visitno < 2  & delayAlpha$Event_Number < cutoff,],  aes(x = age, y = Event_Number )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Average Alpha Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("Number of Events")
lm.model <- lm(data=delayAlpha[delayAlpha$visitno < 2  & delayAlpha$Event_Number < cutoff,], Event_Number ~ ageInverse)
anova(lm.model)


#event number variability
avgAlpha <- aggregate(Event_Number_Variability ~ visitno , delayAlpha, mean)
sdAlpha <- aggregate(Event_Number_Variability ~ visitno , delayAlpha, sd)
cutoff <- 3* sdAlpha[1,2] + avgAlpha[1,2]

ggplot(data = delayAlpha[delayAlpha$visitno < 2 & delayAlpha$Event_Number_Variability < cutoff,],  aes(x = age, y = Event_Number_Variability )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Varibaility of Alpha Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Number of Events)")
lm.model <- lm(data=delayAlpha[delayAlpha$visitno < 2 & delayAlpha$Event_Number_Variability < cutoff,], Event_Number_Variability ~ ageInverse)
anova(lm.model)
```

### Theta Frequency 
```{r  echo=FALSE, message=FALSE, warning=FALSE}

delayTheta <- merge(delayTheta, agefile, by = "Subject", suffix = c("", ""))
delayTheta$ageInverse <- 1/delayTheta$age


#average 
avgTheta <- aggregate(Trial_Power ~ visitno , delayTheta, mean)
sdTheta <- aggregate(Trial_Power ~ visitno , delayTheta, sd)
cutoff <- 3* sdTheta[1,2] + avgTheta[1,2]

ggplot(data = delayTheta[delayTheta$visitno < 2 & delayTheta$Trial_Power < cutoff,],  aes(x = age, y = Trial_Power )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Theta Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power")

lm.model <- lm(data=delayTheta[delayTheta$visitno < 2 & delayTheta$Trial_Power < cutoff,], Trial_Power ~ ageInverse)
anova(lm.model)

#power variability
avgTheta <- aggregate(Trial_Power_Variability ~ visitno , delayTheta, mean)
sdTheta <- aggregate(Trial_Power_Variability ~ visitno , delayTheta, sd)
cutoff <- 3* sdTheta[1,2] + avgTheta[1,2]

ggplot(data = delayTheta[delayTheta$visitno < 2 & delayTheta$Trial_Power_Variability < cutoff,],  aes(x = age, y = Trial_Power_Variability )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Theta Power vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Power)")
lm.model <- lm(data=delayTheta[delayTheta$visitno < 2  & delayTheta$Trial_Power_Variability < cutoff,], Trial_Power_Variability ~ ageInverse)
anova(lm.model)


#event duration 
avgTheta <- aggregate(Event_Duration ~ visitno , delayTheta, mean)
sdTheta <- aggregate(Event_Duration ~ visitno , delayTheta, sd)
cutoff <- 3* sdTheta[1,2] + avgTheta[1,2]

ggplot(data = delayTheta[delayTheta$visitno < 2 & delayTheta$Event_Duration < cutoff,],  aes(x = age, y = Event_Duration)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Theta Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("Duration")
lm.model <- lm(data=delayTheta[delayTheta$visitno < 2 & delayTheta$Event_Duration < cutoff,], Event_Duration ~ ageInverse)
anova(lm.model)


#event duration variability
avgTheta <- aggregate(Event_Duration_Variability ~ visitno , delayTheta, mean)
sdTheta <- aggregate(Event_Duration_Variability ~ visitno , delayTheta, sd)
cutoff <- 3* sdTheta[1,2] + avgTheta[1,2]

ggplot(data = delayTheta[delayTheta$visitno < 2 & delayTheta$Event_Duration_Variability < cutoff,],  aes(x = age, y = Event_Duration_Variability )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Varibaility of Theta Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Duration)")
lm.model <- lm(data=delayTheta[delayTheta$visitno < 2 & delayTheta$Event_Duration_Variability < cutoff,], Event_Duration_Variability ~ ageInverse)
anova(lm.model)

#event number
avgTheta <- aggregate(Event_Number ~ visitno , delayTheta, mean)
sdTheta <- aggregate(Event_Number ~ visitno , delayTheta, sd)
cutoff <- 3* sdTheta[1,2] + avgTheta[1,2]

ggplot(data = delayTheta[delayTheta$visitno < 2  & delayTheta$Event_Number < cutoff,],  aes(x = age, y = Event_Number )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Average Theta Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("Number of Events")
lm.model <- lm(data=delayTheta[delayTheta$visitno < 2  & delayTheta$Event_Number < cutoff,], Event_Number ~ ageInverse)
anova(lm.model)


#event number variability
avgTheta <- aggregate(Event_Number_Variability ~ visitno , delayTheta, mean)
sdTheta <- aggregate(Event_Number_Variability ~ visitno , delayTheta, sd)
cutoff <- 3* sdTheta[1,2] + avgTheta[1,2]

ggplot(data = delayTheta[delayTheta$visitno < 2 & delayTheta$Event_Number_Variability < cutoff,],  aes(x = age, y = Event_Number_Variability )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Varibaility of Theta Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Number of Events)")
lm.model <- lm(data=delayTheta[delayTheta$visitno < 2 & delayTheta$Event_Number_Variability < cutoff,], Event_Number_Variability ~ ageInverse)
anova(lm.model)
```

### Beta Frequency 
```{r  echo=FALSE, message=FALSE, warning=FALSE}

delayBeta <- merge(delayBeta, agefile, by = "Subject", suffix = c("", ""))
delayBeta$ageInverse <- 1/delayBeta$age


#average 
avgBeta <- aggregate(Trial_Power ~ visitno , delayBeta, mean)
sdBeta <- aggregate(Trial_Power ~ visitno , delayBeta, sd)
cutoff <- 3* sdBeta[1,2] + avgBeta[1,2]

ggplot(data = delayBeta[delayBeta$visitno < 2 & delayBeta$Trial_Power < cutoff,],  aes(x = age, y = Trial_Power )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Beta Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power")

lm.model <- lm(data=delayBeta[delayBeta$visitno < 2 & delayBeta$Trial_Power < cutoff,], Trial_Power ~ ageInverse)
anova(lm.model)

#power variability
avgBeta <- aggregate(Trial_Power_Variability ~ visitno , delayBeta, mean)
sdBeta <- aggregate(Trial_Power_Variability ~ visitno , delayBeta, sd)
cutoff <- 3* sdBeta[1,2] + avgBeta[1,2]

ggplot(data = delayBeta[delayBeta$visitno < 2 & delayBeta$Trial_Power_Variability < cutoff,],  aes(x = age, y = Trial_Power_Variability )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Beta Power vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Power)")
lm.model <- lm(data=delayBeta[delayBeta$visitno < 2  & delayBeta$Trial_Power_Variability < cutoff,], Trial_Power_Variability ~ ageInverse)
anova(lm.model)


#event duration 
avgBeta <- aggregate(Event_Duration ~ visitno , delayBeta, mean)
sdBeta <- aggregate(Event_Duration ~ visitno , delayBeta, sd)
cutoff <- 3* sdBeta[1,2] + avgBeta[1,2]

ggplot(data = delayBeta[delayBeta$visitno < 2 & delayBeta$Event_Duration < cutoff,],  aes(x = age, y = Event_Duration)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Beta Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("Duration")
lm.model <- lm(data=delayBeta[delayBeta$visitno < 2 & delayBeta$Event_Duration < cutoff,], Event_Duration ~ ageInverse)
anova(lm.model)


#event duration variability
avgBeta <- aggregate(Event_Duration_Variability ~ visitno , delayBeta, mean)
sdBeta <- aggregate(Event_Duration_Variability ~ visitno , delayBeta, sd)
cutoff <- 3* sdBeta[1,2] + avgBeta[1,2]

ggplot(data = delayBeta[delayBeta$visitno < 2 & delayBeta$Event_Duration_Variability < cutoff,],  aes(x = age, y = Event_Duration_Variability )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Varibaility of Beta Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Duration)")
lm.model <- lm(data=delayBeta[delayBeta$visitno < 2 & delayBeta$Event_Duration_Variability < cutoff,], Event_Duration_Variability ~ ageInverse)
anova(lm.model)

#event number
avgBeta <- aggregate(Event_Number ~ visitno , delayBeta, mean)
sdBeta <- aggregate(Event_Number ~ visitno , delayBeta, sd)
cutoff <- 3* sdBeta[1,2] + avgBeta[1,2]

ggplot(data = delayBeta[delayBeta$visitno < 2  & delayBeta$Event_Number < cutoff,],  aes(x = age, y = Event_Number )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Average Beta Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("Number of Events")
lm.model <- lm(data=delayBeta[delayBeta$visitno < 2  & delayBeta$Event_Number < cutoff,], Event_Number ~ ageInverse)
anova(lm.model)


#event number variability
avgBeta <- aggregate(Event_Number_Variability ~ visitno , delayBeta, mean)
sdBeta <- aggregate(Event_Number_Variability ~ visitno , delayBeta, sd)
cutoff <- 3* sdBeta[1,2] + avgBeta[1,2]

ggplot(data = delayBeta[delayBeta$visitno < 2 & delayBeta$Event_Number_Variability < cutoff,],  aes(x = age, y = Event_Number_Variability )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Varibaility of Beta Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Number of Events)")
lm.model <- lm(data=delayBeta[delayBeta$visitno < 2 & delayBeta$Event_Number_Variability < cutoff,], Event_Number_Variability ~ ageInverse)
anova(lm.model)
```

<!-- ## Fit Linear Mixed Effects Model -->

<!-- ```{r echo=FALSE, message=FALSE, warning=FALSE} -->

<!-- delayGamma <- merge(delayGamma, BehaviorSubject, by = "Subject") -->
<!-- delayGamma <- merge(delayGamma, BehaviorSubjectLat, by = "Subject") -->
<!-- delayGamma$absPositionError <- abs(delayGamma$PositionError) -->


<!-- delayAlpha <- merge(delayAlpha, BehaviorSubject, by = "Subject") -->
<!-- delayAlpha <- merge(delayAlpha, BehaviorSubjectLat, by = "Subject") -->
<!-- delayAlpha$absPositionError <- abs(delayAlpha$PositionError) -->

<!-- delayTheta <- merge(delayTheta, BehaviorSubject, by = "Subject") -->
<!-- delayTheta <- merge(delayTheta, BehaviorSubjectLat, by = "Subject") -->
<!-- delayTheta$absPositionError <- abs(delayTheta$PositionError) -->

<!-- delayBeta <- merge(delayBeta, BehaviorSubject, by = "Subject") -->
<!-- delayBeta <- merge(delayBeta, BehaviorSubjectLat, by = "Subject") -->
<!-- delayBeta$absPositionError <- abs(delayBeta$PositionError) -->

<!-- ``` -->



<!-- ### Gamma Band Frequency -->
<!-- #### Effect of Gamma Trial Power on Position Error  -->
<!-- ```{r echo=FALSE, message=FALSE, warning=FALSE} -->
<!-- delayGamma$Subject <- as.factor(delayGamma$Subject) -->
<!-- modelFit <- lmer(absPositionError ~ age + Trial_Power + (1|Subject), data = delayGamma[delayGamma$visitno < 2 & delayGamma$Trial_Power != '-Inf',]) -->
<!-- car::Anova(modelFit) -->
<!-- ``` -->

<!-- #### Effect of Gamma Trial Power on MGS Latency -->
<!-- ```{r echo=FALSE, message=FALSE, warning=FALSE} -->
<!-- delayGamma$Subject <- as.factor(delayGamma$Subject) -->
<!-- modelFit <- lmer(mgsLatency ~ age + Trial_Power + (1|Subject), data = delayGamma[delayGamma$visitno < 2 & delayGamma$Trial_Power != '-Inf',]) -->
<!-- car::Anova(modelFit) -->
<!-- ``` -->

<!-- #### Effect of Average Gamma Event Number on Position Error  -->
<!-- ```{r echo=FALSE, message=FALSE, warning=FALSE} -->
<!-- delayGamma$Subject <- as.factor(delayGamma$Subject) -->
<!-- modelFit <- lmer(absPositionError ~ age + Event_Number + (1|Subject), data = delayGamma[delayGamma$visitno < 2,]) -->
<!-- car::Anova(modelFit) -->
<!-- ``` -->
<!-- #### Effect of Average Gamma Event Number on MGS Latency -->
<!-- ```{r echo=FALSE, message=FALSE, warning=FALSE} -->
<!-- delayGamma$Subject <- as.factor(delayGamma$Subject) -->
<!-- modelFit <- lmer(mgsLatency ~ age + Event_Number + (1|Subject), data = delayGamma[delayGamma$visitno< 2,]) -->
<!-- car::Anova(modelFit) -->
<!-- ``` -->

<!-- #### Effect of Average Gamma Event Duration on Position Error  -->
<!-- ```{r echo=FALSE, message=FALSE, warning=FALSE} -->
<!-- delayGamma$Subject <- as.factor(delayGamma$Subject) -->
<!-- modelFit <- lmer(absPositionError ~ age + Event_Duration + (1|Subject), data = delayGamma[delayGamma$visitno < 2,]) -->
<!-- car::Anova(modelFit) -->
<!-- ``` -->
<!-- #### Effect of Average Gamma Event Duration on MGS Latency -->
<!-- ```{r echo=FALSE, message=FALSE, warning=FALSE} -->
<!-- delayGamma$Subject <- as.factor(delayGamma$Subject) -->
<!-- modelFit <- lmer(mgsLatency ~ age + Event_Duration + (1|Subject), data = delayGamma[delayGamma$visitno < 2,]) -->
<!-- car::Anova(modelFit) -->
<!-- ``` -->

<!-- ### Alpha Band Frequency -->
<!-- #### Effect of Alpha Trial Power on Position Error  -->
<!-- ```{r echo=FALSE, message=FALSE, warning=FALSE} -->
<!-- delayAlpha$Subject <- as.factor(delayAlpha$Subject) -->
<!-- modelFit <- lmer(absPositionError ~ age + Trial_Power + (1|Subject), data = delayAlpha[delayAlpha$visitno < 2 & delayAlpha$Trial_Power != '-Inf',]) -->
<!-- car::Anova(modelFit) -->
<!-- ``` -->

<!-- #### Effect of Alpha Trial Power on MGS Latency -->
<!-- ```{r echo=FALSE, message=FALSE, warning=FALSE} -->
<!-- delayAlpha$Subject <- as.factor(delayAlpha$Subject) -->
<!-- modelFit <- lmer(mgsLatency ~ age + Trial_Power + (1|Subject), data = delayAlpha[delayAlpha$visitno < 2 & delayAlpha$Trial_Power != '-Inf',]) -->
<!-- car::Anova(modelFit) -->
<!-- ``` -->

<!-- #### Effect of Average Alpha Event Number on Position Error  -->
<!-- ```{r echo=FALSE, message=FALSE, warning=FALSE} -->
<!-- delayAlpha$Subject <- as.factor(delayAlpha$Subject) -->
<!-- modelFit <- lmer(absPositionError ~ age + Event_Number + (1|Subject), data = delayAlpha[delayAlpha$visitno < 2,]) -->
<!-- car::Anova(modelFit) -->
<!-- ``` -->
<!-- #### Effect of Average Alpha Event Number on MGS Latency -->
<!-- ```{r echo=FALSE, message=FALSE, warning=FALSE} -->
<!-- delayAlpha$Subject <- as.factor(delayAlpha$Subject) -->
<!-- modelFit <- lmer(mgsLatency ~ age + Event_Number + (1|Subject), data = delayAlpha[delayAlpha$visitno < 2,]) -->
<!-- car::Anova(modelFit) -->
<!-- ``` -->

<!-- #### Effect of Average Alpha Event Duration on Position Error  -->
<!-- ```{r echo=FALSE, message=FALSE, warning=FALSE} -->
<!-- delayAlpha$Subject <- as.factor(delayAlpha$Subject) -->
<!-- modelFit <- lmer(absPositionError ~ age + Event_Duration + (1|Subject), data = delayAlpha[delayAlpha$visitno < 2,]) -->
<!-- car::Anova(modelFit) -->
<!-- ``` -->
<!-- #### Effect of Average Alpha Event Duration on MGS Latency -->
<!-- ```{r echo=FALSE, message=FALSE, warning=FALSE} -->
<!-- delayAlpha$Subject <- as.factor(delayAlpha$Subject) -->
<!-- modelFit <- lmer(mgsLatency ~ age + Event_Duration + (1|Subject), data = delayAlpha[delayAlpha$visitno < 2,]) -->
<!-- car::Anova(modelFit) -->
<!-- ``` -->

<!-- ### Theta Band Frequency -->
<!-- #### Effect of Theta Trial Power on Position Error  -->
<!-- ```{r echo=FALSE, message=FALSE, warning=FALSE} -->
<!-- delayTheta$Subject <- as.factor(delayTheta$Subject) -->
<!-- modelFit <- lmer(absPositionError ~ age + Trial_Power + (1|Subject), data = delayTheta[delayTheta$visitno < 2 & delayTheta$Trial_Power != '-Inf',]) -->
<!-- car::Anova(modelFit) -->
<!-- ``` -->

<!-- #### Effect of Theta Trial Power on MGS Latency -->
<!-- ```{r echo=FALSE, message=FALSE, warning=FALSE} -->
<!-- delayTheta$Subject <- as.factor(delayTheta$Subject) -->
<!-- modelFit <- lmer(mgsLatency ~ age + Trial_Power + (1|Subject), data = delayTheta[delayTheta$visitno < 2 & delayTheta$Trial_Power != '-Inf',]) -->
<!-- car::Anova(modelFit) -->
<!-- ``` -->

<!-- #### Effect of Average Theta Event Number on Position Error  -->
<!-- ```{r echo=FALSE, message=FALSE, warning=FALSE} -->
<!-- delayTheta$Subject <- as.factor(delayTheta$Subject) -->
<!-- modelFit <- lmer(absPositionError ~ age + Event_Number + (1|Subject), data = delayTheta[delayTheta$visitno < 2,]) -->
<!-- car::Anova(modelFit) -->
<!-- ``` -->
<!-- #### Effect of Average Theta Event Number on MGS Latency -->
<!-- ```{r echo=FALSE, message=FALSE, warning=FALSE} -->
<!-- delayTheta$Subject <- as.factor(delayTheta$Subject) -->
<!-- modelFit <- lmer(mgsLatency ~ age + Event_Number + (1|Subject), data = delayTheta[delayTheta$visitno < 2,]) -->
<!-- car::Anova(modelFit) -->
<!-- ``` -->

<!-- #### Effect of Average Theta Event Duration on Position Error  -->
<!-- ```{r echo=FALSE, message=FALSE, warning=FALSE} -->
<!-- delayTheta$Subject <- as.factor(delayTheta$Subject) -->
<!-- modelFit <- lmer(absPositionError ~ age + Event_Duration + (1|Subject), data = delayTheta[delayTheta$visitno < 2,]) -->
<!-- car::Anova(modelFit) -->
<!-- ``` -->
<!-- #### Effect of Average Theta Event Duration on MGS Latency -->
<!-- ```{r echo=FALSE, message=FALSE, warning=FALSE} -->
<!-- delayTheta$Subject <- as.factor(delayTheta$Subject) -->
<!-- modelFit <- lmer(mgsLatency ~ age + Event_Duration + (1|Subject), data = delayTheta[delayTheta$visitno < 2,]) -->
<!-- car::Anova(modelFit) -->
<!-- ``` -->

<!-- ### Beta Band Frequency -->
<!-- #### Effect of Beta Trial Power on Position Error  -->
<!-- ```{r echo=FALSE, message=FALSE, warning=FALSE} -->
<!-- delayBeta$Subject <- as.factor(delayBeta$Subject) -->
<!-- modelFit <- lmer(absPositionError ~ age + Trial_Power + (1|Subject), data = delayBeta[delayBeta$visitno < 2 & delayBeta$Trial_Power != '-Inf',]) -->
<!-- car::Anova(modelFit) -->
<!-- ``` -->

<!-- #### Effect of Beta Trial Power on MGS Latency -->
<!-- ```{r echo=FALSE, message=FALSE, warning=FALSE} -->
<!-- delayBeta$Subject <- as.factor(delayBeta$Subject) -->
<!-- modelFit <- lmer(mgsLatency ~ age + Trial_Power + (1|Subject), data = delayBeta[delayBeta$visitno < 2 & delayBeta$Trial_Power != '-Inf',]) -->
<!-- car::Anova(modelFit) -->
<!-- ``` -->

<!-- #### Effect of Average Beta Event Number on Position Error  -->
<!-- ```{r echo=FALSE, message=FALSE, warning=FALSE} -->
<!-- delayBeta$Subject <- as.factor(delayBeta$Subject) -->
<!-- modelFit <- lmer(absPositionError ~ age + Event_Number + (1|Subject), data = delayBeta[delayBeta$visitno < 2,]) -->
<!-- car::Anova(modelFit) -->
<!-- ``` -->
<!-- #### Effect of Average Beta Event Number on MGS Latency -->
<!-- ```{r echo=FALSE, message=FALSE, warning=FALSE} -->
<!-- delayBeta$Subject <- as.factor(delayBeta$Subject) -->
<!-- modelFit <- lmer(mgsLatency ~ age + Event_Number + (1|Subject), data = delayBeta[delayBeta$visitno < 2,]) -->
<!-- car::Anova(modelFit) -->
<!-- ``` -->

<!-- #### Effect of Average Beta Event Duration on Position Error  -->
<!-- ```{r echo=FALSE, message=FALSE, warning=FALSE} -->
<!-- delayBeta$Subject <- as.factor(delayBeta$Subject) -->
<!-- modelFit <- lmer(absPositionError ~ age + Event_Duration + (1|Subject), data = delayBeta[delayBeta$visitno < 2,]) -->
<!-- car::Anova(modelFit) -->
<!-- ``` -->
<!-- #### Effect of Average Beta Event Duration on MGS Latency -->
<!-- ```{r echo=FALSE, message=FALSE, warning=FALSE} -->
<!-- delayBeta$Subject <- as.factor(delayBeta$Subject) -->
<!-- modelFit <- lmer(mgsLatency ~ age + Event_Duration + (1|Subject), data = delayBeta[delayBeta$visitno < 2,]) -->
<!-- car::Anova(modelFit) -->
<!-- ``` -->






## Gamma Band Frequency Graphs

```{r  echo=FALSE, message=FALSE, warning=FALSE}
delayGamma <- setNames(aggregate(list(allDelayGamma$log10_Gamma_Trial_Power,allDelayGamma$log10_Gamma_Trial_Power_SD, allDelayGamma$Gamma_Event_Number, allDelayGamma$Gamma_Event_Number_SD, allDelayGamma$Gamma_Event_Duration, allDelayGamma$Gamma_Event_Duration_SD), by = list(allDelayGamma$Subject),mean), c("Subject", "Trial_Power","Trial_Power_Variability", "Event_Number","Event_Number_Variability", "Event_Duration", "Event_Duration_Variability"))

delayAlpha <- setNames(aggregate(list(allDelayAlpha$log10_Alpha_Trial_Power,allDelayAlpha$log10_Alpha_Trial_Power_SD, allDelayAlpha$Alpha_Event_Number, allDelayAlpha$Alpha_Event_Number_SD, allDelayAlpha$Alpha_Event_Duration, allDelayAlpha$Alpha_Event_Duration_SD), by = list(allDelayAlpha$Subject),mean), c("Subject", "Trial_Power","Trial_Power_Variability", "Event_Number","Event_Number_Variability", "Event_Duration", "Event_Duration_Variability"))

delayTheta <- setNames(aggregate(list(allDelayTheta$log10_Theta_Trial_Power,allDelayTheta$log10_Theta_Trial_Power_SD, allDelayTheta$Theta_Event_Number, allDelayTheta$Theta_Event_Number_SD, allDelayTheta$Theta_Event_Duration, allDelayTheta$Theta_Event_Duration_SD), by = list(allDelayTheta$Subject),mean), c("Subject", "Trial_Power","Trial_Power_Variability", "Event_Number","Event_Number_Variability", "Event_Duration", "Event_Duration_Variability"))

delayBeta <- setNames(aggregate(list(allDelayBeta$log10_Beta_Trial_Power,allDelayBeta$log10_Beta_Trial_Power_SD, allDelayBeta$Beta_Event_Number, allDelayBeta$Beta_Event_Number_SD, allDelayBeta$Beta_Event_Duration, allDelayBeta$Beta_Event_Duration_SD), by = list(allDelayBeta$Subject),mean), c("Subject", "Trial_Power","Trial_Power_Variability", "Event_Number","Event_Number_Variability", "Event_Duration", "Event_Duration_Variability"))

BehaviorSubject <- aggregate(PositionError ~ Subject, Behavior, mean)
BehaviorSubjectLat <- aggregate(mgsLatency ~ Subject, Behavior, mean)


delayGamma <- merge(delayGamma, BehaviorSubject, by = "Subject",  suffix = c("", ""))
delayGamma <- merge(delayGamma, BehaviorSubjectLat, by = "Subject", suffix = c("", ""))
delayGamma <- merge(delayGamma, agefile, by = "Subject", suffix = c("", ""))
delayGamma$absPositionError <- abs(delayGamma$PositionError)


delayAlpha <- merge(delayAlpha, BehaviorSubject, by = "Subject", suffix = c("", ""))
delayAlpha <- merge(delayAlpha, BehaviorSubjectLat, by = "Subject", suffix = c("", ""))
delayAlpha <- merge(delayAlpha, agefile, by = "Subject", suffix = c("", ""))
delayAlpha$absPositionError <- abs(delayAlpha$PositionError)

delayTheta <- merge(delayTheta, BehaviorSubject, by = "Subject", suffix = c("", ""))
delayTheta <- merge(delayTheta, BehaviorSubjectLat, by = "Subject", suffix = c("", ""))
delayTheta <- merge(delayTheta, agefile, by = "Subject", suffix = c("", ""))
delayTheta$absPositionError <- abs(delayTheta$PositionError)

delayBeta <- merge(delayBeta, BehaviorSubject, by = "Subject", suffix = c("", ""))
delayBeta <- merge(delayBeta, BehaviorSubjectLat, by = "Subject", suffix = c("", ""))
delayBeta <- merge(delayBeta, agefile, by = "Subject", suffix = c("", ""))
delayBeta$absPositionError <- abs(delayBeta$PositionError)

```
### Position Error

```{r echo=FALSE, message=FALSE, warning=FALSE}

avg_positionError <- aggregate(absPositionError ~ visitno, delayGamma[], mean)
avg_positionError_SD <- aggregate(absPositionError ~ visitno, delayGamma[], sd)
excludeHigh <- avg_positionError$absPositionError[1] + 3*avg_positionError_SD$absPositionError[1]
excludeLow <- avg_positionError$absPositionError[1] - 3*avg_positionError_SD$absPositionError[1]


ggplot(data = delayGamma[delayGamma$visitno < 2 & delayGamma$absPositionError < excludeHigh & delayGamma$absPositionError > excludeLow ,],  aes(x = absPositionError, y = Trial_Power )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Gamma Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Power")
lm.model <- lm(data=delayGamma[delayGamma$visitno < 2 & delayGamma$absPositionError < excludeHigh & delayGamma$absPositionError > excludeLow,], Trial_Power ~ absPositionError)
anova(lm.model)

ggplot(data = delayGamma[delayGamma$visitno < 2 & delayGamma$absPositionError < excludeHigh & delayGamma$absPositionError > excludeLow,],  aes(x = absPositionError, y = Trial_Power_Variability )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Gamma Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Power)")
lm.model <- lm(data=delayGamma[delayGamma$visitno < 2 & delayGamma$absPositionError < excludeHigh & delayGamma$absPositionError > excludeLow,], Trial_Power_Variability ~ absPositionError)
anova(lm.model)

ggplot(data = delayGamma[delayGamma$visitno < 2 & delayGamma$absPositionError < excludeHigh & delayGamma$absPositionError > excludeLow,],  aes(x = absPositionError, y = Event_Duration )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Gamma Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Duration")
lm.model <- lm(data=delayGamma[delayGamma$visitno < 2 & delayGamma$absPositionError < excludeHigh & delayGamma$absPositionError > excludeLow,], Event_Duration ~ absPositionError)
anova(lm.model)

ggplot(data = delayGamma[delayGamma$visitno < 2 & delayGamma$absPositionError < excludeHigh & delayGamma$absPositionError > excludeLow,],  aes(x = absPositionError, y = Event_Duration_Variability )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Gamma Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Duration)")
lm.model <- lm(data=delayGamma[delayGamma$visitno < 2 & delayGamma$absPositionError < excludeHigh & delayGamma$absPositionError > excludeLow,], Event_Duration_Variability ~ absPositionError)
anova(lm.model)

ggplot(data = delayGamma[delayGamma$visitno < 2 & delayGamma$absPositionError < excludeHigh & delayGamma$absPositionError > excludeLow,],  aes(x = absPositionError, y = Event_Number )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Gamma Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Number of Events")
lm.model <- lm(data=delayGamma[delayGamma$visitno < 2 & delayGamma$absPositionError < excludeHigh & delayGamma$absPositionError > excludeLow,], Event_Number ~ absPositionError)
anova(lm.model)

ggplot(data = delayGamma[delayGamma$visitno < 2 & delayGamma$absPositionError < excludeHigh & delayGamma$absPositionError > excludeLow,],  aes(x = absPositionError, y = Event_Number_Variability )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Gamma Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Number of Events)")
lm.model <- lm(data=delayGamma[delayGamma$visitno < 2 & delayGamma$absPositionError < excludeHigh & delayGamma$absPositionError > excludeLow,], Event_Number_Variability ~ absPositionError)
anova(lm.model)

```
### mgsLatency

```{r echo=FALSE, message=FALSE, warning=FALSE}

avg_mgsLatency<- aggregate(mgsLatency ~ visitno, delayGamma[], mean)
avg_mgsLatency_SD <- aggregate(mgsLatency ~ visitno, delayGamma[], sd)
excludeHigh <- avg_mgsLatency$mgsLatency[1] + 3*avg_mgsLatency_SD$mgsLatency[1]
excludeLow <- avg_mgsLatency$mgsLatency[1] - 3*avg_mgsLatency_SD$mgsLatency[1]


ggplot(data = delayGamma[delayGamma$visitno < 2 & delayGamma$mgsLatency < excludeHigh & delayGamma$mgsLatency > excludeLow ,],  aes(x = mgsLatency, y = Trial_Power )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Gamma Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("Power")
lm.model <- lm(data=delayGamma[delayGamma$visitno < 2 & delayGamma$mgsLatency < excludeHigh & delayGamma$mgsLatency > excludeLow,], Trial_Power ~ mgsLatency)
anova(lm.model)

ggplot(data = delayGamma[delayGamma$visitno < 2 & delayGamma$mgsLatency < excludeHigh & delayGamma$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Trial_Power_Variability )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Gamma Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("SD(Power)")
lm.model <- lm(data=delayGamma[delayGamma$visitno < 2 & delayGamma$mgsLatency < excludeHigh & delayGamma$mgsLatency > excludeLow,], Trial_Power_Variability ~ mgsLatency)
anova(lm.model)

ggplot(data = delayGamma[delayGamma$visitno < 2 & delayGamma$mgsLatency < excludeHigh & delayGamma$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Event_Duration )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Gamma Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("Duration")
lm.model <- lm(data=delayGamma[delayGamma$visitno < 2 & delayGamma$mgsLatency < excludeHigh & delayGamma$mgsLatency > excludeLow,], Event_Duration ~ mgsLatency)
anova(lm.model)

ggplot(data = delayGamma[delayGamma$visitno < 2 & delayGamma$mgsLatency < excludeHigh & delayGamma$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Event_Duration_Variability )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Gamma Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("SD(Duration)")
lm.model <- lm(data=delayGamma[delayGamma$visitno < 2 & delayGamma$mgsLatency < excludeHigh & delayGamma$mgsLatency > excludeLow,], Event_Duration_Variability ~ mgsLatency)
anova(lm.model)

ggplot(data = delayGamma[delayGamma$visitno < 2 & delayGamma$mgsLatency < excludeHigh & delayGamma$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Event_Number )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Gamma Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("Number of Events")
lm.model <- lm(data=delayGamma[delayGamma$visitno < 2 & delayGamma$mgsLatency < excludeHigh & delayGamma$mgsLatency > excludeLow,], Event_Number ~ mgsLatency)
anova(lm.model)

ggplot(data = delayGamma[delayGamma$visitno < 2 & delayGamma$mgsLatency < excludeHigh & delayGamma$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Event_Number_Variability )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Gamma Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("SD(Number of Events)")
lm.model <- lm(data=delayGamma[delayGamma$visitno < 2 & delayGamma$mgsLatency < excludeHigh & delayGamma$mgsLatency > excludeLow,], Event_Number_Variability ~ mgsLatency)
anova(lm.model)

```



## Alpha Band Frequency Graphs
### Position Error

```{r echo=FALSE, message=FALSE, warning=FALSE}

avg_positionError <- aggregate(absPositionError ~ visitno, delayAlpha[], mean)
avg_positionError_SD <- aggregate(absPositionError ~ visitno, delayAlpha[], sd)
excludeHigh <- avg_positionError$absPositionError[1] + 3*avg_positionError_SD$absPositionError[1]
excludeLow <- avg_positionError$absPositionError[1] - 3*avg_positionError_SD$absPositionError[1]


ggplot(data = delayAlpha[delayAlpha$visitno < 2 & delayAlpha$absPositionError < excludeHigh & delayAlpha$absPositionError > excludeLow ,],  aes(x = absPositionError, y = Trial_Power )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Alpha Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Power")
lm.model <- lm(data=delayAlpha[delayAlpha$visitno < 2 & delayAlpha$absPositionError < excludeHigh & delayAlpha$absPositionError > excludeLow,], Trial_Power ~ absPositionError)
anova(lm.model)

ggplot(data = delayAlpha[delayAlpha$visitno < 2 & delayAlpha$absPositionError < excludeHigh & delayAlpha$absPositionError > excludeLow,],  aes(x = absPositionError, y = Trial_Power_Variability )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Alpha Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Power)")
lm.model <- lm(data=delayAlpha[delayAlpha$visitno < 2 & delayAlpha$absPositionError < excludeHigh & delayAlpha$absPositionError > excludeLow,], Trial_Power_Variability ~ absPositionError)
anova(lm.model)

ggplot(data = delayAlpha[delayAlpha$visitno < 2 & delayAlpha$absPositionError < excludeHigh & delayAlpha$absPositionError > excludeLow,],  aes(x = absPositionError, y = Event_Duration )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Alpha Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Duration")
lm.model <- lm(data=delayAlpha[delayAlpha$visitno < 2 & delayAlpha$absPositionError < excludeHigh & delayAlpha$absPositionError > excludeLow,], Event_Duration ~ absPositionError)
anova(lm.model)

ggplot(data = delayAlpha[delayAlpha$visitno < 2 & delayAlpha$absPositionError < excludeHigh & delayAlpha$absPositionError > excludeLow,],  aes(x = absPositionError, y = Event_Duration_Variability )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Alpha Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Duration)")
lm.model <- lm(data=delayAlpha[delayAlpha$visitno < 2 & delayAlpha$absPositionError < excludeHigh & delayAlpha$absPositionError > excludeLow,], Event_Duration_Variability ~ absPositionError)
anova(lm.model)

ggplot(data = delayAlpha[delayAlpha$visitno < 2 & delayAlpha$absPositionError < excludeHigh & delayAlpha$absPositionError > excludeLow,],  aes(x = absPositionError, y = Event_Number )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Alpha Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Number of Events")
lm.model <- lm(data=delayAlpha[delayAlpha$visitno < 2 & delayAlpha$absPositionError < excludeHigh & delayAlpha$absPositionError > excludeLow,], Event_Number ~ absPositionError)
anova(lm.model)

ggplot(data = delayAlpha[delayAlpha$visitno < 2 & delayAlpha$absPositionError < excludeHigh & delayAlpha$absPositionError > excludeLow,],  aes(x = absPositionError, y = Event_Number_Variability )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Alpha Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Number of Events)")
lm.model <- lm(data=delayAlpha[delayAlpha$visitno < 2 & delayAlpha$absPositionError < excludeHigh & delayAlpha$absPositionError > excludeLow,], Event_Number_Variability ~ absPositionError)
anova(lm.model)

```
### mgsLatency

```{r echo=FALSE, message=FALSE, warning=FALSE}

avg_mgsLatency<- aggregate(mgsLatency ~ visitno, delayAlpha[], mean)
avg_mgsLatency_SD <- aggregate(mgsLatency ~ visitno, delayAlpha[], sd)
excludeHigh <- avg_mgsLatency$mgsLatency[1] + 3*avg_mgsLatency_SD$mgsLatency[1]
excludeLow <- avg_mgsLatency$mgsLatency[1] - 3*avg_mgsLatency_SD$mgsLatency[1]


ggplot(data = delayAlpha[delayAlpha$visitno < 2 & delayAlpha$mgsLatency < excludeHigh & delayAlpha$mgsLatency > excludeLow ,],  aes(x = mgsLatency, y = Trial_Power )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Alpha Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("Power")
lm.model <- lm(data=delayAlpha[delayAlpha$visitno < 2 & delayAlpha$mgsLatency < excludeHigh & delayAlpha$mgsLatency > excludeLow,], Trial_Power ~ mgsLatency)
anova(lm.model)

ggplot(data = delayAlpha[delayAlpha$visitno < 2 & delayAlpha$mgsLatency < excludeHigh & delayAlpha$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Trial_Power_Variability )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Alpha Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("SD(Power)")
lm.model <- lm(data=delayAlpha[delayAlpha$visitno < 2 & delayAlpha$mgsLatency < excludeHigh & delayAlpha$mgsLatency > excludeLow,], Trial_Power_Variability ~ mgsLatency)
anova(lm.model)

ggplot(data = delayAlpha[delayAlpha$visitno < 2 & delayAlpha$mgsLatency < excludeHigh & delayAlpha$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Event_Duration )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Alpha Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("Duration")
lm.model <- lm(data=delayAlpha[delayAlpha$visitno < 2 & delayAlpha$mgsLatency < excludeHigh & delayAlpha$mgsLatency > excludeLow,], Event_Duration ~ mgsLatency)
anova(lm.model)

ggplot(data = delayAlpha[delayAlpha$visitno < 2 & delayAlpha$mgsLatency < excludeHigh & delayAlpha$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Event_Duration_Variability )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Alpha Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("SD(Duration)")
lm.model <- lm(data=delayAlpha[delayAlpha$visitno < 2 & delayAlpha$mgsLatency < excludeHigh & delayAlpha$mgsLatency > excludeLow,], Event_Duration_Variability ~ mgsLatency)
anova(lm.model)

ggplot(data = delayAlpha[delayAlpha$visitno < 2 & delayAlpha$mgsLatency < excludeHigh & delayAlpha$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Event_Number )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Alpha Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("Number of Events")
lm.model <- lm(data=delayAlpha[delayAlpha$visitno < 2 & delayAlpha$mgsLatency < excludeHigh & delayAlpha$mgsLatency > excludeLow,], Event_Number ~ mgsLatency)
anova(lm.model)

ggplot(data = delayAlpha[delayAlpha$visitno < 2 & delayAlpha$mgsLatency < excludeHigh & delayAlpha$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Event_Number_Variability )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Alpha Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("SD(Number of Events)")
lm.model <- lm(data=delayAlpha[delayAlpha$visitno < 2 & delayAlpha$mgsLatency < excludeHigh & delayAlpha$mgsLatency > excludeLow,], Event_Number_Variability ~ mgsLatency)
anova(lm.model)

```



## Theta Band Frequency Graphs
### Position Error

```{r echo=FALSE, message=FALSE, warning=FALSE}

avg_positionError <- aggregate(absPositionError ~ visitno, delayTheta[], mean)
avg_positionError_SD <- aggregate(absPositionError ~ visitno, delayTheta[], sd)
excludeHigh <- avg_positionError$absPositionError[1] + 3*avg_positionError_SD$absPositionError[1]
excludeLow <- avg_positionError$absPositionError[1] - 3*avg_positionError_SD$absPositionError[1]


ggplot(data = delayTheta[delayTheta$visitno < 2 & delayTheta$absPositionError < excludeHigh & delayTheta$absPositionError > excludeLow ,],  aes(x = absPositionError, y = Trial_Power )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Theta Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Power")
lm.model <- lm(data=delayTheta[delayTheta$visitno < 2 & delayTheta$absPositionError < excludeHigh & delayTheta$absPositionError > excludeLow,], Trial_Power ~ absPositionError)
anova(lm.model)

ggplot(data = delayTheta[delayTheta$visitno < 2 & delayTheta$absPositionError < excludeHigh & delayTheta$absPositionError > excludeLow,],  aes(x = absPositionError, y = Trial_Power_Variability )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Theta Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Power)")
lm.model <- lm(data=delayTheta[delayTheta$visitno < 2 & delayTheta$absPositionError < excludeHigh & delayTheta$absPositionError > excludeLow,], Trial_Power_Variability ~ absPositionError)
anova(lm.model)

ggplot(data = delayTheta[delayTheta$visitno < 2 & delayTheta$absPositionError < excludeHigh & delayTheta$absPositionError > excludeLow,],  aes(x = absPositionError, y = Event_Duration )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Theta Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Duration")
lm.model <- lm(data=delayTheta[delayTheta$visitno < 2 & delayTheta$absPositionError < excludeHigh & delayTheta$absPositionError > excludeLow,], Event_Duration ~ absPositionError)
anova(lm.model)

ggplot(data = delayTheta[delayTheta$visitno < 2 & delayTheta$absPositionError < excludeHigh & delayTheta$absPositionError > excludeLow,],  aes(x = absPositionError, y = Event_Duration_Variability )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Theta Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Duration)")
lm.model <- lm(data=delayTheta[delayTheta$visitno < 2 & delayTheta$absPositionError < excludeHigh & delayTheta$absPositionError > excludeLow,], Event_Duration_Variability ~ absPositionError)
anova(lm.model)

ggplot(data = delayTheta[delayTheta$visitno < 2 & delayTheta$absPositionError < excludeHigh & delayTheta$absPositionError > excludeLow,],  aes(x = absPositionError, y = Event_Number )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Theta Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Number of Events")
lm.model <- lm(data=delayTheta[delayTheta$visitno < 2 & delayTheta$absPositionError < excludeHigh & delayTheta$absPositionError > excludeLow,], Event_Number ~ absPositionError)
anova(lm.model)

ggplot(data = delayTheta[delayTheta$visitno < 2 & delayTheta$absPositionError < excludeHigh & delayTheta$absPositionError > excludeLow,],  aes(x = absPositionError, y = Event_Number_Variability )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Theta Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Number of Events)")
lm.model <- lm(data=delayTheta[delayTheta$visitno < 2 & delayTheta$absPositionError < excludeHigh & delayTheta$absPositionError > excludeLow,], Event_Number_Variability ~ absPositionError)
anova(lm.model)

```
### mgsLatency

```{r echo=FALSE, message=FALSE, warning=FALSE}

avg_mgsLatency<- aggregate(mgsLatency ~ visitno, delayTheta[], mean)
avg_mgsLatency_SD <- aggregate(mgsLatency ~ visitno, delayTheta[], sd)
excludeHigh <- avg_mgsLatency$mgsLatency[1] + 3*avg_mgsLatency_SD$mgsLatency[1]
excludeLow <- avg_mgsLatency$mgsLatency[1] - 3*avg_mgsLatency_SD$mgsLatency[1]


ggplot(data = delayTheta[delayTheta$visitno < 2 & delayTheta$mgsLatency < excludeHigh & delayTheta$mgsLatency > excludeLow ,],  aes(x = mgsLatency, y = Trial_Power )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Theta Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("Power")
lm.model <- lm(data=delayTheta[delayTheta$visitno < 2 & delayTheta$mgsLatency < excludeHigh & delayTheta$mgsLatency > excludeLow,], Trial_Power ~ mgsLatency)
anova(lm.model)

ggplot(data = delayTheta[delayTheta$visitno < 2 & delayTheta$mgsLatency < excludeHigh & delayTheta$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Trial_Power_Variability )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Theta Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("SD(Power)")
lm.model <- lm(data=delayTheta[delayTheta$visitno < 2 & delayTheta$mgsLatency < excludeHigh & delayTheta$mgsLatency > excludeLow,], Trial_Power_Variability ~ mgsLatency)
anova(lm.model)

ggplot(data = delayTheta[delayTheta$visitno < 2 & delayTheta$mgsLatency < excludeHigh & delayTheta$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Event_Duration )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Theta Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("Duration")
lm.model <- lm(data=delayTheta[delayTheta$visitno < 2 & delayTheta$mgsLatency < excludeHigh & delayTheta$mgsLatency > excludeLow,], Event_Duration ~ mgsLatency)
anova(lm.model)

ggplot(data = delayTheta[delayTheta$visitno < 2 & delayTheta$mgsLatency < excludeHigh & delayTheta$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Event_Duration_Variability )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Theta Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("SD(Duration)")
lm.model <- lm(data=delayTheta[delayTheta$visitno < 2 & delayTheta$mgsLatency < excludeHigh & delayTheta$mgsLatency > excludeLow,], Event_Duration_Variability ~ mgsLatency)
anova(lm.model)

ggplot(data = delayTheta[delayTheta$visitno < 2 & delayTheta$mgsLatency < excludeHigh & delayTheta$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Event_Number )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Theta Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("Number of Events")
lm.model <- lm(data=delayTheta[delayTheta$visitno < 2 & delayTheta$mgsLatency < excludeHigh & delayTheta$mgsLatency > excludeLow,], Event_Number ~ mgsLatency)
anova(lm.model)

ggplot(data = delayTheta[delayTheta$visitno < 2 & delayTheta$mgsLatency < excludeHigh & delayTheta$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Event_Number_Variability )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Theta Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("SD(Number of Events)")
lm.model <- lm(data=delayTheta[delayTheta$visitno < 2 & delayTheta$mgsLatency < excludeHigh & delayTheta$mgsLatency > excludeLow,], Event_Number_Variability ~ mgsLatency)
anova(lm.model)

```


## Beta Band Frequency Graphs
### Position Error

```{r echo=FALSE, message=FALSE, warning=FALSE}

avg_positionError <- aggregate(absPositionError ~ visitno, delayBeta[], mean)
avg_positionError_SD <- aggregate(absPositionError ~ visitno, delayBeta[], sd)
excludeHigh <- avg_positionError$absPositionError[1] + 3*avg_positionError_SD$absPositionError[1]
excludeLow <- avg_positionError$absPositionError[1] - 3*avg_positionError_SD$absPositionError[1]


ggplot(data = delayBeta[delayBeta$visitno < 2 & delayBeta$absPositionError < excludeHigh & delayBeta$absPositionError > excludeLow ,],  aes(x = absPositionError, y = Trial_Power )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Beta Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Power")
lm.model <- lm(data=delayBeta[delayBeta$visitno < 2 & delayBeta$absPositionError < excludeHigh & delayBeta$absPositionError > excludeLow,], Trial_Power ~ absPositionError)
anova(lm.model)

ggplot(data = delayBeta[delayBeta$visitno < 2 & delayBeta$absPositionError < excludeHigh & delayBeta$absPositionError > excludeLow,],  aes(x = absPositionError, y = Trial_Power_Variability )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Beta Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Power)")
lm.model <- lm(data=delayBeta[delayBeta$visitno < 2 & delayBeta$absPositionError < excludeHigh & delayBeta$absPositionError > excludeLow,], Trial_Power_Variability ~ absPositionError)
anova(lm.model)

ggplot(data = delayBeta[delayBeta$visitno < 2 & delayBeta$absPositionError < excludeHigh & delayBeta$absPositionError > excludeLow,],  aes(x = absPositionError, y = Event_Duration )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Beta Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Duration")
lm.model <- lm(data=delayBeta[delayBeta$visitno < 2 & delayBeta$absPositionError < excludeHigh & delayBeta$absPositionError > excludeLow,], Event_Duration ~ absPositionError)
anova(lm.model)

ggplot(data = delayBeta[delayBeta$visitno < 2 & delayBeta$absPositionError < excludeHigh & delayBeta$absPositionError > excludeLow,],  aes(x = absPositionError, y = Event_Duration_Variability )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Beta Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Duration)")
lm.model <- lm(data=delayBeta[delayBeta$visitno < 2 & delayBeta$absPositionError < excludeHigh & delayBeta$absPositionError > excludeLow,], Event_Duration_Variability ~ absPositionError)
anova(lm.model)

ggplot(data = delayBeta[delayBeta$visitno < 2 & delayBeta$absPositionError < excludeHigh & delayBeta$absPositionError > excludeLow,],  aes(x = absPositionError, y = Event_Number )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Beta Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Number of Events")
lm.model <- lm(data=delayBeta[delayBeta$visitno < 2 & delayBeta$absPositionError < excludeHigh & delayBeta$absPositionError > excludeLow,], Event_Number ~ absPositionError)
anova(lm.model)

ggplot(data = delayBeta[delayBeta$visitno < 2 & delayBeta$absPositionError < excludeHigh & delayBeta$absPositionError > excludeLow,],  aes(x = absPositionError, y = Event_Number_Variability )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Beta Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Number of Events)")
lm.model <- lm(data=delayBeta[delayBeta$visitno < 2 & delayBeta$absPositionError < excludeHigh & delayBeta$absPositionError > excludeLow,], Event_Number_Variability ~ absPositionError)
anova(lm.model)

```
### mgsLatency

```{r echo=FALSE, message=FALSE, warning=FALSE}

avg_mgsLatency<- aggregate(mgsLatency ~ visitno, delayBeta[], mean)
avg_mgsLatency_SD <- aggregate(mgsLatency ~ visitno, delayBeta[], sd)
excludeHigh <- avg_mgsLatency$mgsLatency[1] + 3*avg_mgsLatency_SD$mgsLatency[1]
excludeLow <- avg_mgsLatency$mgsLatency[1] - 3*avg_mgsLatency_SD$mgsLatency[1]


ggplot(data = delayBeta[delayBeta$visitno < 2 & delayBeta$mgsLatency < excludeHigh & delayBeta$mgsLatency > excludeLow ,],  aes(x = mgsLatency, y = Trial_Power )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Beta Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("Power")
lm.model <- lm(data=delayBeta[delayBeta$visitno < 2 & delayBeta$mgsLatency < excludeHigh & delayBeta$mgsLatency > excludeLow,], Trial_Power ~ mgsLatency)
anova(lm.model)

ggplot(data = delayBeta[delayBeta$visitno < 2 & delayBeta$mgsLatency < excludeHigh & delayBeta$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Trial_Power_Variability )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Beta Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("SD(Power)")
lm.model <- lm(data=delayBeta[delayBeta$visitno < 2 & delayBeta$mgsLatency < excludeHigh & delayBeta$mgsLatency > excludeLow,], Trial_Power_Variability ~ mgsLatency)
anova(lm.model)

ggplot(data = delayBeta[delayBeta$visitno < 2 & delayBeta$mgsLatency < excludeHigh & delayBeta$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Event_Duration )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Beta Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("Duration")
lm.model <- lm(data=delayBeta[delayBeta$visitno < 2 & delayBeta$mgsLatency < excludeHigh & delayBeta$mgsLatency > excludeLow,], Event_Duration ~ mgsLatency)
anova(lm.model)

ggplot(data = delayBeta[delayBeta$visitno < 2 & delayBeta$mgsLatency < excludeHigh & delayBeta$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Event_Duration_Variability )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Beta Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("SD(Duration)")
lm.model <- lm(data=delayBeta[delayBeta$visitno < 2 & delayBeta$mgsLatency < excludeHigh & delayBeta$mgsLatency > excludeLow,], Event_Duration_Variability ~ mgsLatency)
anova(lm.model)

ggplot(data = delayBeta[delayBeta$visitno < 2 & delayBeta$mgsLatency < excludeHigh & delayBeta$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Event_Number )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Beta Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("Number of Events")
lm.model <- lm(data=delayBeta[delayBeta$visitno < 2 & delayBeta$mgsLatency < excludeHigh & delayBeta$mgsLatency > excludeLow,], Event_Number ~ mgsLatency)
anova(lm.model)

ggplot(data = delayBeta[delayBeta$visitno < 2 & delayBeta$mgsLatency < excludeHigh & delayBeta$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Event_Number_Variability )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Beta Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("SD(Number of Events)")
lm.model <- lm(data=delayBeta[delayBeta$visitno < 2 & delayBeta$mgsLatency < excludeHigh & delayBeta$mgsLatency > excludeLow,], Event_Number_Variability ~ mgsLatency)
anova(lm.model)

```
















# Fixation Period Frequency Bands Across Age 
```{r, echo= FALSE, message = FALSE, warning = FALSE}

GammaT  <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Gamma/Fix/Gamma_all_dataFix.csv')
AlphaT  <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Alpha/Fix/Alpha_all_dataFix.csv')
BetaT  <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Beta/Fix/Beta_all_dataFix.csv')
ThetaT  <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Theta/Fix/Theta_all_dataFix.csv')
agefile <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/agefile.csv')
agefile$Subject <- agefile$idvalues 

GrandTable <- merge(GammaT, AlphaT, by = c('Subject', 'Trial'), all.x = TRUE, all.y = TRUE)
GrandTable <- merge(GrandTable, BetaT, by = c('Subject', 'Trial'), all.x = TRUE, all.y = TRUE)
GrandTable <- merge(GrandTable, ThetaT, by = c('Subject', 'Trial'), all.x = TRUE, all.y = TRUE)
GrandTable <- merge(GrandTable, agefile, by = 'Subject', all.x = TRUE, all.y = TRUE)

GrandTable$log10_Gamma_Trial_Power <- log10(GrandTable$Gamma_Trial_Power)
GrandTable$log10_Theta_Trial_Power <- log10(GrandTable$Theta_Trial_Power)
GrandTable$log10_Beta_Trial_Power <- log10(GrandTable$Beta_Trial_Power)
GrandTable$log10_Alpha_Trial_Power <- log10(GrandTable$Alpha_Trial_Power)


Behavior <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Behavior.csv')

Behavior$Subject <- paste0(Behavior$LunaID, '_', Behavior$ScanDate)
Behavior <- merge(Behavior, agefile, by = 'Subject', all.x = TRUE, all.y = TRUE)

Everything <- merge(GrandTable, Behavior, by = c('Subject', 'Trial'), all.x = TRUE, all.y = TRUE)
Everything$absPositionError <- abs(Everything$PositionError)

## average across trials 
#gamma
Avg_log10_gamma_power <- aggregate(log10_Gamma_Trial_Power ~ Subject, Everything[Everything$log10_Gamma_Trial_Power != '-Inf',], mean)
TrialVar_log10_gamma_power <- aggregate(log10_Gamma_Trial_Power ~ Subject, Everything[Everything$log10_Gamma_Trial_Power != '-Inf',], sd)
PerSubjectGamma <- merge(Avg_log10_gamma_power, TrialVar_log10_gamma_power, by = 'Subject', suffix = c("_mean", "_SD") )
PerSubjectGamma <- merge(PerSubjectGamma, agefile, by= 'Subject')

Avg_gamma_duration <- aggregate(Gamma_Event_Duration ~ Subject, Everything, mean)
TrialVar_gamma_duration <- aggregate(Gamma_Event_Duration ~ Subject, Everything, sd)
PerSubjectGamma <- merge(PerSubjectGamma, Avg_gamma_duration, by= 'Subject', suffix = c("", "_mean"))
PerSubjectGamma <- merge(PerSubjectGamma, TrialVar_gamma_duration, by= 'Subject', suffix = c("", "_SD"))

Avg_gamma_event_number <- aggregate(Gamma_Event_Number ~ Subject, Everything, mean)
TrialVar_gamma_event_number <- aggregate(Gamma_Event_Number ~ Subject, Everything, sd)
PerSubjectGamma <- merge(PerSubjectGamma, Avg_gamma_event_number, by= 'Subject', suffix = c("", "_mean"))
PerSubjectGamma <- merge(PerSubjectGamma, TrialVar_gamma_event_number, by= 'Subject', suffix = c("", "_SD"))
PerSubjectGamma$ageInverse = 1/PerSubjectGamma$age

avg_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, mean)
SD_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, sd)

PerSubjectGamma <- merge(PerSubjectGamma, avg_abs_PositionError, by= 'Subject',suffix = c("", "_mean"))
PerSubjectGamma <- merge(PerSubjectGamma, SD_abs_PositionError, by= 'Subject', suffix = c("", "_SD"))

avg_Latency <- aggregate(mgsLatency ~ Subject, Everything, mean)
SD_Latency <- aggregate(mgsLatency ~ Subject, Everything, sd)

PerSubjectGamma <- merge(PerSubjectGamma, avg_Latency, by = 'Subject',suffix = c("", "_mean"))
PerSubjectGamma <- merge(PerSubjectGamma, SD_Latency, by = 'Subject', suffix = c("", "_SD"))


#alpha
Avg_log10_alpha_power <- aggregate(log10_Alpha_Trial_Power ~ Subject, Everything[Everything$log10_Alpha_Trial_Power != '-Inf',], mean)
TrialVar_log10_alpha_power <- aggregate(log10_Alpha_Trial_Power ~ Subject, Everything[Everything$log10_Alpha_Trial_Power != '-Inf',], sd)
PerSubjectAlpha <- merge(Avg_log10_alpha_power, TrialVar_log10_alpha_power, by = 'Subject', suffix = c("_mean", "_SD") )
PerSubjectAlpha <- merge(PerSubjectAlpha, agefile, by= 'Subject')

Avg_alpha_duration <- aggregate(Alpha_Event_Duration ~ Subject, Everything, mean)
TrialVar_alpha_duration <- aggregate(Alpha_Event_Duration ~ Subject, Everything, sd)
PerSubjectAlpha <- merge(PerSubjectAlpha, Avg_alpha_duration, by= 'Subject', suffix = c("", "_mean"))
PerSubjectAlpha <- merge(PerSubjectAlpha, TrialVar_alpha_duration, by= 'Subject', suffix = c("", "_SD"))

Avg_alpha_event_number <- aggregate(Alpha_Event_Number ~ Subject, Everything, mean)
TrialVar_alpha_event_number <- aggregate(Alpha_Event_Number ~ Subject, Everything, sd)
PerSubjectAlpha <- merge(PerSubjectAlpha, Avg_alpha_event_number, by= 'Subject', suffix = c("", "_mean"))
PerSubjectAlpha <- merge(PerSubjectAlpha, TrialVar_alpha_event_number, by= 'Subject', suffix = c("", "_SD"))
PerSubjectAlpha$ageInverse = 1/PerSubjectAlpha$age

avg_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, mean)
SD_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, sd)

PerSubjectAlpha <- merge(PerSubjectAlpha, avg_abs_PositionError, by= 'Subject',suffix = c("", "_mean"))
PerSubjectAlpha <- merge(PerSubjectAlpha, SD_abs_PositionError, by= 'Subject', suffix = c("", "_SD"))

avg_Latency <- aggregate(mgsLatency ~ Subject, Everything, mean)
SD_Latency <- aggregate(mgsLatency ~ Subject, Everything, sd)

PerSubjectAlpha <- merge(PerSubjectAlpha, avg_Latency, by = 'Subject',suffix = c("", "_mean"))
PerSubjectAlpha <- merge(PerSubjectAlpha, SD_Latency, by = 'Subject', suffix = c("", "_SD"))

#theta
Avg_log10_theta_power <- aggregate(log10_Theta_Trial_Power ~ Subject, Everything[Everything$log10_Theta_Trial_Power != '-Inf',], mean)
TrialVar_log10_theta_power <- aggregate(log10_Theta_Trial_Power ~ Subject, Everything[Everything$log10_Theta_Trial_Power != '-Inf',], sd)
PerSubjectTheta <- merge(Avg_log10_theta_power, TrialVar_log10_theta_power, by = 'Subject', suffix = c("_mean", "_SD") )
PerSubjectTheta <- merge(PerSubjectTheta, agefile, by= 'Subject')

Avg_theta_duration <- aggregate(Theta_Event_Duration ~ Subject, Everything, mean)
TrialVar_theta_duration <- aggregate(Theta_Event_Duration ~ Subject, Everything, sd)
PerSubjectTheta <- merge(PerSubjectTheta, Avg_theta_duration, by= 'Subject', suffix = c("", "_mean"))
PerSubjectTheta <- merge(PerSubjectTheta, TrialVar_theta_duration, by= 'Subject', suffix = c("", "_SD"))

Avg_theta_event_number <- aggregate(Theta_Event_Number ~ Subject, Everything, mean)
TrialVar_theta_event_number <- aggregate(Theta_Event_Number ~ Subject, Everything, sd)
PerSubjectTheta <- merge(PerSubjectTheta, Avg_theta_event_number, by= 'Subject', suffix = c("", "_mean"))
PerSubjectTheta <- merge(PerSubjectTheta, TrialVar_theta_event_number, by= 'Subject', suffix = c("", "_SD"))
PerSubjectTheta$ageInverse = 1/PerSubjectTheta$age

avg_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, mean)
SD_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, sd)

PerSubjectTheta <- merge(PerSubjectTheta, avg_abs_PositionError, by= 'Subject',suffix = c("", "_mean"))
PerSubjectTheta <- merge(PerSubjectTheta, SD_abs_PositionError, by= 'Subject', suffix = c("", "_SD"))

avg_Latency <- aggregate(mgsLatency ~ Subject, Everything, mean)
SD_Latency <- aggregate(mgsLatency ~ Subject, Everything, sd)

PerSubjectTheta <- merge(PerSubjectTheta, avg_Latency, by = 'Subject',suffix = c("", "_mean"))
PerSubjectTheta <- merge(PerSubjectTheta, SD_Latency, by = 'Subject', suffix = c("", "_SD"))

#beta
Avg_log10_beta_power <- aggregate(log10_Beta_Trial_Power ~ Subject, Everything[Everything$log10_Beta_Trial_Power != '-Inf',], mean)
TrialVar_log10_beta_power <- aggregate(log10_Beta_Trial_Power ~ Subject, Everything[Everything$log10_Beta_Trial_Power != '-Inf',], sd)
PerSubjectBeta <- merge(Avg_log10_beta_power, TrialVar_log10_beta_power, by = 'Subject', suffix = c("_mean", "_SD") )
PerSubjectBeta <- merge(PerSubjectBeta, agefile, by= 'Subject')

Avg_beta_duration <- aggregate(Beta_Event_Duration ~ Subject, Everything, mean)
TrialVar_beta_duration <- aggregate(Beta_Event_Duration ~ Subject, Everything, sd)
PerSubjectBeta <- merge(PerSubjectBeta, Avg_beta_duration, by= 'Subject', suffix = c("", "_mean"))
PerSubjectBeta <- merge(PerSubjectBeta, TrialVar_beta_duration, by= 'Subject', suffix = c("", "_SD"))

Avg_beta_event_number <- aggregate(Beta_Event_Number ~ Subject, Everything, mean)
TrialVar_beta_event_number <- aggregate(Beta_Event_Number ~ Subject, Everything, sd)
PerSubjectBeta <- merge(PerSubjectBeta, Avg_beta_event_number, by= 'Subject', suffix = c("", "_mean"))
PerSubjectBeta <- merge(PerSubjectBeta, TrialVar_beta_event_number, by= 'Subject', suffix = c("", "_SD"))
PerSubjectBeta$ageInverse = 1/PerSubjectBeta$age

avg_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, mean)
SD_abs_PositionError <- aggregate(absPositionError ~ Subject, Everything, sd)

PerSubjectBeta <- merge(PerSubjectBeta, avg_abs_PositionError, by= 'Subject',suffix = c("", "_mean"))
PerSubjectBeta <- merge(PerSubjectBeta, SD_abs_PositionError, by= 'Subject', suffix = c("", "_SD"))

avg_Latency <- aggregate(mgsLatency ~ Subject, Everything, mean)
SD_Latency <- aggregate(mgsLatency ~ Subject, Everything, sd)

PerSubjectBeta <- merge(PerSubjectBeta, avg_Latency, by = 'Subject',suffix = c("", "_mean"))
PerSubjectBeta <- merge(PerSubjectBeta, SD_Latency, by = 'Subject', suffix = c("", "_SD"))

```


## Gamma Frequency Band

```{r, echo= FALSE, message = FALSE, warning = FALSE, fig.margin = TRUE}
#gamma

#average 
avgGamma <- aggregate(log10_Gamma_Trial_Power_mean ~ visitno , PerSubjectGamma, mean)
sdGamma <- aggregate(log10_Gamma_Trial_Power_mean ~ visitno , PerSubjectGamma, sd)
cutoff <- 3* sdGamma[1,2] + avgGamma[1,2]

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$log10_Gamma_Trial_Power_mean < cutoff,],  aes(x = age, y = log10_Gamma_Trial_Power_mean )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Gamma Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power")

lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$log10_Gamma_Trial_Power_mean < cutoff,], log10_Gamma_Trial_Power_mean ~ ageInverse)
anova(lm.model)

#trial by trial variability 
avgGamma <- aggregate(log10_Gamma_Trial_Power_SD ~ visitno , PerSubjectGamma, mean)
sdGamma <- aggregate(log10_Gamma_Trial_Power_SD ~ visitno , PerSubjectGamma, sd)
cutoff <- 3* sdGamma[1,2] + avgGamma[1,2]


ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$log10_Gamma_Trial_Power_SD < cutoff,],  aes(x = age, y = log10_Gamma_Trial_Power_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Gamma Power vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Power)")

lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$log10_Gamma_Trial_Power_SD < cutoff,], log10_Gamma_Trial_Power_SD ~ ageInverse)
anova(lm.model)


# Event Duration
avgGamma <- aggregate(Gamma_Event_Duration ~ visitno , PerSubjectGamma, mean)
sdGamma <- aggregate(Gamma_Event_Duration ~ visitno , PerSubjectGamma, sd)
cutoff <- 3* sdGamma[1,2] + avgGamma[1,2]

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$Gamma_Event_Duration < cutoff,],  aes(x = age, y = Gamma_Event_Duration)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Gamma Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("Duration")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2  & PerSubjectGamma$Gamma_Event_Duration < cutoff,], Gamma_Event_Duration ~ ageInverse)
anova(lm.model)


# Event Duration trial by trial variability 
avgGamma <- aggregate(Gamma_Event_Duration_SD ~ visitno , PerSubjectGamma, mean)
sdGamma <- aggregate(Gamma_Event_Duration_SD ~ visitno , PerSubjectGamma, sd)
cutoff <- 3* sdGamma[1,2] + avgGamma[1,2]

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$Gamma_Event_Duration_SD < cutoff,],  aes(x = age, y = Gamma_Event_Duration_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Varibaility of Gamma Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$Gamma_Event_Duration_SD < cutoff,], Gamma_Event_Duration_SD ~ ageInverse)
anova(lm.model)


#Event Number average
avgGamma <- aggregate(Gamma_Event_Number ~ visitno , PerSubjectGamma, mean)
sdGamma <- aggregate(Gamma_Event_Number ~ visitno , PerSubjectGamma, sd)
cutoff <- 3* sdGamma[1,2] + avgGamma[1,2]

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$Gamma_Event_Number < cutoff,],  aes(x = age, y = Gamma_Event_Number )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Average Gamma Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$Gamma_Event_Number < cutoff,], Gamma_Event_Number ~ ageInverse)
anova(lm.model)


#Event number trial variability 
avgGamma <- aggregate(Gamma_Event_Number_SD ~ visitno , PerSubjectGamma, mean)
sdGamma <- aggregate(Gamma_Event_Number_SD ~ visitno , PerSubjectGamma, sd)
cutoff <- 3* sdGamma[1,2] + avgGamma[1,2]

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$Gamma_Event_Number_SD < cutoff,],  aes(x = age, y = Gamma_Event_Number_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Varibaility of Gamma Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Number of Events)") 
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$Gamma_Event_Number_SD < cutoff,], Gamma_Event_Number_SD ~ ageInverse)
anova(lm.model)

```


## Alpha Frequency Band

```{r, echo= FALSE, message = FALSE, warning = FALSE}
#alpha
#power
avgAlpha <- aggregate(log10_Alpha_Trial_Power_mean ~ visitno , PerSubjectAlpha, mean)
sdAlpha <- aggregate(log10_Alpha_Trial_Power_mean ~ visitno , PerSubjectAlpha, sd)
cutoff <- 3* sdAlpha[1,2] + avgAlpha[1,2]


ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$log10_Alpha_Trial_Power_mean < cutoff,],  aes(x = age, y = log10_Alpha_Trial_Power_mean )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Alpha Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$log10_Alpha_Trial_Power_mean < cutoff,], log10_Alpha_Trial_Power_mean ~ ageInverse)
anova(lm.model)

#power variability 
avgAlpha <- aggregate(log10_Alpha_Trial_Power_SD ~ visitno , PerSubjectAlpha, mean)
sdAlpha <- aggregate(log10_Alpha_Trial_Power_SD ~ visitno , PerSubjectAlpha, sd)
cutoff <- 3* sdAlpha[1,2] + avgAlpha[1,2]

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$log10_Alpha_Trial_Power_SD < cutoff,],  aes(x = age, y = log10_Alpha_Trial_Power_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Alpha Power vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$log10_Alpha_Trial_Power_SD < cutoff,], log10_Alpha_Trial_Power_SD ~ ageInverse)
anova(lm.model)

#event duration 
avgAlpha <- aggregate(Alpha_Event_Duration ~ visitno , PerSubjectAlpha, mean)
sdAlpha <- aggregate(Alpha_Event_Duration ~ visitno , PerSubjectAlpha, sd)
cutoff <- 3* sdAlpha[1,2] + avgAlpha[1,2]


ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2  & PerSubjectAlpha$Alpha_Event_Duration < cutoff,],  aes(x = age, y = Alpha_Event_Duration)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Alpha Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Duration")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2  & PerSubjectAlpha$Alpha_Event_Duration < cutoff,], Alpha_Event_Duration ~ ageInverse)
anova(lm.model)

#event durtion variability
avgAlpha <- aggregate(Alpha_Event_Duration_SD ~ visitno , PerSubjectAlpha, mean)
sdAlpha <- aggregate(Alpha_Event_Duration_SD ~ visitno , PerSubjectAlpha, sd)
cutoff <- 3* sdAlpha[1,2] + avgAlpha[1,2]

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$Alpha_Event_Duration_SD < cutoff,],  aes(x = age, y = Alpha_Event_Duration_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Alpha Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$Alpha_Event_Duration_SD < cutoff,], Alpha_Event_Duration_SD ~ ageInverse)
anova(lm.model)

#event number
avgAlpha <- aggregate(Alpha_Event_Number ~ visitno , PerSubjectAlpha, mean)
sdAlpha <- aggregate(Alpha_Event_Number ~ visitno , PerSubjectAlpha, sd)
cutoff <- 3* sdAlpha[1,2] + avgAlpha[1,2]

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$Alpha_Event_Number < cutoff,],  aes(x = age, y = Alpha_Event_Number )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Alpha Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$Alpha_Event_Number < cutoff,], Alpha_Event_Number ~ ageInverse)
anova(lm.model)

#Event number variability 
avgAlpha <- aggregate(Alpha_Event_Number_SD ~ visitno , PerSubjectAlpha, mean)
sdAlpha <- aggregate(Alpha_Event_Number_SD ~ visitno , PerSubjectAlpha, sd)
cutoff <- 3* sdAlpha[1,2] + avgAlpha[1,2]

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$Alpha_Event_Number_SD < cutoff,],  aes(x = age, y = Alpha_Event_Number_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Variability of Alpha Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$Alpha_Event_Number_SD < cutoff,], Alpha_Event_Number_SD ~ ageInverse)
anova(lm.model)

```

## Theta Frequency Band

```{r echo=FALSE, message=FALSE, warning=FALSE}
#Theta
#power
avgTheta <- aggregate(log10_Theta_Trial_Power_mean ~ visitno , PerSubjectTheta, mean)
sdTheta <- aggregate(log10_Theta_Trial_Power_mean ~ visitno , PerSubjectTheta, sd)
cutoff <- 3* sdTheta[1,2] + avgTheta[1,2]


ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$log10_Theta_Trial_Power_mean < cutoff,],  aes(x = age, y = log10_Theta_Trial_Power_mean )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Theta Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$log10_Theta_Trial_Power_mean < cutoff,], log10_Theta_Trial_Power_mean ~ ageInverse)
anova(lm.model)

#power variability 
avgTheta <- aggregate(log10_Theta_Trial_Power_SD ~ visitno , PerSubjectTheta, mean)
sdTheta <- aggregate(log10_Theta_Trial_Power_SD ~ visitno , PerSubjectTheta, sd)
cutoff <- 3* sdTheta[1,2] + avgTheta[1,2]

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$log10_Theta_Trial_Power_SD < cutoff,],  aes(x = age, y = log10_Theta_Trial_Power_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Theta Power vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$log10_Theta_Trial_Power_SD < cutoff,], log10_Theta_Trial_Power_SD ~ ageInverse)
anova(lm.model)

#event duration 
avgTheta <- aggregate(Theta_Event_Duration ~ visitno , PerSubjectTheta, mean)
sdTheta <- aggregate(Theta_Event_Duration ~ visitno , PerSubjectTheta, sd)
cutoff <- 3* sdTheta[1,2] + avgTheta[1,2]


ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2  & PerSubjectTheta$Theta_Event_Duration < cutoff,],  aes(x = age, y = Theta_Event_Duration)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Theta Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Duration")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2  & PerSubjectTheta$Theta_Event_Duration < cutoff,], Theta_Event_Duration ~ ageInverse)
anova(lm.model)

#event durtion variability
avgTheta <- aggregate(Theta_Event_Duration_SD ~ visitno , PerSubjectTheta, mean)
sdTheta <- aggregate(Theta_Event_Duration_SD ~ visitno , PerSubjectTheta, sd)
cutoff <- 3* sdTheta[1,2] + avgTheta[1,2]

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$Theta_Event_Duration_SD < cutoff,],  aes(x = age, y = Theta_Event_Duration_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Theta Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$Theta_Event_Duration_SD < cutoff,], Theta_Event_Duration_SD ~ ageInverse)
anova(lm.model)

#event number
avgTheta <- aggregate(Theta_Event_Number ~ visitno , PerSubjectTheta, mean)
sdTheta <- aggregate(Theta_Event_Number ~ visitno , PerSubjectTheta, sd)
cutoff <- 3* sdTheta[1,2] + avgTheta[1,2]

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$Theta_Event_Number < cutoff,],  aes(x = age, y = Theta_Event_Number )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Theta Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$Theta_Event_Number < cutoff,], Theta_Event_Number ~ ageInverse)
anova(lm.model)

#Event number variability 
avgTheta <- aggregate(Theta_Event_Number_SD ~ visitno , PerSubjectTheta, mean)
sdTheta <- aggregate(Theta_Event_Number_SD ~ visitno , PerSubjectTheta, sd)
cutoff <- 3* sdTheta[1,2] + avgTheta[1,2]

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$Theta_Event_Number_SD < cutoff,],  aes(x = age, y = Theta_Event_Number_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Variability of Theta Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$Theta_Event_Number_SD < cutoff,], Theta_Event_Number_SD ~ ageInverse)
anova(lm.model)

```

## Beta Frequency Band

```{r echo=FALSE, message=FALSE, warning=FALSE}
#Beta
#power
avgBeta <- aggregate(log10_Beta_Trial_Power_mean ~ visitno , PerSubjectBeta, mean)
sdBeta <- aggregate(log10_Beta_Trial_Power_mean ~ visitno , PerSubjectBeta, sd)
cutoff <- 3* sdBeta[1,2] + avgBeta[1,2]


ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$log10_Beta_Trial_Power_mean < cutoff,],  aes(x = age, y = log10_Beta_Trial_Power_mean )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Beta Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$log10_Beta_Trial_Power_mean < cutoff,], log10_Beta_Trial_Power_mean ~ ageInverse)
anova(lm.model)

#power variability 
avgBeta <- aggregate(log10_Beta_Trial_Power_SD ~ visitno , PerSubjectBeta, mean)
sdBeta <- aggregate(log10_Beta_Trial_Power_SD ~ visitno , PerSubjectBeta, sd)
cutoff <- 3* sdBeta[1,2] + avgBeta[1,2]

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$log10_Beta_Trial_Power_SD < cutoff,],  aes(x = age, y = log10_Beta_Trial_Power_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Beta Power vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$log10_Beta_Trial_Power_SD < cutoff,], log10_Beta_Trial_Power_SD ~ ageInverse)
anova(lm.model)

#event duration 
avgBeta <- aggregate(Beta_Event_Duration ~ visitno , PerSubjectBeta, mean)
sdBeta <- aggregate(Beta_Event_Duration ~ visitno , PerSubjectBeta, sd)
cutoff <- 3* sdBeta[1,2] + avgBeta[1,2]


ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2  & PerSubjectBeta$Beta_Event_Duration < cutoff,],  aes(x = age, y = Beta_Event_Duration)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Beta Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Duration")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2  & PerSubjectBeta$Beta_Event_Duration < cutoff,], Beta_Event_Duration ~ ageInverse)
anova(lm.model)

#event durtion variability
avgBeta <- aggregate(Beta_Event_Duration_SD ~ visitno , PerSubjectBeta, mean)
sdBeta <- aggregate(Beta_Event_Duration_SD ~ visitno , PerSubjectBeta, sd)
cutoff <- 3* sdBeta[1,2] + avgBeta[1,2]

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$Beta_Event_Duration_SD < cutoff,],  aes(x = age, y = Beta_Event_Duration_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Between Trial Variability of Beta Event Duration vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$Beta_Event_Duration_SD < cutoff,], Beta_Event_Duration_SD ~ ageInverse)
anova(lm.model)

#event number
avgBeta <- aggregate(Beta_Event_Number ~ visitno , PerSubjectBeta, mean)
sdBeta <- aggregate(Beta_Event_Number ~ visitno , PerSubjectBeta, sd)
cutoff <- 3* sdBeta[1,2] + avgBeta[1,2]

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$Beta_Event_Number < cutoff,],  aes(x = age, y = Beta_Event_Number )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Trial Beta Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$Beta_Event_Number < cutoff,], Beta_Event_Number ~ ageInverse)
anova(lm.model)

#Event number variability 
avgBeta <- aggregate(Beta_Event_Number_SD ~ visitno , PerSubjectBeta, mean)
sdBeta <- aggregate(Beta_Event_Number_SD ~ visitno , PerSubjectBeta, sd)
cutoff <- 3* sdBeta[1,2] + avgBeta[1,2]

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$Beta_Event_Number_SD < cutoff,],  aes(x = age, y = Beta_Event_Number_SD )) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)')+ ggtitle("Between Trial Variability of Beta Event Number vs Age") + theme(plot.title = element_text(hjust = 0.5))+ xlab("Age") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$Beta_Event_Number_SD < cutoff,], Beta_Event_Number_SD ~ ageInverse)
anova(lm.model)
```






# Fixation Period Frequency Bands and Task Performance 

## Fit Linear Mixed Effects Model
### Gamma Band Frequency
#### Effect of Gamma Trial Power on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + log10_Gamma_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Gamma_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Gamma Trial Power on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + log10_Gamma_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Gamma_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Average Gamma Event Number on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Gamma_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```
#### Effect of Average Gamma Event Number on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Gamma_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Gamma Event Duration on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Gamma_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```
#### Effect of Average Gamma Event Duration on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Gamma_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

### Alpha Band Frequency
#### Effect of Alpha Trial Power on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + log10_Alpha_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Alpha_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Alpha Trial Power on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + log10_Alpha_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Alpha_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Average Alpha Event Number on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Alpha_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Alpha Event Number on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Alpha_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Alpha Event Duration on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Alpha_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Alpha Event Duration on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Alpha_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```


### Theta Band Frequency
#### Effect of Theta Trial Power on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + log10_Theta_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Theta_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Theta Trial Power on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + log10_Theta_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Theta_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Average Theta Event Number on Position Error 
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Theta_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Theta Event Number on MGS Latency
```{r echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Theta_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Theta Event Duration on Position Error 
```{r, echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Theta_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Theta Event Duration on MGS Latency
```{r, echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Theta_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```


### Beta Band Frequency
#### Effect of Beta Trial Power on Position Error 
```{r, echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + log10_Beta_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Beta_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Beta Trial Power on MGS Latency
```{r, echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + log10_Beta_Trial_Power + (1|Subject), data = Everything[Everything$visitno.x < 2 & Everything$log10_Beta_Trial_Power != '-Inf',])
car::Anova(modelFit)
```

#### Effect of Average Beta Event Number on Position Error 
```{r, echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Beta_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Beta Event Number on MGS Latency
```{r, echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Beta_Event_Number + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Beta Event Duration on Position Error 
```{r, echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(absPositionError ~ age.x + Beta_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```

#### Effect of Average Beta Event Duration on MGS Latency
```{r, echo=FALSE, message=FALSE, warning=FALSE}
Everything$Subject <- as.factor(Everything$Subject)
modelFit <- lmer(mgsLatency ~ age.x + Beta_Event_Duration + (1|Subject), data = Everything[Everything$visitno.x < 2,])
car::Anova(modelFit)
```







## Frequency Bands and Task Performance Graphs
### Gamma Band Frequency 

#### Position Error

```{r echo=FALSE, message=FALSE, warning=FALSE}
 
avg_positionError <- aggregate(absPositionError ~ visitno, PerSubjectGamma[], mean)
avg_positionError_SD <- aggregate(absPositionError ~ visitno, PerSubjectGamma[], sd)
excludeHigh <- avg_positionError$absPositionError[1] + 3*avg_positionError_SD$absPositionError[1]
excludeLow <- avg_positionError$absPositionError[1] - 3*avg_positionError_SD$absPositionError[1]


ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$absPositionError < excludeHigh & PerSubjectGamma$absPositionError > excludeLow ,],  aes(x = absPositionError, y = log10_Gamma_Trial_Power_mean )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Gamma Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Power")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$absPositionError < excludeHigh & PerSubjectGamma$absPositionError > excludeLow,], log10_Gamma_Trial_Power_mean ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$absPositionError < excludeHigh & PerSubjectGamma$absPositionError > excludeLow,],  aes(x = absPositionError, y = log10_Gamma_Trial_Power_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Gamma Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$absPositionError < excludeHigh & PerSubjectGamma$absPositionError > excludeLow,], log10_Gamma_Trial_Power_SD ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$absPositionError < excludeHigh & PerSubjectGamma$absPositionError > excludeLow,],  aes(x = absPositionError, y = Gamma_Event_Duration )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Gamma Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Duration")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$absPositionError < excludeHigh & PerSubjectGamma$absPositionError > excludeLow,], Gamma_Event_Duration ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$absPositionError < excludeHigh & PerSubjectGamma$absPositionError > excludeLow,],  aes(x = absPositionError, y = Gamma_Event_Duration_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Gamma Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$absPositionError < excludeHigh & PerSubjectGamma$absPositionError > excludeLow,], Gamma_Event_Duration_SD ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$absPositionError < excludeHigh & PerSubjectGamma$absPositionError > excludeLow,],  aes(x = absPositionError, y = Gamma_Event_Number )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Gamma Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$absPositionError < excludeHigh & PerSubjectGamma$absPositionError > excludeLow,], Gamma_Event_Number ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$absPositionError < excludeHigh & PerSubjectGamma$absPositionError > excludeLow,],  aes(x = absPositionError, y = Gamma_Event_Number_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Gamma Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$absPositionError < excludeHigh & PerSubjectGamma$absPositionError > excludeLow,], Gamma_Event_Number_SD ~ absPositionError)
anova(lm.model)

```
#### mgs Latency

```{r echo=FALSE, message=FALSE, warning=FALSE}

avg_mgsLatency <- aggregate(mgsLatency ~ visitno, PerSubjectGamma[], mean)
avg_mgsLatency_SD <- aggregate(mgsLatency ~ visitno, PerSubjectGamma[], sd)
excludeHigh <- avg_mgsLatency$mgsLatency[1] + 3*avg_mgsLatency_SD$mgsLatency[1]
excludeLow <- avg_mgsLatency$mgsLatency[1] - 3*avg_mgsLatency_SD$mgsLatency[1]


ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$mgsLatency < excludeHigh & PerSubjectGamma$mgsLatency > excludeLow ,],  aes(x = mgsLatency, y = log10_Gamma_Trial_Power_mean )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Gamma Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("Power")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$mgsLatency < excludeHigh & PerSubjectGamma$mgsLatency > excludeLow,], log10_Gamma_Trial_Power_mean ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$mgsLatency < excludeHigh & PerSubjectGamma$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = log10_Gamma_Trial_Power_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Gamma Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$mgsLatency < excludeHigh & PerSubjectGamma$mgsLatency > excludeLow,], log10_Gamma_Trial_Power_SD ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$mgsLatency < excludeHigh & PerSubjectGamma$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Gamma_Event_Duration )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Gamma Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("Duration")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$mgsLatency < excludeHigh & PerSubjectGamma$mgsLatency > excludeLow,], Gamma_Event_Duration ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$mgsLatency < excludeHigh & PerSubjectGamma$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Gamma_Event_Duration_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Gamma Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$mgsLatency < excludeHigh & PerSubjectGamma$mgsLatency > excludeLow,], Gamma_Event_Duration_SD ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$mgsLatency < excludeHigh & PerSubjectGamma$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Gamma_Event_Number )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Gamma Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$mgsLatency < excludeHigh & PerSubjectGamma$mgsLatency > excludeLow,], Gamma_Event_Number ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$mgsLatency < excludeHigh & PerSubjectGamma$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Gamma_Event_Number_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Gamma Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectGamma[PerSubjectGamma$visitno < 2 & PerSubjectGamma$mgsLatency < excludeHigh & PerSubjectGamma$mgsLatency > excludeLow,], Gamma_Event_Number_SD ~ mgsLatency)
anova(lm.model)

```




### Alpha Band Frequency 

#### Position Error

```{r echo=FALSE, message=FALSE, warning=FALSE}

avg_positionError <- aggregate(absPositionError ~ visitno, PerSubjectAlpha[], mean)
avg_positionError_SD <- aggregate(absPositionError ~ visitno, PerSubjectAlpha[], sd)
excludeHigh <- avg_positionError$absPositionError[1] + 3*avg_positionError_SD$absPositionError[1]
excludeLow <- avg_positionError$absPositionError[1] - 3*avg_positionError_SD$absPositionError[1]


ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$absPositionError < excludeHigh & PerSubjectAlpha$absPositionError > excludeLow ,],  aes(x = absPositionError, y = log10_Alpha_Trial_Power_mean )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Alpha Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Power")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$absPositionError < excludeHigh & PerSubjectAlpha$absPositionError > excludeLow,], log10_Alpha_Trial_Power_mean ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$absPositionError < excludeHigh & PerSubjectAlpha$absPositionError > excludeLow,],  aes(x = absPositionError, y = log10_Alpha_Trial_Power_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Alpha Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$absPositionError < excludeHigh & PerSubjectAlpha$absPositionError > excludeLow,], log10_Alpha_Trial_Power_SD ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$absPositionError < excludeHigh & PerSubjectAlpha$absPositionError > excludeLow,],  aes(x = absPositionError, y = Alpha_Event_Duration )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Alpha Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Duration")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$absPositionError < excludeHigh & PerSubjectAlpha$absPositionError > excludeLow,], Alpha_Event_Duration ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$absPositionError < excludeHigh & PerSubjectAlpha$absPositionError > excludeLow,],  aes(x = absPositionError, y = Alpha_Event_Duration_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Alpha Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$absPositionError < excludeHigh & PerSubjectAlpha$absPositionError > excludeLow,], Alpha_Event_Duration_SD ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$absPositionError < excludeHigh & PerSubjectAlpha$absPositionError > excludeLow,],  aes(x = absPositionError, y = Alpha_Event_Number )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Alpha Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$absPositionError < excludeHigh & PerSubjectAlpha$absPositionError > excludeLow,], Alpha_Event_Number ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$absPositionError < excludeHigh & PerSubjectAlpha$absPositionError > excludeLow,],  aes(x = absPositionError, y = Alpha_Event_Number_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Alpha Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$absPositionError < excludeHigh & PerSubjectAlpha$absPositionError > excludeLow,], Alpha_Event_Number_SD ~ absPositionError)
anova(lm.model)

```
#### mgs Latency

```{r echo=FALSE, message=FALSE, warning=FALSE}

avg_mgsLatency <- aggregate(mgsLatency ~ visitno, PerSubjectAlpha[], mean)
avg_mgsLatency_SD <- aggregate(mgsLatency ~ visitno, PerSubjectAlpha[], sd)
excludeHigh <- avg_mgsLatency$mgsLatency[1] + 3*avg_mgsLatency_SD$mgsLatency[1]
excludeLow <- avg_mgsLatency$mgsLatency[1] - 3*avg_mgsLatency_SD$mgsLatency[1]


ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$mgsLatency < excludeHigh & PerSubjectAlpha$mgsLatency > excludeLow ,],  aes(x = mgsLatency, y = log10_Alpha_Trial_Power_mean )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Alpha Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("Power")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$mgsLatency < excludeHigh & PerSubjectAlpha$mgsLatency > excludeLow,], log10_Alpha_Trial_Power_mean ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$mgsLatency < excludeHigh & PerSubjectAlpha$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = log10_Alpha_Trial_Power_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Alpha Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$mgsLatency < excludeHigh & PerSubjectAlpha$mgsLatency > excludeLow,], log10_Alpha_Trial_Power_SD ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$mgsLatency < excludeHigh & PerSubjectAlpha$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Alpha_Event_Duration )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Alpha Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("Duration")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$mgsLatency < excludeHigh & PerSubjectAlpha$mgsLatency > excludeLow,], Alpha_Event_Duration ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$mgsLatency < excludeHigh & PerSubjectAlpha$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Alpha_Event_Duration_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Alpha Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$mgsLatency < excludeHigh & PerSubjectAlpha$mgsLatency > excludeLow,], Alpha_Event_Duration_SD ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$mgsLatency < excludeHigh & PerSubjectAlpha$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Alpha_Event_Number )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Alpha Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$mgsLatency < excludeHigh & PerSubjectAlpha$mgsLatency > excludeLow,], Alpha_Event_Number ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$mgsLatency < excludeHigh & PerSubjectAlpha$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Alpha_Event_Number_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Alpha Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectAlpha[PerSubjectAlpha$visitno < 2 & PerSubjectAlpha$mgsLatency < excludeHigh & PerSubjectAlpha$mgsLatency > excludeLow,], Alpha_Event_Number_SD ~ mgsLatency)
anova(lm.model)

```








### Theta Band Frequency 

#### Position Error

```{r echo=FALSE, message=FALSE, warning=FALSE}

avg_positionError <- aggregate(absPositionError ~ visitno, PerSubjectTheta[], mean)
avg_positionError_SD <- aggregate(absPositionError ~ visitno, PerSubjectTheta[], sd)
excludeHigh <- avg_positionError$absPositionError[1] + 3*avg_positionError_SD$absPositionError[1]
excludeLow <- avg_positionError$absPositionError[1] - 3*avg_positionError_SD$absPositionError[1]


ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$absPositionError < excludeHigh & PerSubjectTheta$absPositionError > excludeLow ,],  aes(x = absPositionError, y = log10_Theta_Trial_Power_mean )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Theta Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Power")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$absPositionError < excludeHigh & PerSubjectTheta$absPositionError > excludeLow,], log10_Theta_Trial_Power_mean ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$absPositionError < excludeHigh & PerSubjectTheta$absPositionError > excludeLow,],  aes(x = absPositionError, y = log10_Theta_Trial_Power_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Theta Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$absPositionError < excludeHigh & PerSubjectTheta$absPositionError > excludeLow,], log10_Theta_Trial_Power_SD ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$absPositionError < excludeHigh & PerSubjectTheta$absPositionError > excludeLow,],  aes(x = absPositionError, y = Theta_Event_Duration )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Theta Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Duration")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$absPositionError < excludeHigh & PerSubjectTheta$absPositionError > excludeLow,], Theta_Event_Duration ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$absPositionError < excludeHigh & PerSubjectTheta$absPositionError > excludeLow,],  aes(x = absPositionError, y = Theta_Event_Duration_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Theta Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$absPositionError < excludeHigh & PerSubjectTheta$absPositionError > excludeLow,], Theta_Event_Duration_SD ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$absPositionError < excludeHigh & PerSubjectTheta$absPositionError > excludeLow,],  aes(x = absPositionError, y = Theta_Event_Number )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Theta Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$absPositionError < excludeHigh & PerSubjectTheta$absPositionError > excludeLow,], Theta_Event_Number ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$absPositionError < excludeHigh & PerSubjectTheta$absPositionError > excludeLow,],  aes(x = absPositionError, y = Theta_Event_Number_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Theta Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$absPositionError < excludeHigh & PerSubjectTheta$absPositionError > excludeLow,], Theta_Event_Number_SD ~ absPositionError)
anova(lm.model)

```
#### mgs Latency

```{r echo=FALSE, message=FALSE, warning=FALSE}

avg_mgsLatency <- aggregate(mgsLatency ~ visitno, PerSubjectTheta[], mean)
avg_mgsLatency_SD <- aggregate(mgsLatency ~ visitno, PerSubjectTheta[], sd)
excludeHigh <- avg_mgsLatency$mgsLatency[1] + 3*avg_mgsLatency_SD$mgsLatency[1]
excludeLow <- avg_mgsLatency$mgsLatency[1] - 3*avg_mgsLatency_SD$mgsLatency[1]


ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$mgsLatency < excludeHigh & PerSubjectTheta$mgsLatency > excludeLow ,],  aes(x = mgsLatency, y = log10_Theta_Trial_Power_mean )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Theta Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("Power")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$mgsLatency < excludeHigh & PerSubjectTheta$mgsLatency > excludeLow,], log10_Theta_Trial_Power_mean ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$mgsLatency < excludeHigh & PerSubjectTheta$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = log10_Theta_Trial_Power_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Theta Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$mgsLatency < excludeHigh & PerSubjectTheta$mgsLatency > excludeLow,], log10_Theta_Trial_Power_SD ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$mgsLatency < excludeHigh & PerSubjectTheta$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Theta_Event_Duration )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Theta Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("Duration")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$mgsLatency < excludeHigh & PerSubjectTheta$mgsLatency > excludeLow,], Theta_Event_Duration ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$mgsLatency < excludeHigh & PerSubjectTheta$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Theta_Event_Duration_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Theta Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$mgsLatency < excludeHigh & PerSubjectTheta$mgsLatency > excludeLow,], Theta_Event_Duration_SD ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$mgsLatency < excludeHigh & PerSubjectTheta$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Theta_Event_Number )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Theta Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$mgsLatency < excludeHigh & PerSubjectTheta$mgsLatency > excludeLow,], Theta_Event_Number ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$mgsLatency < excludeHigh & PerSubjectTheta$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Theta_Event_Number_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Theta Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectTheta[PerSubjectTheta$visitno < 2 & PerSubjectTheta$mgsLatency < excludeHigh & PerSubjectTheta$mgsLatency > excludeLow,], Theta_Event_Number_SD ~ mgsLatency)
anova(lm.model)

```







### Beta Band Frequency 

#### Position Error

```{r echo=FALSE, message=FALSE, warning=FALSE}

avg_positionError <- aggregate(absPositionError ~ visitno, PerSubjectBeta[], mean)
avg_positionError_SD <- aggregate(absPositionError ~ visitno, PerSubjectBeta[], sd)
excludeHigh <- avg_positionError$absPositionError[1] + 3*avg_positionError_SD$absPositionError[1]
excludeLow <- avg_positionError$absPositionError[1] - 3*avg_positionError_SD$absPositionError[1]


ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$absPositionError < excludeHigh & PerSubjectBeta$absPositionError > excludeLow ,],  aes(x = absPositionError, y = log10_Beta_Trial_Power_mean )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Beta Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Power")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$absPositionError < excludeHigh & PerSubjectBeta$absPositionError > excludeLow,], log10_Beta_Trial_Power_mean ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$absPositionError < excludeHigh & PerSubjectBeta$absPositionError > excludeLow,],  aes(x = absPositionError, y = log10_Beta_Trial_Power_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Beta Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$absPositionError < excludeHigh & PerSubjectBeta$absPositionError > excludeLow,], log10_Beta_Trial_Power_SD ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$absPositionError < excludeHigh & PerSubjectBeta$absPositionError > excludeLow,],  aes(x = absPositionError, y = Beta_Event_Duration )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Beta Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Duration")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$absPositionError < excludeHigh & PerSubjectBeta$absPositionError > excludeLow,], Beta_Event_Duration ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$absPositionError < excludeHigh & PerSubjectBeta$absPositionError > excludeLow,],  aes(x = absPositionError, y = Beta_Event_Duration_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Beta Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$absPositionError < excludeHigh & PerSubjectBeta$absPositionError > excludeLow,], Beta_Event_Duration_SD ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$absPositionError < excludeHigh & PerSubjectBeta$absPositionError > excludeLow,],  aes(x = absPositionError, y = Beta_Event_Number )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Beta Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$absPositionError < excludeHigh & PerSubjectBeta$absPositionError > excludeLow,], Beta_Event_Number ~ absPositionError)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$absPositionError < excludeHigh & PerSubjectBeta$absPositionError > excludeLow,],  aes(x = absPositionError, y = Beta_Event_Number_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Beta Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Abs(Position Error)") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$absPositionError < excludeHigh & PerSubjectBeta$absPositionError > excludeLow,], Beta_Event_Number_SD ~ absPositionError)
anova(lm.model)

```
#### mgs Latency

```{r echo=FALSE, message=FALSE, warning=FALSE}

avg_mgsLatency <- aggregate(mgsLatency ~ visitno, PerSubjectBeta[], mean)
avg_mgsLatency_SD <- aggregate(mgsLatency ~ visitno, PerSubjectBeta[], sd)
excludeHigh <- avg_mgsLatency$mgsLatency[1] + 3*avg_mgsLatency_SD$mgsLatency[1]
excludeLow <- avg_mgsLatency$mgsLatency[1] - 3*avg_mgsLatency_SD$mgsLatency[1]


ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$mgsLatency < excludeHigh & PerSubjectBeta$mgsLatency > excludeLow ,],  aes(x = mgsLatency, y = log10_Beta_Trial_Power_mean )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Beta Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("Power")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$mgsLatency < excludeHigh & PerSubjectBeta$mgsLatency > excludeLow,], log10_Beta_Trial_Power_mean ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$mgsLatency < excludeHigh & PerSubjectBeta$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = log10_Beta_Trial_Power_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Beta Power vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("SD(Power)")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$mgsLatency < excludeHigh & PerSubjectBeta$mgsLatency > excludeLow,], log10_Beta_Trial_Power_SD ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$mgsLatency < excludeHigh & PerSubjectBeta$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Beta_Event_Duration )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Beta Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("Duration")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$mgsLatency < excludeHigh & PerSubjectBeta$mgsLatency > excludeLow,], Beta_Event_Duration ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$mgsLatency < excludeHigh & PerSubjectBeta$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Beta_Event_Duration_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Beta Event Duration vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("SD(Duration)")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$mgsLatency < excludeHigh & PerSubjectBeta$mgsLatency > excludeLow,], Beta_Event_Duration_SD ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$mgsLatency < excludeHigh & PerSubjectBeta$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Beta_Event_Number )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Average Trial Beta Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("Number of Events")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$mgsLatency < excludeHigh & PerSubjectBeta$mgsLatency > excludeLow,], Beta_Event_Number ~ mgsLatency)
anova(lm.model)

ggplot(data = PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$mgsLatency < excludeHigh & PerSubjectBeta$mgsLatency > excludeLow,],  aes(x = mgsLatency, y = Beta_Event_Number_SD )) + geom_point(aes(color = age)) + scale_color_gradient2(low = "blue", high = "red") + stat_smooth(method='lm') + ggtitle("Between Trial Variability Beta Event Number vs Position Error") + theme(plot.title = element_text(hjust = 0.5)) + xlab("MGS Latency") + ylab("SD(Number of Events)")
lm.model <- lm(data=PerSubjectBeta[PerSubjectBeta$visitno < 2 & PerSubjectBeta$mgsLatency < excludeHigh & PerSubjectBeta$mgsLatency > excludeLow,], Beta_Event_Number_SD ~ mgsLatency)
anova(lm.model)

```











# Comparing Fixation Period to Delay Period

```{r, echo= FALSE, message = FALSE, warning = FALSE}

#Average Delay Period Epochs together 
delayGamma <- setNames(aggregate(list(allDelayGamma$log10_Gamma_Trial_Power, allDelayGamma$Gamma_Event_Number, allDelayGamma$Gamma_Event_Duration), by = list(allDelayGamma$Subject),mean), c("Subject", "Gamma_Trial_Power", "Gamma_Event_Number","Gamma_Event_Duration"))

delayAlpha <- setNames(aggregate(list(allDelayAlpha$log10_Alpha_Trial_Power, allDelayAlpha$Alpha_Event_Number, allDelayAlpha$Alpha_Event_Duration), by = list(allDelayAlpha$Subject),mean), c("Subject", "Alpha_Trial_Power", "Alpha_Event_Number","Alpha_Event_Duration"))

delayTheta <- setNames(aggregate(list(allDelayTheta$log10_Theta_Trial_Power, allDelayTheta$Theta_Event_Number, allDelayTheta$Theta_Event_Duration), by = list(allDelayTheta$Subject),mean), c("Subject", "Theta_Trial_Power", "Theta_Event_Number","Theta_Event_Duration"))

delayBeta <- setNames(aggregate(list(allDelayBeta$log10_Beta_Trial_Power, allDelayBeta$Beta_Event_Number, allDelayBeta$Beta_Event_Duration), by = list(allDelayBeta$Subject),mean), c("Subject", "Beta_Trial_Power", "Beta_Event_Number","Beta_Event_Duration"))

gammaRatio <- merge(PerSubjectGamma, delayGamma, by= "Subject", suffix = c("_Fix", "_Delay"))
AlphaRatio <- merge(PerSubjectAlpha, delayAlpha, by= "Subject", suffix = c("_Fix", "_Delay"))
ThetaRatio <- merge(PerSubjectTheta, delayTheta, by= "Subject", suffix = c("_Fix", "_Delay"))
BetaRatio <- merge(PerSubjectBeta, delayBeta, by= "Subject", suffix = c("_Fix", "_Delay"))

```

## Gamma Frequency Band
```{r, echo= FALSE, message = FALSE, warning = FALSE}
ggplot() + geom_point(data = gammaRatio, aes(x = age, y = log10_Gamma_Trial_Power_mean), color = "blue") +stat_smooth(data = gammaRatio, aes(x = age, y = log10_Gamma_Trial_Power_mean), color = "blue", method='lm',  formula='y~I(1/x)') + geom_point(data = gammaRatio, aes(x = age, y = Gamma_Trial_Power), color = "red") + stat_smooth(data = gammaRatio, aes(x = age, y = Gamma_Trial_Power), color = "red", method = 'lm', formula = 'y~I(1/x)') + ggtitle("Average Trial Gamma Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power") + theme(legend.position = "right") 

```
Blue: Fixation. Red: Delay

```{r, echo= FALSE, message = FALSE, warning = FALSE}
ggplot() + geom_point(data = gammaRatio, aes(x = age, y = Gamma_Event_Number_Fix), color = "blue") +stat_smooth(data = gammaRatio, aes(x = age, y = Gamma_Event_Number_Fix), color = "blue", method='lm',  formula='y~I(1/x)') + geom_point(data = gammaRatio, aes(x = age, y = Gamma_Event_Number_Delay), color = "red") + stat_smooth(data = gammaRatio, aes(x = age, y = Gamma_Event_Number_Delay), color = "red", method = 'lm', formula = 'y~I(1/x)') + ggtitle("Average Number of Gamma Events Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Number of Events") + theme(legend.position = "right") 

```
Blue: Fixation. Red: Delay

```{r, echo= FALSE, message = FALSE, warning = FALSE}
ggplot() + geom_point(data = gammaRatio, aes(x = age, y = Gamma_Event_Duration_Fix), color = "blue") +stat_smooth(data = gammaRatio, aes(x = age, y = Gamma_Event_Duration_Fix), color = "blue", method='lm',  formula='y~I(1/x)') + geom_point(data = gammaRatio, aes(x = age, y = Gamma_Event_Duration_Delay), color = "red") + stat_smooth(data = gammaRatio, aes(x = age, y = Gamma_Event_Duration_Delay), color = "red", method = 'lm', formula = 'y~I(1/x)') + ggtitle("Average Duration of Gamma Events Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Duration of Events") + theme(legend.position = "right") 

```
Blue: Fixation. Red: Delay

## Alpha Frequency Band
```{r, echo= FALSE, message = FALSE, warning = FALSE}
ggplot() + geom_point(data = AlphaRatio, aes(x = age, y = log10_Alpha_Trial_Power_mean), color = "blue") +stat_smooth(data = AlphaRatio, aes(x = age, y = log10_Alpha_Trial_Power_mean), color = "blue", method='lm',  formula='y~I(1/x)') + geom_point(data = AlphaRatio, aes(x = age, y = Alpha_Trial_Power), color = "red") + stat_smooth(data = AlphaRatio, aes(x = age, y = Alpha_Trial_Power), color = "red", method = 'lm', formula = 'y~I(1/x)') + ggtitle("Average Trial Alpha Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power") + theme(legend.position = "right") 


```
Blue: Fixation. Red: Delay

```{r, echo= FALSE, message = FALSE, warning = FALSE}
ggplot() + geom_point(data = AlphaRatio, aes(x = age, y = Alpha_Event_Number_Fix), color = "blue") +stat_smooth(data = AlphaRatio, aes(x = age, y = Alpha_Event_Number_Fix), color = "blue", method='lm',  formula='y~I(1/x)') + geom_point(data = AlphaRatio, aes(x = age, y = Alpha_Event_Number_Delay), color = "red") + stat_smooth(data = AlphaRatio, aes(x = age, y = Alpha_Event_Number_Delay), color = "red", method = 'lm', formula = 'y~I(1/x)') + ggtitle("Average Number of Alpha Events Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Number of Events") + theme(legend.position = "right") 

```
Blue: Fixation. Red: Delay

```{r, echo= FALSE, message = FALSE, warning = FALSE}
ggplot() + geom_point(data = AlphaRatio, aes(x = age, y = Alpha_Event_Duration_Fix), color = "blue") +stat_smooth(data = AlphaRatio, aes(x = age, y = Alpha_Event_Duration_Fix), color = "blue", method='lm',  formula='y~I(1/x)') + geom_point(data = AlphaRatio, aes(x = age, y = Alpha_Event_Duration_Delay), color = "red") + stat_smooth(data = AlphaRatio, aes(x = age, y = Alpha_Event_Duration_Delay), color = "red", method = 'lm', formula = 'y~I(1/x)') + ggtitle("Average Duration of Alpha Events Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Duration of Events") + theme(legend.position = "right") 

```
Blue: Fixation. Red: Delay

## Theta Frequency Band
```{r, echo= FALSE, message = FALSE, warning = FALSE}
ggplot() + geom_point(data = ThetaRatio, aes(x = age, y = log10_Theta_Trial_Power_mean), color = "blue") +stat_smooth(data = ThetaRatio, aes(x = age, y = log10_Theta_Trial_Power_mean), color = "blue", method='lm',  formula='y~I(1/x)') + geom_point(data = ThetaRatio, aes(x = age, y = Theta_Trial_Power), color = "red") + stat_smooth(data = ThetaRatio, aes(x = age, y = Theta_Trial_Power), color = "red", method = 'lm', formula = 'y~I(1/x)') + ggtitle("Average Trial Theta Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power") + theme(legend.position = "right") 


```
Blue: Fixation. Red: Delay

```{r, echo= FALSE, message = FALSE, warning = FALSE}
ggplot() + geom_point(data = ThetaRatio, aes(x = age, y = Theta_Event_Number_Fix), color = "blue") +stat_smooth(data = ThetaRatio, aes(x = age, y = Theta_Event_Number_Fix), color = "blue", method='lm',  formula='y~I(1/x)') + geom_point(data = ThetaRatio, aes(x = age, y = Theta_Event_Number_Delay), color = "red") + stat_smooth(data = ThetaRatio, aes(x = age, y = Theta_Event_Number_Delay), color = "red", method = 'lm', formula = 'y~I(1/x)') + ggtitle("Average Number of Theta Events Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Number of Events") + theme(legend.position = "right") 

```
Blue: Fixation. Red: Delay

```{r, echo= FALSE, message = FALSE, warning = FALSE}
ggplot() + geom_point(data = ThetaRatio, aes(x = age, y = Theta_Event_Duration_Fix), color = "blue") +stat_smooth(data = ThetaRatio, aes(x = age, y = Theta_Event_Duration_Fix), color = "blue", method='lm',  formula='y~I(1/x)') + geom_point(data = ThetaRatio, aes(x = age, y = Theta_Event_Duration_Delay), color = "red") + stat_smooth(data = ThetaRatio, aes(x = age, y = Theta_Event_Duration_Delay), color = "red", method = 'lm', formula = 'y~I(1/x)') + ggtitle("Average Duration of Theta Events Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Duration of Events") + theme(legend.position = "right") 

```
Blue: Fixation. Red: Delay

## Beta Frequency Band
```{r, echo= FALSE, message = FALSE, warning = FALSE}
ggplot() + geom_point(data = BetaRatio, aes(x = age, y = log10_Beta_Trial_Power_mean), color = "blue") +stat_smooth(data = BetaRatio, aes(x = age, y = log10_Beta_Trial_Power_mean), color = "blue", method='lm',  formula='y~I(1/x)') + geom_point(data = BetaRatio, aes(x = age, y = Beta_Trial_Power), color = "red") + stat_smooth(data = BetaRatio, aes(x = age, y = Beta_Trial_Power), color = "red", method = 'lm', formula = 'y~I(1/x)') + ggtitle("Average Trial Beta Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power") + theme(legend.position = "right") 


```
Blue: Fixation. Red: Delay

```{r, echo= FALSE, message = FALSE, warning = FALSE}
ggplot() + geom_point(data = BetaRatio, aes(x = age, y = Beta_Event_Number_Fix), color = "blue") +stat_smooth(data = BetaRatio, aes(x = age, y = Beta_Event_Number_Fix), color = "blue", method='lm',  formula='y~I(1/x)') + geom_point(data = BetaRatio, aes(x = age, y = Beta_Event_Number_Delay), color = "red") + stat_smooth(data = BetaRatio, aes(x = age, y = Beta_Event_Number_Delay), color = "red", method = 'lm', formula = 'y~I(1/x)') + ggtitle("Average Number of Beta Events Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Number of Events") + theme(legend.position = "right") 

```
Blue: Fixation. Red: Delay

```{r, echo= FALSE, message = FALSE, warning = FALSE}
ggplot() + geom_point(data = BetaRatio, aes(x = age, y = Beta_Event_Duration_Fix), color = "blue") +stat_smooth(data = BetaRatio, aes(x = age, y = Beta_Event_Duration_Fix), color = "blue", method='lm',  formula='y~I(1/x)') + geom_point(data = BetaRatio, aes(x = age, y = Beta_Event_Duration_Delay), color = "red") + stat_smooth(data = BetaRatio, aes(x = age, y = Beta_Event_Duration_Delay), color = "red", method = 'lm', formula = 'y~I(1/x)') + ggtitle("Average Duration of Beta Events Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Duration of Events") + theme(legend.position = "right") 

```
Blue: Fixation. Red: Delay


# Fixation to Delay Ratio
## Gamma Frequency Band
```{r, echo= FALSE, message = FALSE, warning = FALSE}
gammaRatio$log10_Power_Ratio <- gammaRatio$log10_Gamma_Trial_Power_mean/gammaRatio$Gamma_Trial_Power 
gammaRatio$Event_Number_Ratio <- gammaRatio$Gamma_Event_Number_Fix/gammaRatio$Gamma_Event_Number_Delay
gammaRatio$Event_Duration_Ratio <- gammaRatio$Gamma_Event_Duration_Fix/gammaRatio$Gamma_Event_Duration_Delay

ggplot(data = gammaRatio[gammaRatio$visitno < 2,],  aes(x = age, y = log10_Power_Ratio )) + geom_point() + stat_smooth(method='loess',  formula='y~I(1/x)') + ggtitle("Average Trial Gamma Power Fixation:Delay vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power Ratio")

ggplot(data = gammaRatio[gammaRatio$visitno < 2,],  aes(x = age, y = Event_Number_Ratio )) + geom_point() + stat_smooth(method='loess',  formula='y~I(1/x)') + ggtitle("Average Trial Number of Gamma Events Fixation:Delay vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Number of Events Ratio")

ggplot(data = gammaRatio[gammaRatio$visitno < 2,],  aes(x = age, y = Event_Duration_Ratio )) + geom_point() + stat_smooth(method='loess',  formula='y~I(1/x)') + ggtitle("Average Trial Duration of Gamma Events Fixation:Delay vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Duration of Events Ratio")
``` 

## Alpha Frequency Band
```{r, echo= FALSE, message = FALSE, warning = FALSE}
AlphaRatio$log10_Power_Ratio <- AlphaRatio$log10_Alpha_Trial_Power_mean/AlphaRatio$Alpha_Trial_Power 
AlphaRatio$Event_Number_Ratio <- AlphaRatio$Alpha_Event_Number_Fix/AlphaRatio$Alpha_Event_Number_Delay
AlphaRatio$Event_Duration_Ratio <- AlphaRatio$Alpha_Event_Duration_Fix/AlphaRatio$Alpha_Event_Duration_Delay

ggplot(data = AlphaRatio[AlphaRatio$visitno < 2,],  aes(x = age, y = log10_Power_Ratio )) + geom_point() + stat_smooth(method='loess',  formula='y~I(1/x)') + ggtitle("Average Trial Alpha Power Fixation:Delay vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power Ratio")

ggplot(data = AlphaRatio[AlphaRatio$visitno < 2,],  aes(x = age, y = Event_Number_Ratio )) + geom_point() + stat_smooth(method='loess',  formula='y~I(1/x)') + ggtitle("Average Trial Number of Alpha Events Fixation:Delay vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Number of Events Ratio")

ggplot(data = AlphaRatio[AlphaRatio$visitno < 2,],  aes(x = age, y = Event_Duration_Ratio )) + geom_point() + stat_smooth(method='loess',  formula='y~I(1/x)') + ggtitle("Average Trial Duration of Alpha Events Fixation:Delay vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Duration of Events Ratio")

```

## Theta Frequency Band
```{r, echo= FALSE, message = FALSE, warning = FALSE}
ThetaRatio$log10_Power_Ratio <- ThetaRatio$log10_Theta_Trial_Power_mean/ThetaRatio$Theta_Trial_Power 
ThetaRatio$Event_Number_Ratio <- ThetaRatio$Theta_Event_Number_Fix/ThetaRatio$Theta_Event_Number_Delay
ThetaRatio$Event_Duration_Ratio <- ThetaRatio$Theta_Event_Duration_Fix/ThetaRatio$Theta_Event_Duration_Delay

ggplot(data = ThetaRatio[ThetaRatio$visitno < 2,],  aes(x = age, y = log10_Power_Ratio )) + geom_point() + stat_smooth(method='loess',  formula='y~I(1/x)') + ggtitle("Average Trial Theta Power Fixation:Delay vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power Ratio")

ggplot(data = ThetaRatio[ThetaRatio$visitno < 2,],  aes(x = age, y = Event_Number_Ratio )) + geom_point() + stat_smooth(method='loess',  formula='y~I(1/x)') + ggtitle("Average Trial Number of Theta Events Fixation:Delay vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Number of Events Ratio")

ggplot(data = ThetaRatio[ThetaRatio$visitno < 2,],  aes(x = age, y = Event_Duration_Ratio )) + geom_point() + stat_smooth(method='loess',  formula='y~I(1/x)') + ggtitle("Average Trial Duration of Theta Events Fixation:Delay vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Duration of Events Ratio")

```

## Beta Frequency Band

```{r, echo= FALSE, message = FALSE, warning = FALSE}
BetaRatio$log10_Power_Ratio <- BetaRatio$log10_Beta_Trial_Power_mean/BetaRatio$Beta_Trial_Power 
BetaRatio$Event_Number_Ratio <- BetaRatio$Beta_Event_Number_Fix/BetaRatio$Beta_Event_Number_Delay
BetaRatio$Event_Duration_Ratio <- BetaRatio$Beta_Event_Duration_Fix/BetaRatio$Beta_Event_Duration_Delay

ggplot(data = BetaRatio[BetaRatio$visitno < 2,],  aes(x = age, y = log10_Power_Ratio )) + geom_point() + stat_smooth(method='loess',  formula='y~I(1/x)') + ggtitle("Average Trial Beta Power Fixation:Delay vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Power Ratio")

ggplot(data = BetaRatio[BetaRatio$visitno < 2,],  aes(x = age, y = Event_Number_Ratio )) + geom_point() + stat_smooth(method='loess',  formula='y~I(1/x)') + ggtitle("Average Trial Number of Beta Events Fixation:Delay vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Number of Events Ratio")

ggplot(data = BetaRatio[BetaRatio$visitno < 2,],  aes(x = age, y = Event_Duration_Ratio )) + geom_point() + stat_smooth(method='loess',  formula='y~I(1/x)') + ggtitle("Average Trial Duration of Beta Events Fixation:Delay vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Duration of Events Ratio")

```




# Peak Frequency and Power
## Delay Period
### Gamma Frequency Band 

```{r, echo= FALSE, message = FALSE, warning = FALSE}

GammaDelay1_2 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Gamma/Delay1_2/Gamma_all_PeakFreq_Power.csv')
GammaDelay2_3 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Gamma/Delay2_3/Gamma_all_PeakFreq_Power2_3.csv')
GammaDelay3_4 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Gamma/Delay3_4/Gamma_all_PeakFreq_Power3_4.csv')
GammaDelay4_5 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Gamma/Delay4_5/Gamma_all_PeakFreq_Power4_5.csv')
GammaDelay5_6 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Gamma/Delay5_6/Gamma_all_PeakFreq_Power5_6.csv')

GammaDelay1_2$log_Peak_Power <- log10(GammaDelay1_2$Gamma_Peak_Power)
GammaDelay2_3$log_Peak_Power <- log10(GammaDelay2_3$Gamma_Peak_Power)
GammaDelay3_4$log_Peak_Power <- log10(GammaDelay3_4$Gamma_Peak_Power)
GammaDelay4_5$log_Peak_Power <- log10(GammaDelay4_5$Gamma_Peak_Power)
GammaDelay5_6$log_Peak_Power <- log10(GammaDelay5_6$Gamma_Peak_Power)


Avg_Gamma_Peak_Frequency1_2 <- aggregate(Gamma_Peak_Frequency ~ Subject, GammaDelay1_2, mean)
Avg_Gamma_Peak_Power1_2 <- aggregate(log_Peak_Power ~ Subject, GammaDelay1_2, mean)
Avg_GammaDelay1_2 <- merge (Avg_Gamma_Peak_Frequency1_2, Avg_Gamma_Peak_Power1_2, by = "Subject",  all.x = TRUE, all.y = TRUE)


Avg_Gamma_Peak_Frequency2_3 <- aggregate(Gamma_Peak_Frequency ~ Subject, GammaDelay2_3, mean)
Avg_Gamma_Peak_Power2_3 <- aggregate(log_Peak_Power ~ Subject, GammaDelay2_3, mean)
Avg_GammaDelay2_3 <- merge (Avg_Gamma_Peak_Frequency2_3, Avg_Gamma_Peak_Power2_3, by = "Subject",  all.x = TRUE, all.y = TRUE)


Avg_Gamma_Peak_Frequency3_4 <- aggregate(Gamma_Peak_Frequency ~ Subject, GammaDelay3_4, mean)
Avg_Gamma_Peak_Power3_4 <- aggregate(log_Peak_Power ~ Subject, GammaDelay3_4, mean)
Avg_GammaDelay3_4 <- merge (Avg_Gamma_Peak_Frequency3_4, Avg_Gamma_Peak_Power3_4, by = "Subject",  all.x = TRUE, all.y = TRUE)


Avg_Gamma_Peak_Frequency4_5 <- aggregate(Gamma_Peak_Frequency ~ Subject, GammaDelay4_5, mean)
Avg_Gamma_Peak_Power4_5 <- aggregate(log_Peak_Power ~ Subject, GammaDelay4_5, mean)
Avg_GammaDelay4_5 <- merge (Avg_Gamma_Peak_Frequency4_5, Avg_Gamma_Peak_Power4_5, by = "Subject",  all.x = TRUE, all.y = TRUE)


Avg_Gamma_Peak_Frequency5_6 <- aggregate(Gamma_Peak_Frequency ~ Subject, GammaDelay5_6, mean)
Avg_Gamma_Peak_Power5_6 <- aggregate(log_Peak_Power ~ Subject, GammaDelay5_6, mean)
Avg_GammaDelay5_6 <- merge (Avg_Gamma_Peak_Frequency5_6, Avg_Gamma_Peak_Power5_6, by = "Subject",  all.x = TRUE, all.y = TRUE)

allGammaPeakInfo <- rbind(Avg_GammaDelay1_2, Avg_GammaDelay2_3)
allGammaPeakInfo <- rbind(allGammaPeakInfo, Avg_GammaDelay3_4)
allGammaPeakInfo <- rbind(allGammaPeakInfo,Avg_GammaDelay4_5)
allGammaPeakInfo <- rbind(allGammaPeakInfo, Avg_GammaDelay5_6)
allGammaPeakInfo <- merge(allGammaPeakInfo, agefile, by= "Subject")
allGammaPeakInfo <- subset(allGammaPeakInfo, visitno < 2)

Avg_log_Peak_Power <- aggregate(log_Peak_Power ~ Subject, allGammaPeakInfo, mean)
Avg_Peak_Frequency <- aggregate(Gamma_Peak_Frequency ~ Subject, allGammaPeakInfo, mean)

finalPeakMatrix <- merge(Avg_log_Peak_Power, Avg_Peak_Frequency, by = "Subject")
finalPeakMatrix <- merge(finalPeakMatrix, agefile, by = "Subject")
finalPeakMatrix$inverseAge <- 1/finalPeakMatrix$age

ggplot(data = finalPeakMatrix, aes(x = age, y = log_Peak_Power)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Event Peak Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("log(Power)")

lm.model <- lm(data = finalPeakMatrix, log_Peak_Power ~ inverseAge )
anova(lm.model)

ggplot(data = finalPeakMatrix, aes(x = age, y = Gamma_Peak_Frequency)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Event Peak Frequency vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Frequency")
lm.model <- lm(data = finalPeakMatrix, Gamma_Peak_Frequency ~ inverseAge )
anova(lm.model)

delayPeakMatrixGroup <- setnames(aggregate(list(finalPeakMatrix$log_Peak_Power, finalPeakMatrix$Gamma_Peak_Frequency), by = list(finalPeakMatrix$Group, finalPeakMatrix$Group), mean ), c("Group1", "Age_Group", "log_Peak_Power", "Gamma_Peak_Frequency"))

delayPeakMatrixGroup$Age_Group[1] <- "10-15 yrs old"
delayPeakMatrixGroup$Age_Group[2] <- "16-20 yrs old"
delayPeakMatrixGroup$Age_Group[3] <- "21-25 yrs old"
delayPeakMatrixGroup$Age_Group[4] <- "26+ yrs old"


                                                                                                                                                                                
ggplot(data = delayPeakMatrixGroup, aes(x = Age_Group, y = log_Peak_Power, color = Age_Group)) + geom_point() + geom_line() + ggtitle("Gamma Peak Power Per Age Group") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age Group") + ylab("log(Power)") 

ggplot(data = delayPeakMatrixGroup, aes(x = Age_Group, y = Gamma_Peak_Frequency, color = Age_Group)) + geom_point()  + geom_line() + ggtitle("Gamma Peak Frequency Per Age Group") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age Group") + ylab("Frequency")


```


### Alpha Frequency Band 

```{r, echo= FALSE, message = FALSE, warning = FALSE}

AlphaDelay1_2 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Alpha/Delay1_2/Alpha_all_PeakFreq_Power.csv')
AlphaDelay2_3 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Alpha/Delay2_3/Alpha_all_PeakFreq_Power2_3.csv')
AlphaDelay3_4 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Alpha/Delay3_4/Alpha_all_PeakFreq_Power3_4.csv')
AlphaDelay4_5 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Alpha/Delay4_5/Alpha_all_PeakFreq_Power4_5.csv')
AlphaDelay5_6 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Alpha/Delay5_6/Alpha_all_PeakFreq_Power5_6.csv')

AlphaDelay1_2$log_Peak_Power <- log10(AlphaDelay1_2$Alpha_Peak_Power)
AlphaDelay2_3$log_Peak_Power <- log10(AlphaDelay2_3$Alpha_Peak_Power)
AlphaDelay3_4$log_Peak_Power <- log10(AlphaDelay3_4$Alpha_Peak_Power)
AlphaDelay4_5$log_Peak_Power <- log10(AlphaDelay4_5$Alpha_Peak_Power)
AlphaDelay5_6$log_Peak_Power <- log10(AlphaDelay5_6$Alpha_Peak_Power)


Avg_Alpha_Peak_Frequency1_2 <- aggregate(Alpha_Peak_Frequency ~ Subject, AlphaDelay1_2, mean)
Avg_Alpha_Peak_Power1_2 <- aggregate(log_Peak_Power ~ Subject, AlphaDelay1_2, mean)
Avg_AlphaDelay1_2 <- merge (Avg_Alpha_Peak_Frequency1_2, Avg_Alpha_Peak_Power1_2, by = "Subject",  all.x = TRUE, all.y = TRUE)


Avg_Alpha_Peak_Frequency2_3 <- aggregate(Alpha_Peak_Frequency ~ Subject, AlphaDelay2_3, mean)
Avg_Alpha_Peak_Power2_3 <- aggregate(log_Peak_Power ~ Subject, AlphaDelay2_3, mean)
Avg_AlphaDelay2_3 <- merge (Avg_Alpha_Peak_Frequency2_3, Avg_Alpha_Peak_Power2_3, by = "Subject",  all.x = TRUE, all.y = TRUE)


Avg_Alpha_Peak_Frequency3_4 <- aggregate(Alpha_Peak_Frequency ~ Subject, AlphaDelay3_4, mean)
Avg_Alpha_Peak_Power3_4 <- aggregate(log_Peak_Power ~ Subject, AlphaDelay3_4, mean)
Avg_AlphaDelay3_4 <- merge (Avg_Alpha_Peak_Frequency3_4, Avg_Alpha_Peak_Power3_4, by = "Subject",  all.x = TRUE, all.y = TRUE)


Avg_Alpha_Peak_Frequency4_5 <- aggregate(Alpha_Peak_Frequency ~ Subject, AlphaDelay4_5, mean)
Avg_Alpha_Peak_Power4_5 <- aggregate(log_Peak_Power ~ Subject, AlphaDelay4_5, mean)
Avg_AlphaDelay4_5 <- merge (Avg_Alpha_Peak_Frequency4_5, Avg_Alpha_Peak_Power4_5, by = "Subject",  all.x = TRUE, all.y = TRUE)


Avg_Alpha_Peak_Frequency5_6 <- aggregate(Alpha_Peak_Frequency ~ Subject, AlphaDelay5_6, mean)
Avg_Alpha_Peak_Power5_6 <- aggregate(log_Peak_Power ~ Subject, AlphaDelay5_6, mean)
Avg_AlphaDelay5_6 <- merge (Avg_Alpha_Peak_Frequency5_6, Avg_Alpha_Peak_Power5_6, by = "Subject",  all.x = TRUE, all.y = TRUE)

allAlphaPeakInfo <- rbind(Avg_AlphaDelay1_2, Avg_AlphaDelay2_3)
allAlphaPeakInfo <- rbind(allAlphaPeakInfo, Avg_AlphaDelay3_4)
allAlphaPeakInfo <- rbind(allAlphaPeakInfo,Avg_AlphaDelay4_5)
allAlphaPeakInfo <- rbind(allAlphaPeakInfo, Avg_AlphaDelay5_6)
allAlphaPeakInfo <- merge(allAlphaPeakInfo, agefile, by= "Subject")
allAlphaPeakInfo <- subset(allAlphaPeakInfo, visitno < 2)

Avg_log_Peak_Power <- aggregate(log_Peak_Power ~ Subject, allAlphaPeakInfo, mean)
Avg_Peak_Frequency <- aggregate(Alpha_Peak_Frequency ~ Subject, allAlphaPeakInfo, mean)

finalPeakMatrix <- merge(Avg_log_Peak_Power, Avg_Peak_Frequency, by = "Subject")
finalPeakMatrix <- merge(finalPeakMatrix, agefile, by = "Subject")
finalPeakMatrix$inverseAge <- 1/finalPeakMatrix$age

ggplot(data = finalPeakMatrix, aes(x = age, y = log_Peak_Power)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Event Peak Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("log(Power)")

lm.model <- lm(data = finalPeakMatrix, log_Peak_Power ~ inverseAge )
anova(lm.model)

ggplot(data = finalPeakMatrix, aes(x = age, y = Alpha_Peak_Frequency)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Event Peak Frequency vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Frequency")

lm.model <- lm(data = finalPeakMatrix, Alpha_Peak_Frequency ~ inverseAge )
anova(lm.model)


delayPeakMatrixGroup <- setnames(aggregate(list(finalPeakMatrix$log_Peak_Power, finalPeakMatrix$Alpha_Peak_Frequency), by = list(finalPeakMatrix$Group, finalPeakMatrix$Group), mean ), c("Group1", "Age_Group", "log_Peak_Power", "Alpha_Peak_Frequency"))

delayPeakMatrixGroup$Age_Group[1] <- "10-15 yrs old"
delayPeakMatrixGroup$Age_Group[2] <- "16-20 yrs old"
delayPeakMatrixGroup$Age_Group[3] <- "21-25 yrs old"
delayPeakMatrixGroup$Age_Group[4] <- "26+ yrs old"


                                                                                                                                                                                
ggplot(data = delayPeakMatrixGroup, aes(x = Age_Group, y = log_Peak_Power, color = Age_Group)) + geom_point() + geom_line() + ggtitle("Alpha Peak Power Per Age Group") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age Group") + ylab("log(Power)") 

ggplot(data = delayPeakMatrixGroup, aes(x = Age_Group, y = Alpha_Peak_Frequency, color = Age_Group)) + geom_point()  + geom_line() + ggtitle("Alpha Peak Frequency Per Age Group") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age Group") + ylab("Frequency")



```

### Theta Frequency Band 

```{r, echo= FALSE, message = FALSE, warning = FALSE}

ThetaDelay1_2 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Theta/Delay1_2/Theta_all_PeakFreq_Power.csv')
ThetaDelay2_3 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Theta/Delay2_3/Theta_all_PeakFreq_Power2_3.csv')
ThetaDelay3_4 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Theta/Delay3_4/Theta_all_PeakFreq_Power3_4.csv')
ThetaDelay4_5 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Theta/Delay4_5/Theta_all_PeakFreq_Power4_5.csv')
ThetaDelay5_6 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Theta/Delay5_6/Theta_all_PeakFreq_Power5_6.csv')

ThetaDelay1_2$log_Peak_Power <- log10(ThetaDelay1_2$Theta_Peak_Power)
ThetaDelay2_3$log_Peak_Power <- log10(ThetaDelay2_3$Theta_Peak_Power)
ThetaDelay3_4$log_Peak_Power <- log10(ThetaDelay3_4$Theta_Peak_Power)
ThetaDelay4_5$log_Peak_Power <- log10(ThetaDelay4_5$Theta_Peak_Power)
ThetaDelay5_6$log_Peak_Power <- log10(ThetaDelay5_6$Theta_Peak_Power)


Avg_Theta_Peak_Frequency1_2 <- aggregate(Theta_Peak_Frequency ~ Subject, ThetaDelay1_2, mean)
Avg_Theta_Peak_Power1_2 <- aggregate(log_Peak_Power ~ Subject, ThetaDelay1_2, mean)
Avg_ThetaDelay1_2 <- merge (Avg_Theta_Peak_Frequency1_2, Avg_Theta_Peak_Power1_2, by = "Subject",  all.x = TRUE, all.y = TRUE)


Avg_Theta_Peak_Frequency2_3 <- aggregate(Theta_Peak_Frequency ~ Subject, ThetaDelay2_3, mean)
Avg_Theta_Peak_Power2_3 <- aggregate(log_Peak_Power ~ Subject, ThetaDelay2_3, mean)
Avg_ThetaDelay2_3 <- merge (Avg_Theta_Peak_Frequency2_3, Avg_Theta_Peak_Power2_3, by = "Subject",  all.x = TRUE, all.y = TRUE)


Avg_Theta_Peak_Frequency3_4 <- aggregate(Theta_Peak_Frequency ~ Subject, ThetaDelay3_4, mean)
Avg_Theta_Peak_Power3_4 <- aggregate(log_Peak_Power ~ Subject, ThetaDelay3_4, mean)
Avg_ThetaDelay3_4 <- merge (Avg_Theta_Peak_Frequency3_4, Avg_Theta_Peak_Power3_4, by = "Subject",  all.x = TRUE, all.y = TRUE)


Avg_Theta_Peak_Frequency4_5 <- aggregate(Theta_Peak_Frequency ~ Subject, ThetaDelay4_5, mean)
Avg_Theta_Peak_Power4_5 <- aggregate(log_Peak_Power ~ Subject, ThetaDelay4_5, mean)
Avg_ThetaDelay4_5 <- merge (Avg_Theta_Peak_Frequency4_5, Avg_Theta_Peak_Power4_5, by = "Subject",  all.x = TRUE, all.y = TRUE)


Avg_Theta_Peak_Frequency5_6 <- aggregate(Theta_Peak_Frequency ~ Subject, ThetaDelay5_6, mean)
Avg_Theta_Peak_Power5_6 <- aggregate(log_Peak_Power ~ Subject, ThetaDelay5_6, mean)
Avg_ThetaDelay5_6 <- merge (Avg_Theta_Peak_Frequency5_6, Avg_Theta_Peak_Power5_6, by = "Subject",  all.x = TRUE, all.y = TRUE)

allThetaPeakInfo <- rbind(Avg_ThetaDelay1_2, Avg_ThetaDelay2_3)
allThetaPeakInfo <- rbind(allThetaPeakInfo, Avg_ThetaDelay3_4)
allThetaPeakInfo <- rbind(allThetaPeakInfo,Avg_ThetaDelay4_5)
allThetaPeakInfo <- rbind(allThetaPeakInfo, Avg_ThetaDelay5_6)
allThetaPeakInfo <- merge(allThetaPeakInfo, agefile, by= "Subject")
allThetaPeakInfo <- subset(allThetaPeakInfo, visitno < 2)

Avg_log_Peak_Power <- aggregate(log_Peak_Power ~ Subject, allThetaPeakInfo, mean)
Avg_Peak_Frequency <- aggregate(Theta_Peak_Frequency ~ Subject, allThetaPeakInfo, mean)

finalPeakMatrix <- merge(Avg_log_Peak_Power, Avg_Peak_Frequency, by = "Subject")
finalPeakMatrix <- merge(finalPeakMatrix, agefile, by = "Subject")
finalPeakMatrix$inverseAge <- 1/finalPeakMatrix$age

ggplot(data = finalPeakMatrix, aes(x = age, y = log_Peak_Power)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Event Peak Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("log(Power)")

lm.model <- lm(data = finalPeakMatrix, log_Peak_Power ~ inverseAge )
anova(lm.model)

ggplot(data = finalPeakMatrix, aes(x = age, y = Theta_Peak_Frequency)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Event Peak Frequency vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Frequency")

lm.model <- lm(data = finalPeakMatrix, Theta_Peak_Frequency ~ inverseAge )
anova(lm.model)


delayPeakMatrixGroup <- setnames(aggregate(list(finalPeakMatrix$log_Peak_Power, finalPeakMatrix$Theta_Peak_Frequency), by = list(finalPeakMatrix$Group, finalPeakMatrix$Group), mean ), c("Group1", "Age_Group", "log_Peak_Power", "Theta_Peak_Frequency"))

delayPeakMatrixGroup$Age_Group[1] <- "10-15 yrs old"
delayPeakMatrixGroup$Age_Group[2] <- "16-20 yrs old"
delayPeakMatrixGroup$Age_Group[3] <- "21-25 yrs old"
delayPeakMatrixGroup$Age_Group[4] <- "26+ yrs old"


                                                                                                                                                                                
ggplot(data = delayPeakMatrixGroup, aes(x = Age_Group, y = log_Peak_Power, color = Age_Group)) + geom_point() + geom_line() + ggtitle("Theta Peak Power Per Age Group") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age Group") + ylab("log(Power)") 

ggplot(data = delayPeakMatrixGroup, aes(x = Age_Group, y = Theta_Peak_Frequency, color = Age_Group)) + geom_point()  + geom_line() + ggtitle("Theta Peak Frequency Per Age Group") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age Group") + ylab("Frequency")


```

### Beta Frequency Band 

```{r, echo= FALSE, message = FALSE, warning = FALSE}

BetaDelay1_2 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Beta/Delay1_2/Beta_all_PeakFreq_Power.csv')
BetaDelay2_3 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Beta/Delay2_3/Beta_all_PeakFreq_Power2_3.csv')
BetaDelay3_4 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Beta/Delay3_4/Beta_all_PeakFreq_Power3_4.csv')
BetaDelay4_5 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Beta/Delay4_5/Beta_all_PeakFreq_Power4_5.csv')
BetaDelay5_6 <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Beta/Delay5_6/Beta_all_PeakFreq_Power5_6.csv')

BetaDelay1_2$log_Peak_Power <- log10(BetaDelay1_2$Beta_Peak_Power)
BetaDelay2_3$log_Peak_Power <- log10(BetaDelay2_3$Beta_Peak_Power)
BetaDelay3_4$log_Peak_Power <- log10(BetaDelay3_4$Beta_Peak_Power)
BetaDelay4_5$log_Peak_Power <- log10(BetaDelay4_5$Beta_Peak_Power)
BetaDelay5_6$log_Peak_Power <- log10(BetaDelay5_6$Beta_Peak_Power)


Avg_Beta_Peak_Frequency1_2 <- aggregate(Beta_Peak_Frequency ~ Subject, BetaDelay1_2, mean)
Avg_Beta_Peak_Power1_2 <- aggregate(log_Peak_Power ~ Subject, BetaDelay1_2, mean)
Avg_BetaDelay1_2 <- merge (Avg_Beta_Peak_Frequency1_2, Avg_Beta_Peak_Power1_2, by = "Subject",  all.x = TRUE, all.y = TRUE)


Avg_Beta_Peak_Frequency2_3 <- aggregate(Beta_Peak_Frequency ~ Subject, BetaDelay2_3, mean)
Avg_Beta_Peak_Power2_3 <- aggregate(log_Peak_Power ~ Subject, BetaDelay2_3, mean)
Avg_BetaDelay2_3 <- merge (Avg_Beta_Peak_Frequency2_3, Avg_Beta_Peak_Power2_3, by = "Subject",  all.x = TRUE, all.y = TRUE)


Avg_Beta_Peak_Frequency3_4 <- aggregate(Beta_Peak_Frequency ~ Subject, BetaDelay3_4, mean)
Avg_Beta_Peak_Power3_4 <- aggregate(log_Peak_Power ~ Subject, BetaDelay3_4, mean)
Avg_BetaDelay3_4 <- merge (Avg_Beta_Peak_Frequency3_4, Avg_Beta_Peak_Power3_4, by = "Subject",  all.x = TRUE, all.y = TRUE)


Avg_Beta_Peak_Frequency4_5 <- aggregate(Beta_Peak_Frequency ~ Subject, BetaDelay4_5, mean)
Avg_Beta_Peak_Power4_5 <- aggregate(log_Peak_Power ~ Subject, BetaDelay4_5, mean)
Avg_BetaDelay4_5 <- merge (Avg_Beta_Peak_Frequency4_5, Avg_Beta_Peak_Power4_5, by = "Subject",  all.x = TRUE, all.y = TRUE)


Avg_Beta_Peak_Frequency5_6 <- aggregate(Beta_Peak_Frequency ~ Subject, BetaDelay5_6, mean)
Avg_Beta_Peak_Power5_6 <- aggregate(log_Peak_Power ~ Subject, BetaDelay5_6, mean)
Avg_BetaDelay5_6 <- merge (Avg_Beta_Peak_Frequency5_6, Avg_Beta_Peak_Power5_6, by = "Subject",  all.x = TRUE, all.y = TRUE)

allBetaPeakInfo <- rbind(Avg_BetaDelay1_2, Avg_BetaDelay2_3)
allBetaPeakInfo <- rbind(allBetaPeakInfo, Avg_BetaDelay3_4)
allBetaPeakInfo <- rbind(allBetaPeakInfo,Avg_BetaDelay4_5)
allBetaPeakInfo <- rbind(allBetaPeakInfo, Avg_BetaDelay5_6)
allBetaPeakInfo <- merge(allBetaPeakInfo, agefile, by= "Subject")
allBetaPeakInfo <- subset(allBetaPeakInfo, visitno < 2)

Avg_log_Peak_Power <- aggregate(log_Peak_Power ~ Subject, allBetaPeakInfo, mean)
Avg_Peak_Frequency <- aggregate(Beta_Peak_Frequency ~ Subject, allBetaPeakInfo, mean)

finalPeakMatrix <- merge(Avg_log_Peak_Power, Avg_Peak_Frequency, by = "Subject")
finalPeakMatrix <- merge(finalPeakMatrix, agefile, by = "Subject")
finalPeakMatrix$inverseAge <- 1/finalPeakMatrix$age

ggplot(data = finalPeakMatrix, aes(x = age, y = log_Peak_Power)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Event Peak Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("log(Power)")

lm.model <- lm(data = finalPeakMatrix, log_Peak_Power ~ inverseAge )
anova(lm.model)

ggplot(data = finalPeakMatrix, aes(x = age, y = Beta_Peak_Frequency)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Event Peak Frequency vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Frequency")

lm.model <- lm(data = finalPeakMatrix, Beta_Peak_Frequency ~ inverseAge )
anova(lm.model)


delayPeakMatrixGroup <- setnames(aggregate(list(finalPeakMatrix$log_Peak_Power, finalPeakMatrix$Beta_Peak_Frequency), by = list(finalPeakMatrix$Group, finalPeakMatrix$Group), mean ), c("Group1", "Age_Group", "log_Peak_Power", "Beta_Peak_Frequency"))

delayPeakMatrixGroup$Age_Group[1] <- "10-15 yrs old"
delayPeakMatrixGroup$Age_Group[2] <- "16-20 yrs old"
delayPeakMatrixGroup$Age_Group[3] <- "21-25 yrs old"
delayPeakMatrixGroup$Age_Group[4] <- "26+ yrs old"


ggplot(data = delayPeakMatrixGroup, aes(x = Age_Group, y = log_Peak_Power, color = Age_Group)) + geom_point() + geom_line() + ggtitle("Beta Peak Power Per Age Group") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age Group") + ylab("log(Power)") 

ggplot(data = delayPeakMatrixGroup, aes(x = Age_Group, y = Beta_Peak_Frequency, color = Age_Group)) + geom_point()  + geom_line() + ggtitle("Beta Peak Frequency Per Age Group") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age Group") + ylab("Frequency")

```


## Fixation Period 
### Gamma Frequency Band 
```{r, echo= FALSE, message = FALSE, warning = FALSE}
GammaFix <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Gamma/Fix/Gamma_all_PeakFreq_PowerFix.csv')

GammaFix$log_Peak_Power <- log10(GammaFix$Gamma_Peak_Power)

Avg_Gamma_Peak_Frequency_Fix <- aggregate(Gamma_Peak_Frequency ~ Subject, GammaFix, mean)
Avg_Gamma_Peak_Power_Fix <- aggregate(log_Peak_Power ~ Subject, GammaFix, mean)
Avg_GammaFix <- merge (Avg_Gamma_Peak_Frequency_Fix, Avg_Gamma_Peak_Power_Fix, by = "Subject",  all.x = TRUE, all.y = TRUE)

Avg_GammaFix <- merge(Avg_GammaFix, agefile, by = "Subject", all.x = TRUE, all.y = TRUE)
Avg_GammaFix$inverseAge <- 1/Avg_GammaFix$age

#peak power
ggplot(data = Avg_GammaFix, aes(x = age, y = log_Peak_Power)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Event Peak Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("log(Power)")

lm.model <- lm(data = Avg_GammaFix, log_Peak_Power ~ inverseAge )
anova(lm.model)

#peak frequency 
ggplot(data = Avg_GammaFix, aes(x = age, y = Gamma_Peak_Frequency)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Event Peak Frequency vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Frequency")

lm.model <- lm(data = Avg_GammaFix, Gamma_Peak_Frequency ~ inverseAge )
anova(lm.model)


```



### Alpha Frequency Band 
```{r, echo= FALSE, message = FALSE, warning = FALSE}
AlphaFix <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Alpha/Fix/Alpha_all_PeakFreq_Power_Fix.csv')

AlphaFix$log_Peak_Power <- log10(AlphaFix$Alpha_Peak_Power)

Avg_Alpha_Peak_Frequency_Fix <- aggregate(Alpha_Peak_Frequency ~ Subject, AlphaFix, mean)
Avg_Alpha_Peak_Power_Fix <- aggregate(log_Peak_Power ~ Subject, AlphaFix, mean)
Avg_AlphaFix <- merge (Avg_Alpha_Peak_Frequency_Fix, Avg_Alpha_Peak_Power_Fix, by = "Subject",  all.x = TRUE, all.y = TRUE)

Avg_AlphaFix <- merge(Avg_AlphaFix, agefile, by = "Subject", all.x = TRUE, all.y = TRUE)
Avg_AlphaFix$inverseAge <- 1/Avg_AlphaFix$age

#peak power
ggplot(data = Avg_AlphaFix, aes(x = age, y = log_Peak_Power)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Event Peak Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("log(Power)")

lm.model <- lm(data = Avg_AlphaFix, log_Peak_Power ~ inverseAge )
anova(lm.model)

#peak frequency 
ggplot(data = Avg_AlphaFix, aes(x = age, y = Alpha_Peak_Frequency)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Event Peak Frequency vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Frequency")

lm.model <- lm(data = Avg_AlphaFix, Alpha_Peak_Frequency ~ inverseAge )
anova(lm.model)


```


### Theta Frequency Band 
```{r, echo= FALSE, message = FALSE, warning = FALSE}
ThetaFix <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Theta/Fix/Theta_all_PeakFreq_Power_Fix.csv')

ThetaFix$log_Peak_Power <- log10(ThetaFix$Theta_Peak_Power)

Avg_Theta_Peak_Frequency_Fix <- aggregate(Theta_Peak_Frequency ~ Subject, ThetaFix, mean)
Avg_Theta_Peak_Power_Fix <- aggregate(log_Peak_Power ~ Subject, ThetaFix, mean)
Avg_ThetaFix <- merge (Avg_Theta_Peak_Frequency_Fix, Avg_Theta_Peak_Power_Fix, by = "Subject",  all.x = TRUE, all.y = TRUE)

Avg_ThetaFix <- merge(Avg_ThetaFix, agefile, by = "Subject", all.x = TRUE, all.y = TRUE)
Avg_ThetaFix$inverseAge <- 1/Avg_ThetaFix$age

#peak power
ggplot(data = Avg_ThetaFix, aes(x = age, y = log_Peak_Power)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Event Peak Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("log(Power)")

lm.model <- lm(data = Avg_ThetaFix, log_Peak_Power ~ inverseAge )
anova(lm.model)

#peak frequency 
ggplot(data = Avg_ThetaFix, aes(x = age, y = Theta_Peak_Frequency)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Event Peak Frequency vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Frequency")

lm.model <- lm(data = Avg_ThetaFix, Theta_Peak_Frequency ~ inverseAge )
anova(lm.model)


```


### Beta Frequency Band 
```{r, echo= FALSE, message = FALSE, warning = FALSE}
BetaFix <- read.csv('H:/Projects/7TBrainMech/scripts/eeg/Shane/Results/Power_Analysis/Spectral_events_analysis/Beta/Fix/Beta_all_PeakFreq_Power_Fix.csv')

BetaFix$log_Peak_Power <- log10(BetaFix$Beta_Peak_Power)

Avg_Beta_Peak_Frequency_Fix <- aggregate(Beta_Peak_Frequency ~ Subject, BetaFix, mean)
Avg_Beta_Peak_Power_Fix <- aggregate(log_Peak_Power ~ Subject, BetaFix, mean)
Avg_BetaFix <- merge (Avg_Beta_Peak_Frequency_Fix, Avg_Beta_Peak_Power_Fix, by = "Subject",  all.x = TRUE, all.y = TRUE)

Avg_BetaFix <- merge(Avg_BetaFix, agefile, by = "Subject", all.x = TRUE, all.y = TRUE)
Avg_BetaFix$inverseAge <- 1/Avg_BetaFix$age

#peak power
ggplot(data = Avg_BetaFix, aes(x = age, y = log_Peak_Power)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Event Peak Power vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("log(Power)")

lm.model <- lm(data = Avg_BetaFix, log_Peak_Power ~ inverseAge )
anova(lm.model)

#peak frequency 
ggplot(data = Avg_BetaFix, aes(x = age, y = Beta_Peak_Frequency)) + geom_point() + stat_smooth(method='lm',  formula='y~I(1/x)') + ggtitle("Average Event Peak Frequency vs Age") + theme(plot.title = element_text(hjust = 0.5)) + xlab("Age") + ylab("Frequency")

lm.model <- lm(data = Avg_BetaFix, Beta_Peak_Frequency ~ inverseAge )
anova(lm.model)


```










